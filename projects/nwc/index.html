<!DOCTYPE html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width, initial-scale=1.0"><title>NWC Demo - Nostr Wallet Connect</title><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css rel=stylesheet><link href=nwc.b2ae7915.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js></script><script src=https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js></script><body>
    <div class="container py-4">
        
        <div class="mb-4 row">
            <div class="col-12 text-center">
                <h1 class="display-5 fw-bold text-primary">üîó Nostr Wallet Connect Demo</h1>
                <p class=lead>Experiment with two NWC (Nostr Wallet Connect) wallets simultaneously</p>
            </div>
        </div>

        
        <div class="mb-3 row">
            <div class=col-12>
                <div class="alert alert-warning border-warning" role=alert>
                    <h5 class="alert-heading mb-2">‚ö†Ô∏è Educational Project Only</h5>
                    <p class="mb-0 small">This is a demonstration project created for educational purposes to showcase Nostr Wallet Connect (NWC) functionality. Use only with test wallets and small amounts. Not intended for production use.</p>
                </div>
            </div>
        </div>

        
        <div class="mb-4 row">
            <div class=col-12>
                <div class=card>
                    <div class="align-items-center card-header d-flex justify-content-between">
                        <h5 class="card-title mb-0">‚Çø Bitcoin Price</h5>
                        <div>
                            <small class="me-3 text-muted" id=price-updated>Last Update: --</small>
                            <button class="btn btn-outline-primary btn-sm" onclick=fetchBitcoinPrice()>‚Üª
                                Refresh</button>
                        </div>
                    </div>
                    <div class=card-body>
                        <div class="row text-center">
                            <div class="col-6 col-lg-2 col-md-4 mb-3">
                                <div class="h4 mb-1 text-success" id=price-usd>$ --</div>
                                <small class="d-block text-muted">USD</small>
                                <small class=text-success id=sats-usd>-- sats = $1</small>
                            </div>
                            <div class="col-6 col-lg-2 col-md-4 mb-3">
                                <div class="h4 mb-1 text-primary" id=price-eur>‚Ç¨ --</div>
                                <small class="d-block text-muted">EUR</small>
                                <small class=text-primary id=sats-eur>-- sats = ‚Ç¨1</small>
                            </div>
                            <div class="col-6 col-lg-2 col-md-4 mb-3">
                                <div class="h4 mb-1 text-info" id=price-gbp>¬£ --</div>
                                <small class="d-block text-muted">GBP</small>
                                <small class=text-info id=sats-gbp>-- sats = ¬£1</small>
                            </div>
                            <div class="col-6 col-lg-2 col-md-4 mb-3">
                                <div class="h4 mb-1 text-warning" id=price-chf>‚Ç£ --</div>
                                <small class="d-block text-muted">CHF</small>
                                <small class=text-warning id=sats-chf>-- sats = ‚Ç£1</small>
                            </div>
                            <div class="col-6 col-lg-2 col-md-4 mb-3">
                                <div class="h4 mb-1 text-secondary" id=price-cad>C$ --</div>
                                <small class="d-block text-muted">CAD</small>
                                <small class=text-secondary id=sats-cad>-- sats = C$1</small>
                            </div>
                            <div class="col-6 col-lg-2 col-md-4 mb-3">
                                <div class="h4 mb-1 text-dark" id=price-jpy>¬• --</div>
                                <small class="d-block text-muted">JPY</small>
                                <small class=text-dark id=sats-jpy>-- sats = ¬•1</small>
                            </div>
                        </div>
                        <div class="mt-4 row">
                            <div class=col-12>
                                <div class="align-items-center d-flex justify-content-between mb-3">
                                    <h6 class=mb-0>üìà Price History (all currencies)</h6>
                                    <div class="d-flex gap-2">
                                        <div class="btn-group btn-group-sm" role=group>
                                            <input type=radio class=btn-check name=timeRange id=range-12h value=12h checked onchange=updatePriceChart()>
                                            <label class="btn btn-outline-primary" for=range-12h>12h</label>

                                            <input type=radio class=btn-check name=timeRange id=range-24h value=24h onchange=updatePriceChart()>
                                            <label class="btn btn-outline-primary" for=range-24h>24h</label>

                                            <input type=radio class=btn-check name=timeRange id=range-2d value=2d onchange=updatePriceChart()>
                                            <label class="btn btn-outline-primary" for=range-2d>2d</label>

                                            <input type=radio class=btn-check name=timeRange id=range-4d value=4d onchange=updatePriceChart()>
                                            <label class="btn btn-outline-primary" for=range-4d>4d</label>

                                            <input type=radio class=btn-check name=timeRange id=range-7d value=7d onchange=updatePriceChart()>
                                            <label class="btn btn-outline-primary" for=range-7d>7d</label>
                                        </div>
                                        <button class="btn btn-outline-secondary btn-sm" onclick=fetchHistoricalPrices() title="Load 7-day test data">
                                            üîÑ
                                        </button>
                                        <button class="btn btn-outline-danger btn-sm" onclick=clearAndReloadPriceData() title="Clear all price data and reload">
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                </div>
                                <div style=aspect-ratio:32/9;width:100%;position:relative>
                                    <canvas id=priceChart></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="mt-2 row">
                            <div class="col-12 text-center">
                                <small class=text-muted>Price updates automatically every 30 seconds | Source:
                                    mempool.space</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        
        <div class=row>
            
            <div class="col-lg-6 mb-4">
                <div class="card h-100 wallet-card">
                    <div class="card-header text-center">
                        <h3 class="card-title mb-0">üí∞ Stability Provider</h3>
                    </div>
                    <div class=card-body>
                        
                        <div class=mb-4>
                            <h5 class="card-subtitle mb-3">Connection</h5>
                            <div class=mb-3>
                                <label for=nwc-url-1 class=form-label>NWC Connection String:</label>
                                <div class=input-group>
                                    <textarea id=nwc-url-1 class=form-control type=password placeholder="nostr+walletconnect://pubkey?relay=wss://relay.example.com&amp;secret=secret..." rows=3 style=-webkit-text-security:disc;font-family:monospace></textarea>
                                    <button class="btn btn-outline-secondary" type=button onclick=toggleConnectionVisibility(1) id=toggle-visibility-1>
                                        üëÅÔ∏è
                                    </button>
                                </div>
                            </div>
                            <div class="d-grid d-md-flex gap-2">
                                <button id=connect-btn-1 class="btn btn-primary flex-fill" onclick=connectWallet(1)>Connect</button>
                                <button id=disconnect-btn-1 class="btn btn-outline-secondary flex-fill" onclick=disconnectWallet(1) disabled>Disconnect</button>
                            </div>
                            <div class="d-grid d-md-flex gap-2 mt-2">
                                <button class="btn btn-outline-success btn-sm flex-fill" onclick=saveConnectionString(1)>üíæ Save</button>
                                <button class="btn btn-outline-danger btn-sm flex-fill" onclick=clearConnectionString(1)>üóëÔ∏è Clear</button>
                            </div>
                            <div class=mt-2>
                                <span id=connection-status-1 class="badge bg-secondary status-badge">Not
                                    connected</span>
                            </div>
                        </div>

                        
                        <div class=mb-4>
                            <h5 class="card-subtitle mb-3">Wallet Information</h5>
                            <div class="d-grid d-md-flex gap-2 mb-2">
                                <button class="btn btn-outline-info btn-sm flex-fill" onclick=getWalletInfo(1)>get_info</button>
                                <button class="btn btn-outline-info btn-sm flex-fill" onclick=getBalance(1)>get_balance</button>
                            </div>
                            <div id=wallet-info-1 class=result-display></div>
                        </div>

                        
                        <div class=mb-3>
                            <h5 class="card-subtitle mb-3">Payment Actions</h5>
                            <div class="g-2 row">
                                <div class=col-6>
                                    <button class="btn btn-sm btn-success w-100" onclick=createInvoice(1)>Create
                                        Invoice</button>
                                </div>
                                <div class=col-6>
                                    <button class="btn btn-sm btn-warning w-100" onclick=payInvoice(1)>Pay
                                        Invoice</button>
                                </div>
                                <div class=col-6>
                                    <button class="btn btn-info btn-sm w-100" onclick=listTransactions(1)>Transactions</button>
                                </div>
                                <div class=col-6>
                                    <button class="btn btn-secondary btn-sm w-100" onclick=payKeysend(1)>Keysend</button>
                                </div>
                            </div>
                            <div id=payment-result-1 class=result-display></div>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="col-lg-6 mb-4">
                <div class="card h-100 wallet-card">
                    <div class="card-header text-center">
                        <h3 class="card-title mb-0">üí≥ Stability Receiver</h3>
                    </div>
                    <div class=card-body>
                        
                        <div class=mb-4>
                            <h5 class="card-subtitle mb-3">Connection</h5>
                            <div class=mb-3>
                                <label for=nwc-url-2 class=form-label>NWC Connection String:</label>
                                <div class=input-group>
                                    <textarea id=nwc-url-2 class=form-control type=password placeholder="nostr+walletconnect://pubkey?relay=wss://relay.example.com&amp;secret=secret..." rows=3 style=-webkit-text-security:disc;font-family:monospace></textarea>
                                    <button class="btn btn-outline-secondary" type=button onclick=toggleConnectionVisibility(2) id=toggle-visibility-2>
                                        üëÅÔ∏è
                                    </button>
                                </div>
                            </div>
                            <div class="d-grid d-md-flex gap-2">
                                <button id=connect-btn-2 class="btn btn-primary flex-fill" onclick=connectWallet(2)>Connect</button>
                                <button id=disconnect-btn-2 class="btn btn-outline-secondary flex-fill" onclick=disconnectWallet(2) disabled>Disconnect</button>
                            </div>
                            <div class="d-grid d-md-flex gap-2 mt-2">
                                <button class="btn btn-outline-success btn-sm flex-fill" onclick=saveConnectionString(2)>üíæ Save</button>
                                <button class="btn btn-outline-danger btn-sm flex-fill" onclick=clearConnectionString(2)>üóëÔ∏è Clear</button>
                            </div>
                            <div class=mt-2>
                                <span id=connection-status-2 class="badge bg-secondary status-badge">Not
                                    connected</span>
                            </div>
                        </div>

                        
                        <div class=mb-4>
                            <h5 class="card-subtitle mb-3">Wallet Information</h5>
                            <div class="d-grid d-md-flex gap-2 mb-2">
                                <button class="btn btn-outline-info btn-sm flex-fill" onclick=getWalletInfo(2)>get_info</button>
                                <button class="btn btn-outline-info btn-sm flex-fill" onclick=getBalance(2)>get_balance</button>
                            </div>
                            <div id=wallet-info-2 class=result-display></div>
                        </div>

                        
                        <div class=mb-4>
                            <h5 class="card-subtitle mb-3">Payment Actions</h5>
                            <div class="g-2 row">
                                <div class=col-6>
                                    <button class="btn btn-sm btn-success w-100" onclick=createInvoice(2)>Create
                                        Invoice</button>
                                </div>
                                <div class=col-6>
                                    <button class="btn btn-sm btn-warning w-100" onclick=payInvoice(2)>Pay
                                        Invoice</button>
                                </div>
                                <div class=col-6>
                                    <button class="btn btn-info btn-sm w-100" onclick=listTransactions(2)>Transactions</button>
                                </div>
                                <div class=col-6>
                                    <button class="btn btn-secondary btn-sm w-100" onclick=payKeysend(2)>Keysend</button>
                                </div>
                            </div>
                            <div id=payment-result-2 class=result-display></div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        
        <div class="mb-4 row">
            <div class=col-12>
                <div class=card>
                    <div class="card-header text-center">
                        <h4 class="card-title mb-0">üí± Balance Stabilization</h4>
                        <small class=text-muted>Automatic currency stabilization between Stability Provider &amp;
                            Receiver</small>
                    </div>
                    <div class=card-body>
                        
                        <div class="mb-4 row">
                            <div class=col-md-6>
                                <div class=mb-3>
                                    <label for=stabilization-currency class=form-label>Select target
                                        currency:</label>
                                    <select id=stabilization-currency class=form-select>
                                        <option value>-- Choose currency --</option>
                                        <option value=usd>USD ($)</option>
                                        <option value=eur>EUR (‚Ç¨)</option>
                                        <option value=gbp>GBP (¬£)</option>
                                        <option value=chf>CHF (‚Ç£)</option>
                                        <option value=cad>CAD (C$)</option>
                                        <option value=jpy>JPY (¬•)</option>
                                    </select>
                                </div>
                                <div class=mb-3>
                                    <div id=stabilization-status class="alert alert-secondary px-3 py-3">
                                        Status: Not active
                                    </div>
                                </div>
                            </div>
                            <div class=col-md-6>
                                <div class=mb-3>
                                    <label for=rebalance-threshold class="form-label small">Rebalancing Threshold
                                        (Sats):</label>
                                    <input type=number id=rebalance-threshold class="form-control form-control-sm" value=1 min=1 max=1000>
                                    <small class=text-muted>Minimum difference for automatic rebalancing</small>
                                </div>
                                <div class="d-grid gap-2">
                                    <button id=start-stabilization class="btn btn-success" onclick=startStabilization() disabled>
                                        üéØ Start Stabilization
                                    </button>
                                    <button id=stop-stabilization class="btn btn-danger" onclick=stopStabilization() disabled>
                                        ‚èπÔ∏è Stop Stabilization
                                    </button>
                                </div>
                            </div>
                        </div>

                        
                        <div class=row>
                            
                            <div class=col-md-6>
                                <div class="border-danger card">
                                    <div class="bg-danger card-header text-white">
                                        <h6 class="card-title mb-0">üí∞ Stability Provider (Source)</h6>
                                        <small>Liquidity provider for rebalancing</small>
                                    </div>
                                    <div class=card-body>
                                        <div id=wallet1-stabilization-info class=stabilization-wallet-info>
                                            <div class="py-3 text-center text-muted">
                                                <i class="fa-info-circle fas"></i>
                                                <div>Connect Stability Provider to display data</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            
                            <div class=col-md-6>
                                <div class="border-success card">
                                    <div class="bg-success card-header text-white">
                                        <h6 class="card-title mb-0">üéØ Stability Receiver (Target)</h6>
                                        <small>Stabilized wallet</small>
                                    </div>
                                    <div class=card-body>
                                        <div id=wallet2-stabilization-info class=stabilization-wallet-info>
                                            <div class="py-3 text-center text-muted">
                                                <i class="fa-info-circle fas"></i>
                                                <div>Connect Stability Receiver to display data</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        
                        <div class="mt-3 row">
                            
                            <div class=col-md-6>
                                <div class="border-danger card">
                                    <div class="bg-light card-header">
                                        <h6 class="card-title mb-0 text-danger">üìÑ Stability Provider Transactions</h6>
                                    </div>
                                    <div class="card-body p-0">
                                        <div id=wallet1-transactions class=wallet-transactions style=max-height:300px;overflow-y:auto>
                                            <div class="py-3 text-center text-muted">
                                                <i class="fa-info-circle fas"></i>
                                                <div>Connect Stability Provider to display transactions</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            
                            <div class=col-md-6>
                                <div class="border-success card">
                                    <div class="bg-light card-header">
                                        <h6 class="card-title mb-0 text-success">üìÑ Stability Receiver Transactions</h6>
                                    </div>
                                    <div class="card-body p-0">
                                        <div id=wallet2-transactions class=wallet-transactions style=max-height:300px;overflow-y:auto>
                                            <div class="py-3 text-center text-muted">
                                                <i class="fa-info-circle fas"></i>
                                                <div>Connect Stability Receiver to display transactions</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        
                        <div class="mt-3 row">
                            <div class=col-12>
                                <div class="alert alert-info px-3 py-2">
                                    <small>
                                        <strong>üìã How it works:</strong>
                                        Stability Receiver balance is stabilized in the selected currency.
                                        When prices change, automatic rebalancing occurs between both wallets.
                                        <br>
                                        <strong>üìã Requirement:</strong> Both wallets must be connected.
                                    </small>
                                </div>
                            </div>
                        </div>

                        
                        <div id=stabilization-info style=display:none></div>
                    </div>
                </div>
            </div>
        </div>

        
        <div class="mt-4 row">
            <div class=col-12>
                <div class="card debug-section">
                    <div class="align-items-center card-header d-flex justify-content-between">
                        <h5 class="card-title mb-0">üîç Debug Log</h5>
                        <button class="btn btn-outline-danger btn-sm" onclick=clearLog()>Clear Log</button>
                    </div>
                    <div class=card-body>
                        <div id=debug-log class=result-display>Debug messages will be displayed here...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    <script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js></script>

    
    <script type=module src=./nwc.36942d46.js></script>


