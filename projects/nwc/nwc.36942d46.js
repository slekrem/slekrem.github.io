function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var t=globalThis,r={},n={},i=t.parcelRequireed78;null==i&&((i=function(e){if(e in r)return r[e].exports;if(e in n){var t=n[e];delete n[e];var i={id:e,exports:{}};return r[e]=i,t.call(i.exports,i,i.exports),i.exports}var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){n[e]=t},t.parcelRequireed78=i);var o=i.register;o("9BsJg",function(t,r){e(t.exports,"nwc",()=>F);var n=i("fS6LT"),o=i("imRk1");function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(){return(l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function c(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,h(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t,r){return(f=!function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}()?function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&h(i,r.prototype),i}:Reflect.construct.bind()).apply(null,arguments)}function d(e){var t="function"==typeof Map?new Map:void 0;return(d=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return f(e,arguments,u(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),h(r,e)})(e)}if(68!==new Uint8Array(new Uint32Array([0x11223344]).buffer)[0])throw Error("Non little-endian hardware is not supported");let p=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function y(e){if(!(e instanceof Uint8Array))throw Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=p[e[r]];return t}function g(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);let t=e.length;if(t%2)throw Error("padded hex string expected, got unpadded hex of length "+t);let r=new Uint8Array(t/2);for(let t=0;t<r.length;t++){let n=2*t,i=Number.parseInt(e.slice(n,n+2),16);if(Number.isNaN(i)||i<0)throw Error("Invalid byte sequence");r[t]=i}return r}var b=function(e){function t(t,r){var n;return(n=e.call(this,t)||this).code=void 0,n.code=r,n}return c(t,e),t}(d(Error)),m=function(e){function t(){return e.apply(this,arguments)||this}return c(t,e),t}(b),v=function(e){function t(){return e.apply(this,arguments)||this}return c(t,e),t}(b),w=function(e){function t(){return e.apply(this,arguments)||this}return c(t,e),t}(b),x=function(e){function t(){return e.apply(this,arguments)||this}return c(t,e),t}(w),E=function(e){function t(){return e.apply(this,arguments)||this}return c(t,e),t}(w),P=function(e){function t(){return e.apply(this,arguments)||this}return c(t,e),t}(b),B=function(e){function t(){return e.apply(this,arguments)||this}return c(t,e),t}(b),k=function(e){function t(){return e.apply(this,arguments)||this}return c(t,e),t}(b),A=function(e){function t(){return e.apply(this,arguments)||this}return c(t,e),t}(b),S=function(e){function t(){return e.apply(this,arguments)||this}return c(t,e),t}(b);function T(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}function C(e,t,r){if(!e.s){if(r instanceof I){if(!r.s)return void(r.o=C.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(C.bind(null,e,t),C.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}var I=function(){function e(){}return e.prototype.then=function(t,r){var n=new e,i=this.s;if(i){var o=1&i?t:r;if(o){try{C(n,1,o(this.v))}catch(e){C(n,2,e)}return n}return this}return this.o=function(e){try{var i=e.v;1&e.s?C(n,1,t?t(i):i):r?C(n,1,r(i)):C(n,2,i)}catch(e){C(n,2,e)}},n},e}();function _(e){return e instanceof I&&1&e.s}var U=function(){function e(t){this.relay=void 0,this.relayUrl=void 0,this.secret=void 0,this.lud16=void 0,this.walletPubkey=void 0,this.options=void 0,this._encryptionType=void 0,t&&t.nostrWalletConnectUrl&&(t=l({},e.parseWalletConnectUrl(t.nostrWalletConnectUrl),t)),this.options=l({},t||{}),this.relayUrl=this.options.relayUrl,this.relay=new(0,n.Relay)(this.relayUrl),this.options.secret&&(this.secret=this.options.secret.toLowerCase().startsWith("nsec")?n.nip19.decode(this.options.secret).data:this.options.secret),this.lud16=this.options.lud16,this.walletPubkey=this.options.walletPubkey.toLowerCase().startsWith("npub")?n.nip19.decode(this.options.walletPubkey).data:this.options.walletPubkey,void 0===globalThis.WebSocket&&console.error("WebSocket is undefined. Make sure to `import websocket-polyfill` for nodejs environments")}e.parseWalletConnectUrl=function(e){var t=new URL(e=e.replace("nostrwalletconnect://","http://").replace("nostr+walletconnect://","http://").replace("nostrwalletconnect:","http://").replace("nostr+walletconnect:","http://")),r=t.searchParams.get("relay");if(!r)throw Error("No relay URL found in connection string");var n={walletPubkey:t.host,relayUrl:r},i=t.searchParams.get("secret");i&&(n.secret=i);var o=t.searchParams.get("lud16");return o&&(n.lud16=o),n};var t=e.prototype;return t.getNostrWalletConnectUrl=function(e){void 0===e&&(e=!0);var t="nostr+walletconnect://"+this.walletPubkey+"?relay="+this.relayUrl+"&pubkey="+this.publicKey;return e&&(t=t+"&secret="+this.secret),this.lud16&&(t=t+"&lud16="+this.lud16),t},t.getPublicKey=function(){return Promise.resolve(this.publicKey)},t.signEvent=function(e){if(!this.secret)throw Error("Missing secret key");return Promise.resolve((0,n.finalizeEvent)(e,g(this.secret)))},t.getEventHash=function(e){return(0,n.getEventHash)(e)},t.close=function(){return this.relay.close()},t.encrypt=function(e,t){try{var r,i=this;if(!i.secret)throw Error("Missing secret");var o=function(){if("nip04"===i.encryptionType)return Promise.resolve(n.nip04.encrypt(i.secret,e,t)).then(function(e){r=e});var o=n.nip44.getConversationKey(g(i.secret),e);r=n.nip44.encrypt(t,o)}();return Promise.resolve(o&&o.then?o.then(function(){return r}):r)}catch(e){return Promise.reject(e)}},t.decrypt=function(e,t){try{var r,i=this;if(!i.secret)throw Error("Missing secret");var o=function(){if("nip04"===i.encryptionType)return Promise.resolve(n.nip04.decrypt(i.secret,e,t)).then(function(e){r=e});var o=n.nip44.getConversationKey(g(i.secret),e);r=n.nip44.decrypt(t,o)}();return Promise.resolve(o&&o.then?o.then(function(){return r}):r)}catch(e){return Promise.reject(e)}},e.getAuthorizationUrl=function(e,t,r){if(void 0===t&&(t={}),e.indexOf("/#/")>-1)throw Error("hash router paths not supported");var n=new URL(e);return t.name&&n.searchParams.set("name",t.name),n.searchParams.set("pubkey",r),t.returnTo&&n.searchParams.set("return_to",t.returnTo),t.budgetRenewal&&n.searchParams.set("budget_renewal",t.budgetRenewal),t.expiresAt&&n.searchParams.set("expires_at",Math.floor(t.expiresAt.getTime()/1e3).toString()),t.maxAmount&&n.searchParams.set("max_amount",t.maxAmount.toString()),t.requestMethods&&n.searchParams.set("request_methods",t.requestMethods.join(" ")),t.notificationTypes&&n.searchParams.set("notification_types",t.notificationTypes.join(" ")),t.isolated&&n.searchParams.set("isolated","true"),t.metadata&&n.searchParams.set("metadata",JSON.stringify(t.metadata)),n},e.fromAuthorizationUrl=function(t,r,i){void 0===r&&(r={}),i=i||y((0,n.generateSecretKey)()),r.name||(r.name=document.location.host);var o=this.getAuthorizationUrl(t,r,(0,n.getPublicKey)(g(i))),s=window.outerHeight/2+window.screenY-300,a=window.outerWidth/2+window.screenX-200;return new Promise(function(t,r){var n=window.open(o.toString(),document.title+" - Wallet Connect","height=600,width=400,top="+s+",left="+a);if(n){var l=function s(a){var l=a.data;l&&"nwc:success"===l.type&&a.origin===o.protocol+"//"+o.host&&(l.relayUrl||r(Error("no relayUrl in response")),l.walletPubkey||r(Error("no walletPubkey in response")),t(new e({relayUrl:l.relayUrl,walletPubkey:l.walletPubkey,secret:i,lud16:l.lud16})),clearInterval(c),window.removeEventListener("message",s),n&&n.close())},c=setInterval(function(){n&&n.closed&&(clearInterval(c),window.removeEventListener("message",l),r(Error("Popup closed")))},500);window.addEventListener("message",l)}else r(Error("failed to execute window.open"))})},t.getWalletServiceInfo=function(){try{var e=this;return Promise.resolve(e._checkConnected()).then(function(){return Promise.resolve(new Promise(function(t,r){var n=[],i=e.relay.subscribe([{kinds:[13194],limit:1,authors:[e.walletPubkey]}],{eoseTimeout:1e4});i.onevent=function(e){n.push(e)},i.oneose=function(){i.close(),t(n)}})).then(function(e){if(!e.length)throw Error("no info event (kind 13194) returned from relay");var t,r=e[0].content,n=e[0].tags.find(function(e){return"notifications"===e[0]}),i=e[0].tags.find(function(e){return"v"===e[0]}),o=e[0].tags.find(function(e){return"encryption"===e[0]}),s=["nip04"];return i&&i[1].includes("1.0")&&s.push("nip44_v2"),o&&(s=o[1].split(" ")),{encryptions:s,capabilities:r.split(/[ |,]/g),notifications:(null==n||null==(t=n[1])?void 0:t.split(" "))||[]}})})}catch(e){return Promise.reject(e)}},t.getInfo=function(){try{var e=this;return Promise.resolve(T(function(){return Promise.resolve(e.executeNip47Request("get_info",{},function(e){return!!e.methods},{replyTimeout:1e4}))},function(e){throw console.error("Failed to request get_info",e),e}))}catch(e){return Promise.reject(e)}},t.getBudget=function(){try{var e=this;return Promise.resolve(T(function(){return Promise.resolve(e.executeNip47Request("get_budget",{},function(e){return void 0!==e},{replyTimeout:1e4}))},function(e){throw console.error("Failed to request get_budget",e),e}))}catch(e){return Promise.reject(e)}},t.getBalance=function(){try{var e=this;return Promise.resolve(T(function(){return Promise.resolve(e.executeNip47Request("get_balance",{},function(e){return void 0!==e.balance},{replyTimeout:1e4}))},function(e){throw console.error("Failed to request get_balance",e),e}))}catch(e){return Promise.reject(e)}},t.payInvoice=function(e){try{var t=this;return Promise.resolve(T(function(){return Promise.resolve(t.executeNip47Request("pay_invoice",e,function(e){return!!e}))},function(e){throw console.error("Failed to request pay_invoice",e),e}))}catch(e){return Promise.reject(e)}},t.payKeysend=function(e){try{var t=this;return Promise.resolve(T(function(){return Promise.resolve(t.executeNip47Request("pay_keysend",e,function(e){return!!e.preimage}))},function(e){throw console.error("Failed to request pay_keysend",e),e}))}catch(e){return Promise.reject(e)}},t.signMessage=function(e){try{var t=this;return Promise.resolve(T(function(){return Promise.resolve(t.executeNip47Request("sign_message",e,function(t){return t.message===e.message&&!!t.signature}))},function(e){throw console.error("Failed to request sign_message",e),e}))}catch(e){return Promise.reject(e)}},t.createConnection=function(e){try{var t=this;return Promise.resolve(T(function(){return Promise.resolve(t.executeNip47Request("create_connection",e,function(e){return!!e.wallet_pubkey}))},function(e){throw console.error("Failed to request create_connection",e),e}))}catch(e){return Promise.reject(e)}},t.multiPayInvoice=function(e){try{var t=this;return Promise.resolve(T(function(){return Promise.resolve(t.executeMultiNip47Request("multi_pay_invoice",e,e.invoices.length,function(e){return!!e.preimage})).then(function(e){return{invoices:e,errors:[]}})},function(e){throw console.error("Failed to request multi_pay_invoice",e),e}))}catch(e){return Promise.reject(e)}},t.multiPayKeysend=function(e){try{var t=this;return Promise.resolve(T(function(){return Promise.resolve(t.executeMultiNip47Request("multi_pay_keysend",e,e.keysends.length,function(e){return!!e.preimage})).then(function(e){return{keysends:e,errors:[]}})},function(e){throw console.error("Failed to request multi_pay_keysend",e),e}))}catch(e){return Promise.reject(e)}},t.makeInvoice=function(e){try{var t=this;return Promise.resolve(T(function(){if(!e.amount)throw Error("No amount specified");return Promise.resolve(t.executeNip47Request("make_invoice",e,function(e){return!!e.invoice}))},function(e){throw console.error("Failed to request make_invoice",e),e}))}catch(e){return Promise.reject(e)}},t.makeHoldInvoice=function(e){try{var t=this;return Promise.resolve(T(function(){if(!e.amount)throw Error("No amount specified");if(!e.payment_hash)throw Error("No payment hash specified");return Promise.resolve(t.executeNip47Request("make_hold_invoice",e,function(e){return!!e.invoice}))},function(e){throw console.error("Failed to request make_hold_invoice",e),e}))}catch(e){return Promise.reject(e)}},t.settleHoldInvoice=function(e){try{var t=this;return Promise.resolve(T(function(){return Promise.resolve(t.executeNip47Request("settle_hold_invoice",e,function(e){return!!e}))},function(e){throw console.error("Failed to request settle_hold_invoice",e),e}))}catch(e){return Promise.reject(e)}},t.cancelHoldInvoice=function(e){try{var t=this;return Promise.resolve(T(function(){return Promise.resolve(t.executeNip47Request("cancel_hold_invoice",e,function(e){return!!e}))},function(e){throw console.error("Failed to request cancel_hold_invoice",e),e}))}catch(e){return Promise.reject(e)}},t.lookupInvoice=function(e){try{var t=this;return Promise.resolve(T(function(){return Promise.resolve(t.executeNip47Request("lookup_invoice",e,function(e){return!!e.invoice}))},function(e){throw console.error("Failed to request lookup_invoice",e),e}))}catch(e){return Promise.reject(e)}},t.listTransactions=function(e){try{var t=this;return Promise.resolve(T(function(){return Promise.resolve(t.executeNip47Request("list_transactions",e,function(e){return!!e.transactions},{replyTimeout:1e4}))},function(e){throw console.error("Failed to request list_transactions",e),e}))}catch(e){return Promise.reject(e)}},t.subscribeNotifications=function(e,t){try{var r,n,i,o=this,s=!0;return function(){try{var a=function(e,t,r){for(var n;;){var i=e();if(_(i)&&(i=i.v),!i)return o;if(i.then){n=0;break}var o=r();if(o&&o.then){if(!_(o)){n=1;break}o=o.s}}var s=new I,a=C.bind(null,s,2);return(0===n?i.then(c):1===n?o.then(l):(void 0).then(function(){(i=e())?i.then?i.then(c).then(void 0,a):c(i):C(s,1,o)})).then(void 0,a),s;function l(t){o=t;do{if(!(i=e())||_(i)&&!i.v)return void C(s,1,o);if(i.then)return void i.then(c).then(void 0,a);_(o=r())&&(o=o.v)}while(!o||!o.then)o.then(l).then(void 0,a)}function c(e){e?(o=r())&&o.then?o.then(l).then(void 0,a):l(o):C(s,1,o)}}(function(){return!!s},0,function(){function a(){var e=function(){if(s)return Promise.resolve(new Promise(function(e){return setTimeout(e,1e3)})).then(function(){})}();if(e&&e.then)return e.then(function(){})}var l=T(function(){return Promise.resolve(o._checkConnected()).then(function(){return Promise.resolve(o._selectEncryptionType()).then(function(){return i=o.relay.subscribe([{kinds:[].concat("nip04"===o.encryptionType?[23196]:[23197]),authors:[o.walletPubkey],"#p":[o.publicKey]}],{}),console.info("subscribed to relay"),i.onevent=function(r){try{return Promise.resolve(o.decrypt(o.walletPubkey,r.content)).then(function(r){var n;try{n=JSON.parse(r)}catch(e){return void console.error("Failed to parse decrypted event content",e)}n.notification?(!t||t.indexOf(n.notification_type)>-1)&&e(n):console.error("No notification in response",n)})}catch(e){return Promise.reject(e)}},Promise.resolve(new Promise(function(e){r=function(){e()},o.relay.onclose=n=function(){console.info("relay disconnected"),null==r||r()}})).then(function(){void 0!==n&&(o.relay.onclose=null)})})})},function(e){console.error("error subscribing to notifications",e||"unknown relay error")});return l&&l.then?l.then(a):a()});a&&a.then&&a.then(function(){})}catch(e){Promise.reject(e)}}(),Promise.resolve(function(){var e;s=!1,null==r||r(),null==(e=i)||e.close()})}catch(e){return Promise.reject(e)}},t.executeNip47Request=function(e,t,r,n){try{var i=this;return Promise.resolve(i._checkConnected()).then(function(){return Promise.resolve(i._selectEncryptionType()).then(function(){return new Promise(function(o,s){try{return Promise.resolve(i.encrypt(i.walletPubkey,JSON.stringify({method:e,params:t}))).then(function(e){var t={kind:23194,created_at:Math.floor(Date.now()/1e3),tags:[["p",i.walletPubkey],["v","nip44_v2"===i.encryptionType?"1.0":"0.0"],["encryption",i.encryptionType]],content:e};return Promise.resolve(i.signEvent(t)).then(function(e){var t=i.relay.subscribe([{kinds:[23195],authors:[i.walletPubkey],"#e":[e.id]}],{}),a=setTimeout(function(){t.close(),s(new E("reply timeout: event "+e.id,"INTERNAL"))},(null==n?void 0:n.replyTimeout)||6e4);t.onevent=function(e){try{return clearTimeout(a),t.close(),Promise.resolve(i.decrypt(i.walletPubkey,e.content)).then(function(e){var n,i,l;try{n=JSON.parse(e)}catch(e){return clearTimeout(a),t.close(),void s(new B("failed to deserialize response","INTERNAL"))}n.result?r(n.result)?o(n.result):(clearTimeout(a),t.close(),s(new k("response from NWC failed validation: "+JSON.stringify(n.result),"INTERNAL"))):(clearTimeout(a),t.close(),s(new v((null==(i=n.error)?void 0:i.message)||"unknown Error",(null==(l=n.error)?void 0:l.code)||"INTERNAL")))})}catch(e){return Promise.reject(e)}};var l=setTimeout(function(){t.close(),s(new x("publish timeout: "+e.id,"INTERNAL"))},(null==n?void 0:n.publishTimeout)||5e3),c=T(function(){return Promise.resolve(i.relay.publish(e)).then(function(){clearTimeout(l)})},function(e){clearTimeout(l),s(new P("failed to publish: "+e,"INTERNAL"))});if(c&&c.then)return c.then(function(){})})})}catch(e){Promise.reject(e)}})})})}catch(e){return Promise.reject(e)}},t.executeMultiNip47Request=function(e,t,r,n,i){try{var o=this;return Promise.resolve(o._checkConnected()).then(function(){return Promise.resolve(o._selectEncryptionType()).then(function(){var s=[];return new Promise(function(a,c){try{return Promise.resolve(o.encrypt(o.walletPubkey,JSON.stringify({method:e,params:t}))).then(function(e){var t={kind:23194,created_at:Math.floor(Date.now()/1e3),tags:[["p",o.walletPubkey],["v","nip44_v2"===o.encryptionType?"1.0":"0.0"],["encryption",o.encryptionType]],content:e};return Promise.resolve(o.signEvent(t)).then(function(e){var t=o.relay.subscribe([{kinds:[23195],authors:[o.walletPubkey],"#e":[e.id]}],{}),u=setTimeout(function(){t.close(),c(new E("reply timeout: event "+e.id,"INTERNAL"))},(null==i?void 0:i.replyTimeout)||6e4);t.onevent=function(e){try{return Promise.resolve(o.decrypt(o.walletPubkey,e.content)).then(function(i){try{f=JSON.parse(i)}catch(e){clearTimeout(u),t.close(),c(new B("failed to deserialize response","INTERNAL"))}if(f.result){if(!n(f.result))return clearTimeout(u),t.close(),void c(new k("Response from NWC failed validation: "+JSON.stringify(f.result),"INTERNAL"));var o,h,f,d,p=null==(d=e.tags.find(function(e){return"d"===e[0]}))?void 0:d[1];if(void 0===p)return clearTimeout(u),t.close(),void c(new k("No d tag found in response event","INTERNAL"));s.push(l({},f.result,{dTag:p})),s.length===r&&(clearTimeout(u),t.close(),a(s))}else clearTimeout(u),t.close(),c(new A(null==(o=f.error)?void 0:o.message,null==(h=f.error)?void 0:h.code))})}catch(e){return Promise.reject(e)}};var h=setTimeout(function(){t.close(),c(new x("Publish timeout: "+e.id,"INTERNAL"))},(null==i?void 0:i.publishTimeout)||5e3),f=T(function(){return Promise.resolve(o.relay.publish(e)).then(function(){clearTimeout(h)})},function(e){clearTimeout(h),c(new P("Failed to publish: "+e,"INTERNAL"))});if(f&&f.then)return f.then(function(){})})})}catch(e){Promise.reject(e)}})})})}catch(e){return Promise.reject(e)}},t._checkConnected=function(){try{var e=this;if(!e.secret)throw Error("Missing secret key");if(!e.relayUrl)throw Error("Missing relay url");return Promise.resolve(T(function(){var t=function(){if(!e.relay.connected)return Promise.resolve(e.relay.connect()).then(function(){})}();if(t&&t.then)return t.then(function(){})},function(){throw console.error("failed to connect to relay",e.relayUrl),new m("Failed to connect to "+e.relayUrl,"OTHER")}))}catch(e){return Promise.reject(e)}},t._selectEncryptionType=function(){try{var e=this;return Promise.resolve(function(){if(!e._encryptionType)return Promise.resolve(e.getWalletServiceInfo()).then(function(t){var r=e._findPreferredEncryptionType(t.encryptions);if(!r)throw new S("no compatible encryption or version found between wallet and client","UNSUPPORTED_ENCRYPTION");"nip04"===r&&console.warn("NIP-04 encryption is about to be deprecated. Please upgrade your wallet service to use NIP-44 instead."),e._encryptionType=r})}())}catch(e){return Promise.reject(e)}},t._findPreferredEncryptionType=function(e){return e.includes("nip44_v2")?"nip44_v2":e.includes("nip04")?"nip04":null},a(e,[{key:"nostrWalletConnectUrl",get:function(){return this.getNostrWalletConnectUrl()}},{key:"connected",get:function(){return this.relay.connected}},{key:"publicKey",get:function(){if(!this.secret)throw Error("Missing secret key");return(0,n.getPublicKey)(g(this.secret))}},{key:"encryptionType",get:function(){if(!this._encryptionType)throw Error("Missing encryption or version");return this._encryptionType}}]),e}();function $(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}function L(e,t,r){if(!e.s){if(r instanceof N){if(!r.s)return void(r.o=L.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(L.bind(null,e,t),L.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}var N=function(){function e(){}return e.prototype.then=function(t,r){var n=new e,i=this.s;if(i){var o=1&i?t:r;if(o){try{L(n,1,o(this.v))}catch(e){L(n,2,e)}return n}return this}return this.o=function(e){try{var i=e.v;1&e.s?L(n,1,t?t(i):i):r?L(n,1,r(i)):L(n,2,i)}catch(e){L(n,2,e)}},n},e}();function R(e){return e instanceof N&&1&e.s}var O=function(){function e(e){if(this.options=void 0,this.appSecretKey=void 0,this.relay=void 0,this.appSecretKey=e.appSecretKey||y((0,n.generateSecretKey)()),this.options=l({},e,{appPubkey:(0,n.getPublicKey)(g(this.appSecretKey))}),!this.options.relayUrl)throw Error("Missing relay url");if(!this.options.requestMethods)throw Error("Missing request methods");this.relay=new(0,n.Relay)(this.options.relayUrl),void 0===globalThis.WebSocket&&console.error("WebSocket is undefined. Make sure to `import websocket-polyfill` for nodejs environments")}var t=e.prototype;return t.getConnectionUri=function(e){void 0===e&&(e="");var t=new URLSearchParams(l({relay:this.options.relayUrl,request_methods:this.options.requestMethods.join(" ")},this.options.name?{name:this.options.name}:{},this.options.icon?{icon:this.options.icon}:{},this.options.returnTo?{return_to:this.options.returnTo}:{},this.options.notificationTypes?{notification_types:this.options.notificationTypes.join(" ")}:{},this.options.maxAmount?{max_amount:this.options.maxAmount.toString()}:{},this.options.budgetRenewal?{budget_renewal:this.options.budgetRenewal}:{},this.options.expiresAt?{expires_at:this.options.expiresAt.toString()}:{},this.options.isolated?{isolated:this.options.isolated.toString()}:{},this.options.metadata?{metadata:JSON.stringify(this.options.metadata)}:{}));return"nostr+walletauth"+(e?"+"+e:"")+"://"+this.options.appPubkey+"?"+t.toString().replace(/\+/g,"%20")},e.parseWalletAuthUrl=function(e){if(!e.startsWith("nostr+walletauth"))throw Error("Unexpected scheme. Should be nostr+walletauth:// or nostr+walletauth+specificapp://");var t,r,n=e.indexOf(":");(e=e.substring(n+1)).startsWith("//")&&(e=e.substring(2));var i=new URL(e="http://"+e),o=i.host;if(64!==(null==o?void 0:o.length))throw Error("Incorrect app pubkey found in auth string");var s=i.searchParams.get("relay");if(!s)throw Error("No relay URL found in auth string");var a=null==(t=i.searchParams.get("request_methods"))?void 0:t.split(" ");if(null==a||!a.length)throw Error("No request methods found in auth string");var l=null==(r=i.searchParams.get("notification_types"))?void 0:r.split(" "),c=i.searchParams.get("max_amount"),u=i.searchParams.get("expires_at"),h=i.searchParams.get("metadata");return{name:i.searchParams.get("name")||void 0,icon:i.searchParams.get("icon")||void 0,returnTo:i.searchParams.get("return_to")||void 0,relayUrl:s,appPubkey:o,requestMethods:a,notificationTypes:l,budgetRenewal:i.searchParams.get("budget_renewal"),expiresAt:u?parseInt(u):void 0,maxAmount:c?parseInt(c):void 0,isolated:"true"===i.searchParams.get("isolated"),metadata:h?JSON.parse(h):void 0}},t.subscribe=function(e){try{var t,r,n=this,i=!0;return function(){try{var o=function(e,t,r){for(var n;;){var i=e();if(R(i)&&(i=i.v),!i)return o;if(i.then){n=0;break}var o=r();if(o&&o.then){if(!R(o)){n=1;break}o=o.s}}var s=new N,a=L.bind(null,s,2);return(0===n?i.then(c):1===n?o.then(l):(void 0).then(function(){(i=e())?i.then?i.then(c).then(void 0,a):c(i):L(s,1,o)})).then(void 0,a),s;function l(t){o=t;do{if(!(i=e())||R(i)&&!i.v)return void L(s,1,o);if(i.then)return void i.then(c).then(void 0,a);R(o=r())&&(o=o.v)}while(!o||!o.then)o.then(l).then(void 0,a)}function c(e){e?(o=r())&&o.then?o.then(l).then(void 0,a):l(o):L(s,1,o)}}(function(){return!!i},0,function(){function o(){var e=function(){if(i)return Promise.resolve(new Promise(function(e){return setTimeout(e,1e3)})).then(function(){})}();if(e&&e.then)return e.then(function(){})}var s=$(function(){return Promise.resolve(n._checkConnected()).then(function(){var i=n.relay.subscribe([{kinds:[13194],"#p":[n.options.appPubkey]}],{});return console.info("subscribed to relay"),i.onevent=function(t){try{var r=function(){e.onSuccess(o),i.close(),n.relay.close()},o=new U({relayUrl:n.options.relayUrl,secret:n.appSecretKey,walletPubkey:t.pubkey}),s=$(function(){return Promise.resolve(o.getInfo()).then(function(e){o.options.lud16=e.lud16,o.lud16=e.lud16})},function(e){console.error("failed to fetch get_info",e)});return Promise.resolve(s&&s.then?s.then(r):r())}catch(e){return Promise.reject(e)}},Promise.resolve(new Promise(function(e){t=function(){e()},n.relay.onclose=r=function(){console.info("relay disconnected"),null==t||t()}})).then(function(){void 0!==r&&(n.relay.onclose=null)})})},function(e){console.error("error subscribing to info event",e||"unknown relay error")});return s&&s.then?s.then(o):o()});o&&o.then&&o.then(function(){})}catch(e){Promise.reject(e)}}(),Promise.resolve({unsub:function(){i=!1,null==t||t()}})}catch(e){return Promise.reject(e)}},t._checkConnected=function(){try{var e=this;if(!e.appSecretKey)throw Error("Missing secret key");if(!e.options.relayUrl)throw Error("Missing relay url");return Promise.resolve($(function(){var t=function(){if(!e.relay.connected)return Promise.resolve(e.relay.connect()).then(function(){})}();if(t&&t.then)return t.then(function(){})},function(){throw console.error("failed to connect to relay",e.options.relayUrl),new m("Failed to connect to "+e.options.relayUrl,"OTHER")}))}catch(e){return Promise.reject(e)}},a(e,[{key:"connectionUri",get:function(){return this.getConnectionUri()}}]),e}();function D(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}function M(e,t,r){if(!e.s){if(r instanceof H){if(!r.s)return void(r.o=M.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(M.bind(null,e,t),M.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}var H=function(){function e(){}return e.prototype.then=function(t,r){var n=new e,i=this.s;if(i){var o=1&i?t:r;if(o){try{M(n,1,o(this.v))}catch(e){M(n,2,e)}return n}return this}return this.o=function(e){try{var i=e.v;1&e.s?M(n,1,t?t(i):i):r?M(n,1,r(i)):M(n,2,i)}catch(e){M(n,2,e)}},n},e}();function j(e){return e instanceof H&&1&e.s}var W=function(){function e(e){this.relay=void 0,this.relayUrl=void 0,this.relayUrl=e.relayUrl,this.relay=new(0,n.Relay)(this.relayUrl),void 0===globalThis.WebSocket&&console.error("WebSocket is undefined. Make sure to `import websocket-polyfill` for nodejs environments")}var t=e.prototype;return t.publishWalletServiceInfoEvent=function(e,t,r){try{var n=this;return Promise.resolve(D(function(){return Promise.resolve(n._checkConnected()).then(function(){var i={kind:13194,created_at:Math.floor(Date.now()/1e3),tags:[["encryption","nip04 nip44_v2"],["notifications",r.join(" ")]],content:t.join(" ")};return Promise.resolve(n.signEvent(i,e)).then(function(e){return Promise.resolve(n.relay.publish(e)).then(function(){})})})},function(e){throw console.error("failed to publish wallet service info event",e),e}))}catch(e){return Promise.reject(e)}},t.subscribe=function(e,t){try{var r,n,i,o=this,s=!0;return function(){try{var a=function(e,t,r){for(var n;;){var i=e();if(j(i)&&(i=i.v),!i)return o;if(i.then){n=0;break}var o=r();if(o&&o.then){if(!j(o)){n=1;break}o=o.s}}var s=new H,a=M.bind(null,s,2);return(0===n?i.then(c):1===n?o.then(l):(void 0).then(function(){(i=e())?i.then?i.then(c).then(void 0,a):c(i):M(s,1,o)})).then(void 0,a),s;function l(t){o=t;do{if(!(i=e())||j(i)&&!i.v)return void M(s,1,o);if(i.then)return void i.then(c).then(void 0,a);j(o=r())&&(o=o.v)}while(!o||!o.then)o.then(l).then(void 0,a)}function c(e){e?(o=r())&&o.then?o.then(l).then(void 0,a):l(o):M(s,1,o)}}(function(){return!!s},0,function(){function a(){var e=function(){if(s)return Promise.resolve(new Promise(function(e){return setTimeout(e,1e3)})).then(function(){})}();if(e&&e.then)return e.then(function(){})}var c=D(function(){return console.info("checking connection to relay"),Promise.resolve(o._checkConnected()).then(function(){return console.info("subscribing to relay"),i=o.relay.subscribe([{kinds:[23194],authors:[e.clientPubkey],"#p":[e.walletPubkey]}],{}),console.info("subscribed to relay"),i.onevent=function(r){try{var n=D(function(){var n,i=(null==(n=r.tags.find(function(e){return"encryption"===e[0]}))?void 0:n[1])||"nip04";return Promise.resolve(o.decrypt(e,r.content,i)).then(function(n){var s,a=JSON.parse(n);switch(a.method){case"get_info":s=null==t.getInfo?void 0:t.getInfo();break;case"make_invoice":s=null==t.makeInvoice?void 0:t.makeInvoice(a.params);break;case"pay_invoice":s=null==t.payInvoice?void 0:t.payInvoice(a.params);break;case"pay_keysend":s=null==t.payKeysend?void 0:t.payKeysend(a.params);break;case"get_balance":s=null==t.getBalance?void 0:t.getBalance();break;case"lookup_invoice":s=null==t.lookupInvoice?void 0:t.lookupInvoice(a.params);break;case"list_transactions":s=null==t.listTransactions?void 0:t.listTransactions(a.params);break;case"sign_message":s=null==t.signMessage?void 0:t.signMessage(a.params)}return Promise.resolve(s).then(function(t){t||(console.warn("received unsupported method",a.method),t={error:{code:"NOT_IMPLEMENTED",message:"This method is not supported by the wallet service"},result:void 0});var n=[["e",r.id]],s=Math.floor(Date.now()/1e3);return Promise.resolve(o.encrypt(e,JSON.stringify(l({result_type:a.method},t)),i)).then(function(t){return Promise.resolve(o.signEvent({kind:23195,created_at:s,tags:n,content:t},e.walletSecret)).then(function(e){return Promise.resolve(o.relay.publish(e)).then(function(){})})})})})},function(e){console.error("Failed to parse decrypted event content",e)});return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},Promise.resolve(new Promise(function(e){r=function(){e()},o.relay.onclose=n=function(){console.error("relay disconnected"),null==r||r()}})).then(function(){void 0!==n&&(o.relay.onclose=null)})})},function(e){console.error("error subscribing to requests",e||"unknown relay error")});return c&&c.then?c.then(a):a()});a&&a.then&&a.then(function(){})}catch(e){Promise.reject(e)}}(),Promise.resolve(function(){var e;s=!1,null==r||r(),null==(e=i)||e.close()})}catch(e){return Promise.reject(e)}},t.signEvent=function(e,t){return Promise.resolve((0,n.finalizeEvent)(e,g(t)))},t.close=function(){return this.relay.close()},t.encrypt=function(e,t,r){try{var i,o=function(){if("nip04"===r)return Promise.resolve(n.nip04.encrypt(e.walletSecret,e.clientPubkey,t)).then(function(e){i=e});var o=n.nip44.getConversationKey(g(e.walletSecret),e.clientPubkey);i=n.nip44.encrypt(t,o)}();return Promise.resolve(o&&o.then?o.then(function(){return i}):i)}catch(e){return Promise.reject(e)}},t.decrypt=function(e,t,r){try{var i,o=function(){if("nip04"===r)return Promise.resolve(n.nip04.decrypt(e.walletSecret,e.clientPubkey,t)).then(function(e){i=e});var o=n.nip44.getConversationKey(g(e.walletSecret),e.clientPubkey);i=n.nip44.decrypt(t,o)}();return Promise.resolve(o&&o.then?o.then(function(){return i}):i)}catch(e){return Promise.reject(e)}},t._checkConnected=function(){try{var e=this;if(!e.relayUrl)throw Error("Missing relay url");return Promise.resolve(D(function(){var t=function(){if(!e.relay.connected)return Promise.resolve(e.relay.connect()).then(function(){})}();if(t&&t.then)return t.then(function(){})},function(){throw console.error("failed to connect to relay",e.relayUrl),new m("Failed to connect to "+e.relayUrl,"OTHER")}))}catch(e){return Promise.reject(e)}},a(e,[{key:"connected",get:function(){return this.relay.connected}}]),e}(),F={__proto__:null,Nip47Error:b,Nip47NetworkError:m,Nip47WalletError:v,Nip47TimeoutError:w,Nip47PublishTimeoutError:x,Nip47ReplyTimeoutError:E,Nip47PublishError:P,Nip47ResponseDecodingError:B,Nip47ResponseValidationError:k,Nip47UnexpectedResponseError:A,Nip47UnsupportedEncryptionError:S,NWCClient:U,NWAClient:O,NWCWalletServiceKeyPair:function(e,t){if(this.walletSecret=void 0,this.walletPubkey=void 0,this.clientPubkey=void 0,this.walletSecret=e,this.clientPubkey=t,!this.walletSecret)throw Error("Missing wallet secret key");if(!this.clientPubkey)throw Error("Missing client pubkey");this.walletPubkey=(0,n.getPublicKey)(g(this.walletSecret))},NWCWalletService:W};function q(e,t,r){if(!e.s){if(r instanceof z){if(!r.s)return void(r.o=q.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(q.bind(null,e,t),q.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}var z=function(){function e(){}return e.prototype.then=function(t,r){var n=new e,i=this.s;if(i){var o=1&i?t:r;if(o){try{q(n,1,o(this.v))}catch(e){q(n,2,e)}return n}return this}return this.o=function(e){try{var i=e.v;1&e.s?q(n,1,t?t(i):i):r?q(n,1,r(i)):q(n,2,i)}catch(e){q(n,2,e)}},n},e}();function K(e){return e instanceof z&&1&e.s}}),o("fS6LT",function(t,r){e(t.exports,"getEventHash",()=>C),e(t.exports,"generateSecretKey",()=>_),e(t.exports,"getPublicKey",()=>U),e(t.exports,"finalizeEvent",()=>$),e(t.exports,"Relay",()=>th),e(t.exports,"nip19",()=>tf),e(t.exports,"nip04",()=>tT),e(t.exports,"nip44",()=>tq);var n,o,s,a,l=i("5r7db"),c=i("3Bcdj"),u=i("6XnWx"),h=i("4Dsex"),f=i("3RPiR"),d=i("lAjhr"),p=i("38xio"),y=i("aN9nT"),g=i("70Xw9"),b=Object.defineProperty,m=(e,t)=>{for(var r in t)b(e,r,{get:t[r],enumerable:!0})},v=Symbol("verified");function w(e){if(!(e instanceof Object)||"number"!=typeof e.kind||"string"!=typeof e.content||"number"!=typeof e.created_at||"string"!=typeof e.pubkey||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let r=e.tags[t];if(!Array.isArray(r))return!1;for(let e=0;e<r.length;e++)if("string"!=typeof r[e])return!1}return!0}m({},{Queue:()=>T,QueueNode:()=>S,binarySearch:()=>A,bytesToHex:()=>c.bytesToHex,hexToBytes:()=>c.hexToBytes,insertEventIntoAscendingList:()=>k,insertEventIntoDescendingList:()=>B,normalizeURL:()=>P,utf8Decoder:()=>x,utf8Encoder:()=>E});var x=new TextDecoder("utf-8"),E=new TextEncoder;function P(e){try{-1===e.indexOf("://")&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),("80"===t.port&&"ws:"===t.protocol||"443"===t.port&&"wss:"===t.protocol)&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch(t){throw Error(`Invalid URL: ${e}`)}}function B(e,t){let[r,n]=A(e,e=>t.id===e.id?0:t.created_at===e.created_at?-1:e.created_at-t.created_at);return n||e.splice(r,0,t),e}function k(e,t){let[r,n]=A(e,e=>t.id===e.id?0:t.created_at===e.created_at?-1:t.created_at-e.created_at);return n||e.splice(r,0,t),e}function A(e,t){let r=0,n=e.length-1;for(;r<=n;){let i=Math.floor((r+n)/2),o=t(e[i]);if(0===o)return[i,!0];o<0?n=i-1:r=i+1}return[r,!1]}var S=class{value;next=null;prev=null;constructor(e){this.value=e}},T=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){let t=new S(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){let e=this.first;return this.first=null,this.last=null,e.value}let e=this.first;return this.first=e.next,this.first&&(this.first.prev=null),e.value}};function C(e){let t=(0,u.sha256)(E.encode(function(e){if(!w(e))throw Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}(e)));return(0,c.bytesToHex)(t)}var I=new class{generateSecretKey(){return l.schnorr.utils.randomPrivateKey()}getPublicKey(e){return(0,c.bytesToHex)(l.schnorr.getPublicKey(e))}finalizeEvent(e,t){return e.pubkey=(0,c.bytesToHex)(l.schnorr.getPublicKey(t)),e.id=C(e),e.sig=(0,c.bytesToHex)(l.schnorr.sign(C(e),t)),e[v]=!0,e}verifyEvent(e){if("boolean"==typeof e[v])return e[v];let t=C(e);if(t!==e.id)return e[v]=!1,!1;try{let r=l.schnorr.verify(e.sig,t,e.pubkey);return e[v]=r,r}catch(t){return e[v]=!1,!1}}},_=I.generateSecretKey,U=I.getPublicKey,$=I.finalizeEvent,L=I.verifyEvent;function N(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function R(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function O(e){return 2e4<=e&&e<3e4}function D(e){return 3e4<=e&&e<4e4}function M(e){return N(e)?"regular":R(e)?"replaceable":O(e)?"ephemeral":D(e)?"parameterized":"unknown"}function H(e,t){let r=t instanceof Array?t:[t];return w(e)&&r.includes(e.kind)||!1}m({},{Application:()=>eX,BadgeAward:()=>G,BadgeDefinition:()=>ez,BlockedRelaysList:()=>eA,BookmarkList:()=>eP,Bookmarksets:()=>eW,Calendar:()=>e4,CalendarEventRSVP:()=>e6,ChannelCreation:()=>Q,ChannelHideMessage:()=>er,ChannelMessage:()=>et,ChannelMetadata:()=>ee,ChannelMuteUser:()=>en,ClassifiedListing:()=>e1,ClientAuth:()=>eL,CommunitiesList:()=>eB,CommunityDefinition:()=>e9,CommunityPostApproval:()=>ef,Contacts:()=>q,CreateOrUpdateProduct:()=>eJ,CreateOrUpdateStall:()=>eV,Curationsets:()=>eF,Date:()=>e3,DirectMessageRelaysList:()=>eI,DraftClassifiedListing:()=>e2,DraftLong:()=>eZ,Emojisets:()=>eY,EncryptedDirectMessage:()=>z,EventDeletion:()=>K,FileMetadata:()=>es,FileServerPreference:()=>e_,Followsets:()=>eM,GenericRepost:()=>X,Genericlists:()=>eH,GiftWrap:()=>eo,HTTPAuth:()=>eD,Handlerinformation:()=>e7,Handlerrecommendation:()=>e5,Highlights:()=>ev,InterestsList:()=>eT,Interestsets:()=>eK,JobFeedback:()=>ey,JobRequest:()=>ed,JobResult:()=>ep,Label:()=>eh,LightningPubRPC:()=>e$,LiveChatMessage:()=>ea,LiveEvent:()=>eQ,LongFormArticle:()=>eG,Metadata:()=>j,Mutelist:()=>ew,NWCWalletInfo:()=>eU,NWCWalletRequest:()=>eN,NWCWalletResponse:()=>eR,NostrConnect:()=>eO,OpenTimestamps:()=>ei,Pinlist:()=>ex,PrivateDirectMessage:()=>Y,ProblemTracker:()=>el,ProfileBadges:()=>eq,PublicChatsList:()=>ek,Reaction:()=>J,RecommendRelay:()=>F,RelayList:()=>eE,Relaysets:()=>ej,Report:()=>ec,Reporting:()=>eu,Repost:()=>V,Seal:()=>Z,SearchRelaysList:()=>eS,ShortTextNote:()=>W,Time:()=>e8,UserEmojiList:()=>eC,UserStatuses:()=>e0,Zap:()=>em,ZapGoal:()=>eg,ZapRequest:()=>eb,classifyKind:()=>M,isAddressableKind:()=>D,isEphemeralKind:()=>O,isKind:()=>H,isRegularKind:()=>N,isReplaceableKind:()=>R});var j=0,W=1,F=2,q=3,z=4,K=5,V=6,J=7,G=8,Z=13,Y=14,X=16,Q=40,ee=41,et=42,er=43,en=44,ei=1040,eo=1059,es=1063,ea=1311,el=1971,ec=1984,eu=1984,eh=1985,ef=4550,ed=5999,ep=6999,ey=7e3,eg=9041,eb=9734,em=9735,ev=9802,ew=1e4,ex=10001,eE=10002,eP=10003,eB=10004,ek=10005,eA=10006,eS=10007,eT=10015,eC=10030,eI=10050,e_=10096,eU=13194,e$=21e3,eL=22242,eN=23194,eR=23195,eO=24133,eD=27235,eM=3e4,eH=30001,ej=30002,eW=30003,eF=30004,eq=30008,ez=30009,eK=30015,eV=30017,eJ=30018,eG=30023,eZ=30024,eY=30030,eX=30078,eQ=30311,e0=30315,e1=30402,e2=30403,e3=31922,e8=31923,e4=31924,e6=31925,e5=31989,e7=31990,e9=34550;function te(e,t){let r=t.length+3,n=e.indexOf(`"${t}":`)+r,i=e.slice(n).indexOf('"')+n+1;return e.slice(i,i+64)}function tt(e,t){let r=t.length,n=e.indexOf(`"${t}":`)+r+3,i=e.slice(n),o=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,o),10)}function tr(e){let t=e.slice(0,22).indexOf('"EVENT"');if(-1===t)return null;let r=e.slice(t+7+1).indexOf('"');if(-1===r)return null;let n=t+7+1+r,i=e.slice(n+1,80).indexOf('"');return -1===i?null:e.slice(n+1,n+1+i)}function tn(e,t){return t===te(e,"id")}function ti(e,t){return t===te(e,"pubkey")}function to(e,t){return t===tt(e,"kind")}function ts(e,t){return{kind:eL,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function ta(){return new Promise(e=>{let t=new MessageChannel,r=()=>{t.port1.removeEventListener("message",r),e()};t.port1.addEventListener("message",r),t.port2.postMessage(0),t.port1.start()})}m({},{getHex64:()=>te,getInt:()=>tt,getSubscriptionId:()=>tr,matchEventId:()=>tn,matchEventKind:()=>to,matchEventPubkey:()=>ti}),m({},{makeAuthEvent:()=>ts});var tl=class extends Error{constructor(e,t){super(`Tried to send message '${e} on a closed connection to ${t}.`),this.name="SendingOnClosedConnection"}},tc=class{url;_connected=!1;onclose=null;onnotice=e=>console.debug(`NOTICE from ${this.url}: ${e}`);baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new T;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(e,t){this.url=P(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket}static async connect(e,t){let r=new tc(e,t);return await r.connect(),r}closeAllSubscriptions(e){for(let[t,r]of this.openSubs)r.close(e);for(let[t,r]of(this.openSubs.clear(),this.openEventPublishes))r.reject(Error(e));for(let[t,r]of(this.openEventPublishes.clear(),this.openCountRequests))r.reject(Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((e,t)=>{this.connectionTimeoutHandle=setTimeout(()=>{t("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(e){clearTimeout(this.connectionTimeoutHandle),t(e);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=e=>{clearTimeout(this.connectionTimeoutHandle),t(e.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=e=>{clearTimeout(this.connectionTimeoutHandle),t(e.message||"websocket closed"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)})),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;!1!==this.handleNext();)await ta();this.queueRunning=!1}handleNext(){let e=this.incomingMessageQueue.dequeue();if(!e)return!1;let t=tr(e);if(t){let r=this.openSubs.get(t);if(!r)return;let n=te(e,"id"),i=r.alreadyHaveEvent?.(n);if(r.receivedEvent?.(this,n),i)return}try{let t=JSON.parse(e);switch(t[0]){case"EVENT":{let e=this.openSubs.get(t[1]),r=t[2];this.verifyEvent(r)&&function(e,t){for(let r=0;r<e.length;r++)if(function(e,t){if(e.ids&&-1===e.ids.indexOf(t.id)||e.kinds&&-1===e.kinds.indexOf(t.kind)||e.authors&&-1===e.authors.indexOf(t.pubkey))return!1;for(let r in e)if("#"===r[0]){let n=r.slice(1),i=e[`#${n}`];if(i&&!t.tags.find(([e,t])=>e===r.slice(1)&&-1!==i.indexOf(t)))return!1}return(!e.since||!(t.created_at<e.since))&&(!e.until||!(t.created_at>e.until))}(e[r],t))return!0;return!1}(e.filters,r)&&e.onevent(r);return}case"COUNT":{let e=t[1],r=t[2],n=this.openCountRequests.get(e);n&&(n.resolve(r.count),this.openCountRequests.delete(e));return}case"EOSE":{let e=this.openSubs.get(t[1]);if(!e)return;e.receivedEose();return}case"OK":{let e=t[1],r=t[2],n=t[3],i=this.openEventPublishes.get(e);i&&(clearTimeout(i.timeout),r?i.resolve(n):i.reject(Error(n)),this.openEventPublishes.delete(e));return}case"CLOSED":{let e=t[1],r=this.openSubs.get(e);if(!r)return;r.closed=!0,r.close(t[2]);return}case"NOTICE":this.onnotice(t[1]);return;case"AUTH":this.challenge=t[1];return}}catch(e){return}}async send(e){if(!this.connectionPromise)throw new tl(e,this.url);this.connectionPromise.then(()=>{this.ws?.send(e)})}async auth(e){let t=this.challenge;if(!t)throw Error("can't perform auth, no challenge was received");return this.authPromise||(this.authPromise=new Promise(async(r,n)=>{try{let i=await e(ts(this.url,t)),o=setTimeout(()=>{let e=this.openEventPublishes.get(i.id);e&&(e.reject(Error("auth timed out")),this.openEventPublishes.delete(i.id))},this.publishTimeout);this.openEventPublishes.set(i.id,{resolve:r,reject:n,timeout:o}),this.send('["AUTH",'+JSON.stringify(i)+"]")}catch(e){console.warn("subscribe auth function failed:",e)}})),this.authPromise}async publish(e){let t=new Promise((t,r)=>{let n=setTimeout(()=>{let t=this.openEventPublishes.get(e.id);t&&(t.reject(Error("publish timed out")),this.openEventPublishes.delete(e.id))},this.publishTimeout);this.openEventPublishes.set(e.id,{resolve:t,reject:r,timeout:n})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;let r=t?.id||"count:"+this.serial,n=new Promise((e,t)=>{this.openCountRequests.set(r,{resolve:e,reject:t})});return this.send('["COUNT","'+r+'",'+JSON.stringify(e).substring(1)),n}subscribe(e,t){let r=this.prepareSubscription(e,t);return r.fire(),r}prepareSubscription(e,t){this.serial++;let r=t.id||(t.label?t.label+":":"sub:")+this.serial,n=new tu(this,r,e,t);return this.openSubs.set(r,n),n}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},tu=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(e,t,r,n){this.relay=e,this.filters=r,this.id=t,this.alreadyHaveEvent=n.alreadyHaveEvent,this.receivedEvent=n.receivedEvent,this.eoseTimeout=n.eoseTimeout||e.baseEoseTimeout,this.oneose=n.oneose,this.onclose=n.onclose,this.onevent=n.onevent||(e=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,e)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(e="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(e){if(e instanceof tl);else throw e}this.closed=!0}this.relay.openSubs.delete(this.id),this.onclose?.(e)}};try{n=WebSocket}catch{}var th=class extends tc{constructor(e){super(e,{verifyEvent:L,websocketImplementation:n})}static async connect(e){let t=new th(e);return await t.connect(),t}};try{WebSocket}catch{}var tf={};m(tf,{BECH32_REGEX:()=>ty,Bech32MaxSize:()=>tp,NostrTypeGuard:()=>td,decode:()=>tb,decodeNostrURI:()=>tg,encodeBytes:()=>tP,naddrEncode:()=>tA,neventEncode:()=>tk,noteEncode:()=>tx,nprofileEncode:()=>tB,npubEncode:()=>tw,nsecEncode:()=>tv});var td={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},tp=5e3,ty=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function tg(e){try{return e.startsWith("nostr:")&&(e=e.substring(6)),tb(e)}catch(e){return{type:"invalid",data:null}}}function tb(e){let{prefix:t,words:r}=h.bech32.decode(e,tp),n=new Uint8Array(h.bech32.fromWords(r));switch(t){case"nprofile":{let e=tm(n);if(!e[0]?.[0])throw Error("missing TLV 0 for nprofile");if(32!==e[0][0].length)throw Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:(0,c.bytesToHex)(e[0][0]),relays:e[1]?e[1].map(e=>x.decode(e)):[]}}}case"nevent":{let e=tm(n);if(!e[0]?.[0])throw Error("missing TLV 0 for nevent");if(32!==e[0][0].length)throw Error("TLV 0 should be 32 bytes");if(e[2]&&32!==e[2][0].length)throw Error("TLV 2 should be 32 bytes");if(e[3]&&4!==e[3][0].length)throw Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:(0,c.bytesToHex)(e[0][0]),relays:e[1]?e[1].map(e=>x.decode(e)):[],author:e[2]?.[0]?(0,c.bytesToHex)(e[2][0]):void 0,kind:e[3]?.[0]?parseInt((0,c.bytesToHex)(e[3][0]),16):void 0}}}case"naddr":{let e=tm(n);if(!e[0]?.[0])throw Error("missing TLV 0 for naddr");if(!e[2]?.[0])throw Error("missing TLV 2 for naddr");if(32!==e[2][0].length)throw Error("TLV 2 should be 32 bytes");if(!e[3]?.[0])throw Error("missing TLV 3 for naddr");if(4!==e[3][0].length)throw Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:x.decode(e[0][0]),pubkey:(0,c.bytesToHex)(e[2][0]),kind:parseInt((0,c.bytesToHex)(e[3][0]),16),relays:e[1]?e[1].map(e=>x.decode(e)):[]}}}case"nsec":return{type:t,data:n};case"npub":case"note":return{type:t,data:(0,c.bytesToHex)(n)};default:throw Error(`unknown prefix ${t}`)}}function tm(e){let t={},r=e;for(;r.length>0;){let e=r[0],n=r[1],i=r.slice(2,2+n);if(r=r.slice(2+n),i.length<n)throw Error(`not enough data to read on TLV ${e}`);t[e]=t[e]||[],t[e].push(i)}return t}function tv(e){return tE("nsec",e)}function tw(e){return tE("npub",(0,c.hexToBytes)(e))}function tx(e){return tE("note",(0,c.hexToBytes)(e))}function tE(e,t){let r=h.bech32.toWords(t);return h.bech32.encode(e,r,tp)}function tP(e,t){return tE(e,t)}function tB(e){return tE("nprofile",tS({0:[(0,c.hexToBytes)(e.pubkey)],1:(e.relays||[]).map(e=>E.encode(e))}))}function tk(e){let t;return void 0!==e.kind&&(t=function(e){let t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=255&e,t}(e.kind)),tE("nevent",tS({0:[(0,c.hexToBytes)(e.id)],1:(e.relays||[]).map(e=>E.encode(e)),2:e.author?[(0,c.hexToBytes)(e.author)]:[],3:t?[new Uint8Array(t)]:[]}))}function tA(e){let t=new ArrayBuffer(4);return new DataView(t).setUint32(0,e.kind,!1),tE("naddr",tS({0:[E.encode(e.identifier)],1:(e.relays||[]).map(e=>E.encode(e)),2:[(0,c.hexToBytes)(e.pubkey)],3:[new Uint8Array(t)]}))}function tS(e){let t=[];return Object.entries(e).reverse().forEach(([e,r])=>{r.forEach(r=>{let n=new Uint8Array(r.length+2);n.set([parseInt(e)],0),n.set([r.length],1),n.set(r,2),t.push(n)})}),(0,c.concatBytes)(...t)}var tT={};function tC(e,t,r){let n=e instanceof Uint8Array?(0,c.bytesToHex)(e):e,i=t_(l.secp256k1.getSharedSecret(n,"02"+t)),o=Uint8Array.from((0,c.randomBytes)(16)),s=E.encode(r),a=(0,f.cbc)(i,o).encrypt(s),u=h.base64.encode(new Uint8Array(a)),d=h.base64.encode(new Uint8Array(o.buffer));return`${u}?iv=${d}`}function tI(e,t,r){let n=e instanceof Uint8Array?(0,c.bytesToHex)(e):e,[i,o]=r.split("?iv="),s=t_(l.secp256k1.getSharedSecret(n,"02"+t)),a=h.base64.decode(o),u=h.base64.decode(i),d=(0,f.cbc)(s,a).decrypt(u);return x.decode(d)}function t_(e){return e.slice(1,33)}m(tT,{decrypt:()=>tI,encrypt:()=>tC}),m({},{NIP05_REGEX:()=>tU,isNip05:()=>t$,isValid:()=>tO,queryProfile:()=>tR,searchDomain:()=>tN,useFetchImplementation:()=>tL});var tU=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,t$=e=>tU.test(e||"");try{o=fetch}catch(e){}function tL(e){o=e}async function tN(e,t=""){try{let r=`https://${e}/.well-known/nostr.json?name=${t}`,n=await o(r,{redirect:"manual"});if(200!==n.status)throw Error("Wrong response code");return(await n.json()).names}catch(e){return{}}}async function tR(e){let t=e.match(tU);if(!t)return null;let[,r="_",n]=t;try{let e=`https://${n}/.well-known/nostr.json?name=${r}`,t=await o(e,{redirect:"manual"});if(200!==t.status)throw Error("Wrong response code");let i=await t.json(),s=i.names[r];return s?{pubkey:s,relays:i.relays?.[s]}:null}catch(e){return null}}async function tO(e,t){let r=await tR(t);return!!r&&r.pubkey===e}function tD(e){let t,r,n={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};for(let i=e.tags.length-1;i>=0;i--){let o=e.tags[i];if("e"===o[0]&&o[1]){let[e,i,s,a,l]=o,c={id:i,relays:s?[s]:[],author:l};if("root"===a){n.root=c;continue}if("reply"===a){n.reply=c;continue}if("mention"===a){n.mentions.push(c);continue}t?r=c:t=c,n.mentions.push(c);continue}if("q"===o[0]&&o[1]){let[e,t,r]=o;n.quotes.push({id:t,relays:r?[r]:[]})}if("p"===o[0]&&o[1]){n.profiles.push({pubkey:o[1],relays:o[2]?[o[2]]:[]});continue}}return n.root||(n.root=r||t||n.reply),n.reply||(n.reply=t||n.root),[n.reply,n.root].forEach(e=>{if(!e)return;let t=n.mentions.indexOf(e);if(-1!==t&&n.mentions.splice(t,1),e.author){let t=n.profiles.find(t=>t.pubkey===e.author);t&&t.relays&&(e.relays||(e.relays=[]),t.relays.forEach(t=>{e.relays?.indexOf(t)===-1&&e.relays.push(t)}),t.relays=e.relays)}}),n.mentions.forEach(e=>{if(e.author){let t=n.profiles.find(t=>t.pubkey===e.author);t&&t.relays&&(e.relays||(e.relays=[]),t.relays.forEach(t=>{-1===e.relays.indexOf(t)&&e.relays.push(t)}),t.relays=e.relays)}}),n}m({},{parse:()=>tD}),m({},{fetchRelayInformation:()=>tH,useFetchImplementation:()=>tM});try{fetch}catch{}function tM(e){}async function tH(e){return await (await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}function tj(e){let t=0;for(let r=0;r<64;r+=8){let n=parseInt(e.substring(r,r+8),16);if(0===n)t+=32;else{t+=Math.clz32(n);break}}return t}function tW(e,t){let r=0,n=["nonce","0",t.toString()];for(e.tags.push(n);;){let i=Math.floor(new Date().getTime()/1e3);if(i!==e.created_at&&(r=0,e.created_at=i),n[1]=(++r).toString(),e.id=tF(e),tj(e.id)>=t)break}return e}function tF(e){return(0,c.bytesToHex)((0,u.sha256)(E.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}m({},{fastEventHash:()=>tF,getPow:()=>tj,minePow:()=>tW}),m({},{unwrapEvent:()=>rr,unwrapManyEvents:()=>rn,wrapEvent:()=>re,wrapManyEvents:()=>rt}),m({},{createRumor:()=>t3,createSeal:()=>t8,createWrap:()=>t4,unwrapEvent:()=>t7,unwrapManyEvents:()=>t9,wrapEvent:()=>t6,wrapManyEvents:()=>t5});var tq={};function tz(e,t){let r=l.secp256k1.getSharedSecret(e,"02"+t).subarray(1,33);return(0,y.extract)(u.sha256,r,"nip44-v2")}function tK(e,t){let r=(0,y.expand)(u.sha256,e,t,76);return{chacha_key:r.subarray(0,32),chacha_nonce:r.subarray(32,44),hmac_key:r.subarray(44,76)}}function tV(e){if(!Number.isSafeInteger(e)||e<1)throw Error("expected positive integer");if(e<=32)return 32;let t=1<<Math.floor(Math.log2(e-1))+1,r=t<=256?32:t/8;return r*(Math.floor((e-1)/r)+1)}function tJ(e,t,r){if(32!==r.length)throw Error("AAD associated data must be 32 bytes");let n=(0,c.concatBytes)(r,t);return(0,g.hmac)(u.sha256,e,n)}function tG(e,t,r=(0,c.randomBytes)(32)){let{chacha_key:n,chacha_nonce:i,hmac_key:o}=tK(t,r),s=function(e){let t=E.encode(e),r=t.length,n=function(e){if(!Number.isSafeInteger(e)||e<1||e>65535)throw Error("invalid plaintext size: must be between 1 and 65535 bytes");let t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}(r),i=new Uint8Array(tV(r)-r);return(0,c.concatBytes)(n,t,i)}(e),a=(0,d.chacha20)(n,i,s),l=tJ(o,a,r);return h.base64.encode((0,c.concatBytes)(new Uint8Array([2]),r,a,l))}function tZ(e,t){let{nonce:r,ciphertext:n,mac:i}=function(e){let t;if("string"!=typeof e)throw Error("payload must be a valid string");let r=e.length;if(r<132||r>87472)throw Error("invalid payload length: "+r);if("#"===e[0])throw Error("unknown encryption version");try{t=h.base64.decode(e)}catch(e){throw Error("invalid base64: "+e.message)}let n=t.length;if(n<99||n>65603)throw Error("invalid data length: "+n);let i=t[0];if(2!==i)throw Error("unknown encryption version "+i);return{nonce:t.subarray(1,33),ciphertext:t.subarray(33,-32),mac:t.subarray(-32)}}(e),{chacha_key:o,chacha_nonce:s,hmac_key:a}=tK(t,r),l=tJ(a,n,r);if(!(0,p.equalBytes)(l,i))throw Error("invalid MAC");var c=(0,d.chacha20)(o,s,n);let u=new DataView(c.buffer).getUint16(0),f=c.subarray(2,2+u);if(u<1||u>65535||f.length!==u||c.length!==2+tV(u))throw Error("invalid padding");return x.decode(f)}m(tq,{decrypt:()=>tZ,encrypt:()=>tG,getConversationKey:()=>tz,v2:()=>tY});var tY={utils:{getConversationKey:tz,calcPaddedLen:tV},encrypt:tG,decrypt:tZ},tX=()=>Math.round(Date.now()/1e3),tQ=()=>Math.round(tX()-172800*Math.random()),t0=(e,t)=>tz(e,t),t1=(e,t,r)=>tG(JSON.stringify(e),t0(t,r)),t2=(e,t)=>JSON.parse(tZ(e.content,t0(t,e.pubkey)));function t3(e,t){let r={created_at:tX(),content:"",tags:[],...e,pubkey:U(t)};return r.id=C(r),r}function t8(e,t,r){return $({kind:Z,content:t1(e,t,r),created_at:tQ(),tags:[]},t)}function t4(e,t){let r=_();return $({kind:eo,content:t1(e,r,t),created_at:tQ(),tags:[["p",t]]},r)}function t6(e,t,r){return t4(t8(t3(e,t),t,r),r)}function t5(e,t,r){if(!r||0===r.length)throw Error("At least one recipient is required.");let n=U(t),i=[t6(e,t,n)];return r.forEach(r=>{i.push(t6(e,t,r))}),i}function t7(e,t){let r=t2(e,t);return t2(r,t)}function t9(e,t){let r=[];return e.forEach(e=>{r.push(t7(e,t))}),r.sort((e,t)=>e.created_at-t.created_at),r}function re(e,t,r,n,i){return t6(function(e,t,r,n){let i={created_at:Math.ceil(Date.now()/1e3),kind:Y,tags:[],content:t};return(Array.isArray(e)?e:[e]).forEach(({publicKey:e,relayUrl:t})=>{i.tags.push(t?["p",e,t]:["p",e])}),n&&i.tags.push(["e",n.eventId,n.relayUrl||"","reply"]),r&&i.tags.push(["subject",r]),i}(t,r,n,i),e,t.publicKey)}function rt(e,t,r,n,i){if(!t||0===t.length)throw Error("At least one recipient is required.");return[{publicKey:U(e)},...t].map(t=>re(e,t,r,n,i))}var rr=t7,rn=t9;function ri(e,t,r,n){let i,o=[...e.tags??[],["e",t.id,r],["p",t.pubkey]];return t.kind===W?i=V:(i=X,o.push(["k",String(t.kind)])),$({kind:i,tags:o,content:""===e.content||t.tags?.find(e=>"-"===e[0])?"":JSON.stringify(t),created_at:e.created_at},n)}function ro(e){let t,r;if([V,X].includes(e.kind)){for(let n=e.tags.length-1;n>=0&&(void 0===t||void 0===r);n--){let i=e.tags[n];i.length>=2&&("e"===i[0]&&void 0===t?t=i:"p"===i[0]&&void 0===r&&(r=i))}if(void 0!==t)return{id:t[1],relays:[t[2],r?.[2]].filter(e=>"string"==typeof e),author:r?.[1]}}}function rs(e,{skipVerification:t}={}){let r,n=ro(e);if(void 0!==n&&""!==e.content){try{r=JSON.parse(e.content)}catch(e){return}if(r.id===n.id&&(t||L(r)))return r}}m({},{finishRepostEvent:()=>ri,getRepostedEvent:()=>rs,getRepostedEventPointer:()=>ro}),m({},{NOSTR_URI_REGEX:()=>ra,parse:()=>rc,test:()=>rl});var ra=RegExp(`nostr:(${ty.source})`);function rl(e){return"string"==typeof e&&RegExp(`^${ra.source}$`).test(e)}function rc(e){let t=e.match(RegExp(`^${ra.source}$`));if(!t)throw Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:tb(t[1])}}function ru(e,t,r){let n=t.tags.filter(e=>e.length>=2&&("e"===e[0]||"p"===e[0]));return $({...e,kind:J,tags:[...e.tags??[],...n,["e",t.id],["p",t.pubkey]],content:e.content??"+"},r)}function rh(e){let t,r;if(e.kind===J){for(let n=e.tags.length-1;n>=0&&(void 0===t||void 0===r);n--){let i=e.tags[n];i.length>=2&&("e"===i[0]&&void 0===t?t=i:"p"===i[0]&&void 0===r&&(r=i))}if(void 0!==t&&void 0!==r)return{id:t[1],relays:[t[2],r[2]].filter(e=>void 0!==e),author:r[1]}}}m({},{finishReactionEvent:()=>ru,getReactedEventPointer:()=>rh}),m({},{parse:()=>rp});var rf=/\W/m,rd=/\W |\W$|$|,| /m;function*rp(e){let t=e.length,r=0,n=0;for(;n<t;){let i=e.indexOf(":",n);if(-1===i)break;if("nostr"===e.substring(i-5,i)){let o=e.substring(i+60).match(rf),s=o?i+60+o.index:t;try{let t,{data:o,type:a}=tb(e.substring(i+1,s));switch(a){case"npub":t={pubkey:o};break;case"nsec":case"note":n=s+1;continue;default:t=o}r!==i-5&&(yield{type:"text",text:e.substring(r,i-5)}),yield{type:"reference",pointer:t},r=n=s;continue}catch(e){n=i+1;continue}}if("https"===e.substring(i-5,i)||"http"===e.substring(i-4,i)){let o=e.substring(i+4).match(rd),s=o?i+4+o.index:t,a="s"===e[i-1]?5:4;try{let t=new URL(e.substring(i-a,s));if(-1===t.hostname.indexOf("."))throw Error("invalid url");if(r!==i-a&&(yield{type:"text",text:e.substring(r,i-a)}),t.pathname.endsWith(".png")||t.pathname.endsWith(".jpg")||t.pathname.endsWith(".jpeg")||t.pathname.endsWith(".gif")||t.pathname.endsWith(".webp")){yield{type:"image",url:t.toString()},r=n=s;continue}if(t.pathname.endsWith(".mp4")||t.pathname.endsWith(".avi")||t.pathname.endsWith(".webm")||t.pathname.endsWith(".mkv")){yield{type:"video",url:t.toString()},r=n=s;continue}if(t.pathname.endsWith(".mp3")||t.pathname.endsWith(".aac")||t.pathname.endsWith(".ogg")||t.pathname.endsWith(".opus")){yield{type:"audio",url:t.toString()},r=n=s;continue}yield{type:"url",url:t.toString()},r=n=s;continue}catch(e){n=s+1;continue}}if("wss"===e.substring(i-3,i)||"ws"===e.substring(i-2,i)){let o=e.substring(i+4).match(rd),s=o?i+4+o.index:t,a="s"===e[i-1]?3:2;try{let t=new URL(e.substring(i-a,s));if(-1===t.hostname.indexOf("."))throw Error("invalid ws url");r!==i-a&&(yield{type:"text",text:e.substring(r,i-a)}),yield{type:"relay",url:t.toString()},r=n=s;continue}catch(e){n=s+1;continue}}else{n=i+1;continue}}r!==t&&(yield{type:"text",text:e.substring(r)})}m({},{channelCreateEvent:()=>ry,channelHideMessageEvent:()=>rm,channelMessageEvent:()=>rb,channelMetadataEvent:()=>rg,channelMuteUserEvent:()=>rv});var ry=(e,t)=>{let r;if("object"==typeof e.content)r=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;r=e.content}return $({kind:Q,tags:[...e.tags??[]],content:r,created_at:e.created_at},t)},rg=(e,t)=>{let r;if("object"==typeof e.content)r=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;r=e.content}return $({kind:ee,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:r,created_at:e.created_at},t)},rb=(e,t)=>{let r=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&r.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),$({kind:et,tags:[...r,...e.tags??[]],content:e.content,created_at:e.created_at},t)},rm=(e,t)=>{let r;if("object"==typeof e.content)r=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;r=e.content}return $({kind:er,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:r,created_at:e.created_at},t)},rv=(e,t)=>{let r;if("object"==typeof e.content)r=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;r=e.content}return $({kind:en,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:r,created_at:e.created_at},t)};m({},{EMOJI_SHORTCODE_REGEX:()=>rw,matchAll:()=>rE,regex:()=>rx,replaceAll:()=>rP});var rw=/:(\w+):/,rx=()=>RegExp(`\\B${rw.source}\\B`,"g");function*rE(e){for(let t of e.matchAll(rx()))try{let[e,r]=t;yield{shortcode:e,name:r,start:t.index,end:t.index+e.length}}catch(e){}}function rP(e,t){return e.replaceAll(rx(),(e,r)=>t({shortcode:e,name:r}))}m({},{useFetchImplementation:()=>rB,validateGithub:()=>rk});try{s=fetch}catch{}function rB(e){s=e}async function rk(e,t,r){try{return await (await s(`https://gist.github.com/${t}/${r}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch(e){return!1}}function rA(e){let{pathname:t,searchParams:r}=new URL(e),n=r.get("relay"),i=r.get("secret");if(!t||!n||!i)throw Error("invalid connection string");return{pubkey:t,relay:n,secret:i}}async function rS(e,t,r){let n=tC(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:r}}));return $({kind:eN,created_at:Math.round(Date.now()/1e3),content:n,tags:[["p",e]]},t)}function rT(e){return Array.from(e=(e=e.trim().toLowerCase()).normalize("NFKC")).map(e=>/\p{Letter}/u.test(e)||/\p{Number}/u.test(e)?e:"-").join("")}m({},{makeNwcRequestEvent:()=>rS,parseConnectionString:()=>rA}),m({},{normalizeIdentifier:()=>rT}),m({},{getSatoshisAmountFromBolt11:()=>rL,getZapEndpoint:()=>rI,makeZapReceipt:()=>r$,makeZapRequest:()=>r_,useFetchImplementation:()=>rC,validateZapRequest:()=>rU});try{a=fetch}catch{}function rC(e){a=e}async function rI(e){try{let t="",{lud06:r,lud16:n}=JSON.parse(e.content);if(r){let{words:e}=h.bech32.decode(r,1e3),n=h.bech32.fromWords(e);t=x.decode(n)}else{if(!n)return null;let[e,r]=n.split("@");t=new URL(`/.well-known/lnurlp/${e}`,`https://${r}`).toString()}let i=await a(t),o=await i.json();if(o.allowsNostr&&o.nostrPubkey)return o.callback}catch(e){}return null}function r_({profile:e,event:t,amount:r,relays:n,comment:i=""}){if(!r)throw Error("amount not given");if(!e)throw Error("profile not given");let o={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e],["amount",r.toString()],["relays",...n]]};if(t&&"string"==typeof t&&o.tags.push(["e",t]),t&&"object"==typeof t){if(R(t.kind)){let e=["a",`${t.kind}:${t.pubkey}:`];o.tags.push(e)}else if(D(t.kind)){let e=t.tags.find(([e,t])=>"d"===e&&t);if(!e)throw Error("d tag not found or is empty");let r=["a",`${t.kind}:${t.pubkey}:${e[1]}`];o.tags.push(r)}}return o}function rU(e){let t;try{t=JSON.parse(e)}catch(e){return"Invalid zap request JSON."}if(!w(t))return"Zap request is not a valid Nostr event.";if(!L(t))return"Invalid signature on zap request.";let r=t.tags.find(([e,t])=>"p"===e&&t);if(!r)return"Zap request doesn't have a 'p' tag.";if(!r[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let n=t.tags.find(([e,t])=>"e"===e&&t);return n&&!n[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([e,t])=>"relays"===e&&t)?null:"Zap request doesn't have a 'relays' tag."}function r$({zapRequest:e,preimage:t,bolt11:r,paidAt:n}){let i=JSON.parse(e),o=i.tags.filter(([e])=>"e"===e||"p"===e||"a"===e),s={kind:9735,created_at:Math.round(n.getTime()/1e3),content:"",tags:[...o,["P",i.pubkey],["bolt11",r],["description",e]]};return t&&s.tags.push(["preimage",t]),s}function rL(e){if(e.length<50)return 0;let t=(e=e.substring(0,50)).lastIndexOf("1");if(-1===t)return 0;let r=e.substring(0,t);if(!r.startsWith("lnbc"))return 0;let n=r.substring(4);if(n.length<1)return 0;let i=n[n.length-1],o=i.charCodeAt(0)-48,s=n.length-1;if(o>=0&&o<=9&&s++,s<1)return 0;let a=parseInt(n.substring(0,s));switch(i){case"m":return 1e5*a;case"u":return 100*a;case"n":return a/10;case"p":return a/1e4;default:return 1e8*a}}m({},{getToken:()=>rR,hashPayload:()=>rF,unpackEventFromToken:()=>rD,validateEvent:()=>rz,validateEventKind:()=>rH,validateEventMethodTag:()=>rW,validateEventPayloadTag:()=>rq,validateEventTimestamp:()=>rM,validateEventUrlTag:()=>rj,validateToken:()=>rO});var rN="Nostr ";async function rR(e,t,r,n=!1,i){let o={kind:eD,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&o.tags.push(["payload",rF(i)]);let s=await r(o);return(n?rN:"")+h.base64.encode(E.encode(JSON.stringify(s)))}async function rO(e,t,r){let n=await rD(e).catch(e=>{throw e});return await rz(n,t,r).catch(e=>{throw e})}async function rD(e){if(!e)throw Error("Missing token");e=e.replace(rN,"");let t=x.decode(h.base64.decode(e));if(!t||0===t.length||!t.startsWith("{"))throw Error("Invalid token");return JSON.parse(t)}function rM(e){return!!e.created_at&&Math.round(new Date().getTime()/1e3)-e.created_at<60}function rH(e){return e.kind===eD}function rj(e,t){let r=e.tags.find(e=>"u"===e[0]);return!!r&&r.length>0&&r[1]===t}function rW(e,t){let r=e.tags.find(e=>"method"===e[0]);return!!r&&r.length>0&&r[1].toLowerCase()===t.toLowerCase()}function rF(e){let t=(0,u.sha256)(E.encode(JSON.stringify(e)));return(0,c.bytesToHex)(t)}function rq(e,t){let r=e.tags.find(e=>"payload"===e[0]);if(!r)return!1;let n=rF(t);return r.length>0&&r[1]===n}async function rz(e,t,r,n){if(!L(e))throw Error("Invalid nostr event, signature invalid");if(!rH(e))throw Error("Invalid nostr event, kind invalid");if(!rM(e))throw Error("Invalid nostr event, created_at timestamp invalid");if(!rj(e,t))throw Error("Invalid nostr event, url tag invalid");if(!rW(e,r))throw Error("Invalid nostr event, method tag invalid");if(n&&"object"==typeof n&&Object.keys(n).length>0&&!rq(e,n))throw Error("Invalid nostr event, payload tag does not match request body hash");return!0}}),o("5r7db",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.encodeToCurve=e.exports.hashToCurve=e.exports.schnorr=e.exports.secp256k1=void 0;var r=i("jYfwB"),n=i("9BbKC"),o=i("2D9sF"),s=i("gNPqy"),a=i("esaJO"),l=i("rkPJ6"),c=i("7OcHe");let u=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),h=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),f=BigInt(1),d=BigInt(2),p=(e,t)=>(e+t/d)/t;function y(e){let t=BigInt(3),r=BigInt(6),n=BigInt(11),i=BigInt(22),s=BigInt(23),a=BigInt(44),l=BigInt(88),c=e*e*e%u,h=c*c*e%u,f=(0,o.pow2)(h,t,u)*h%u,p=(0,o.pow2)(f,t,u)*h%u,y=(0,o.pow2)(p,d,u)*c%u,b=(0,o.pow2)(y,n,u)*y%u,m=(0,o.pow2)(b,i,u)*b%u,v=(0,o.pow2)(m,a,u)*m%u,w=(0,o.pow2)(v,l,u)*v%u,x=(0,o.pow2)(w,a,u)*m%u,E=(0,o.pow2)(x,t,u)*h%u,P=(0,o.pow2)(E,s,u)*b%u,B=(0,o.pow2)(P,r,u)*c%u,k=(0,o.pow2)(B,d,u);if(!g.eql(g.sqr(k),e))throw Error("Cannot find square root");return k}let g=(0,o.Field)(u,void 0,void 0,{sqrt:y});e.exports.secp256k1=(0,c.createCurve)({a:BigInt(0),b:BigInt(7),Fp:g,n:h,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-f*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),n=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=BigInt("0x100000000000000000000000000000000"),s=p(t*e,h),a=p(-r*e,h),l=(0,o.mod)(e-s*t-a*n,h),c=(0,o.mod)(-s*r-a*t,h),u=l>i,d=c>i;if(u&&(l=h-l),d&&(c=h-c),l>i||c>i)throw Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:u,k1:l,k2neg:d,k2:c}}}},r.sha256);let b=BigInt(0),m=e=>"bigint"==typeof e&&b<e&&e<u,v={};function w(e,...t){let n=v[e];if(void 0===n){let t=(0,r.sha256)(Uint8Array.from(e,e=>e.charCodeAt(0)));n=(0,a.concatBytes)(t,t),v[e]=n}return(0,r.sha256)((0,a.concatBytes)(n,...t))}let x=e=>e.toRawBytes(!0).slice(1),E=e=>(0,a.numberToBytesBE)(e,32),P=e=>(0,o.mod)(e,u),B=e=>(0,o.mod)(e,h),k=e.exports.secp256k1.ProjectivePoint;function A(t){let r=e.exports.secp256k1.utils.normPrivateKeyToScalar(t),n=k.fromPrivateKey(r);return{scalar:n.hasEvenY()?r:B(-r),bytes:x(n)}}function S(e){if(!m(e))throw Error("bad x: need 0 < x < p");let t=P(e*e),r=y(P(t*e+BigInt(7)));r%d!==b&&(r=P(-r));let n=new k(e,r,f);return n.assertValidity(),n}function T(...e){return B((0,a.bytesToNumberBE)(w("BIP0340/challenge",...e)))}function C(e,t,r){let n=(0,a.ensureBytes)("signature",e,64),i=(0,a.ensureBytes)("message",t),o=(0,a.ensureBytes)("publicKey",r,32);try{let e,t=S((0,a.bytesToNumberBE)(o)),r=(0,a.bytesToNumberBE)(n.subarray(0,32));if(!m(r))return!1;let s=(0,a.bytesToNumberBE)(n.subarray(32,64));if("bigint"!=typeof s||!(b<s)||!(s<h))return!1;let l=T(E(r),x(t),i),c=(e=B(-l),k.BASE.multiplyAndAddUnsafe(t,s,e));if(!c||!c.hasEvenY()||c.toAffine().x!==r)return!1;return!0}catch(e){return!1}}e.exports.schnorr={getPublicKey:function(e){return A(e).bytes},sign:function(e,t,r=(0,n.randomBytes)(32)){let i=(0,a.ensureBytes)("message",e),{bytes:o,scalar:s}=A(t),l=(0,a.ensureBytes)("auxRand",r,32),c=E(s^(0,a.bytesToNumberBE)(w("BIP0340/aux",l))),u=w("BIP0340/nonce",c,o,i),h=B((0,a.bytesToNumberBE)(u));if(h===b)throw Error("sign failed: k is zero");let{bytes:f,scalar:d}=A(h),p=T(f,o,i),y=new Uint8Array(64);if(y.set(f,0),y.set(E(B(d+p*s)),32),!C(y,i,o))throw Error("sign: Invalid signature produced");return y},verify:C,utils:{randomPrivateKey:e.exports.secp256k1.utils.randomPrivateKey,lift_x:S,pointToBytes:x,numberToBytesBE:a.numberToBytesBE,bytesToNumberBE:a.bytesToNumberBE,taggedHash:w,mod:o.mod}};let I=(0,l.isogenyMap)(g,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(e=>e.map(e=>BigInt(e)))),_=(0,s.mapToCurveSimpleSWU)(g,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:g.create(BigInt("-11"))}),U=(0,l.createHasher)(e.exports.secp256k1.ProjectivePoint,e=>{let{x:t,y:r}=_(g.create(e[0]));return I(t,r)},{DST:"secp256k1_XMD:SHA-256_SSWU_RO_",encodeDST:"secp256k1_XMD:SHA-256_SSWU_NU_",p:g.ORDER,m:1,k:128,expand:"xmd",hash:r.sha256});e.exports.hashToCurve=U.hashToCurve,e.exports.encodeToCurve=U.encodeToCurve}),o("jYfwB",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.sha224=e.exports.sha256=void 0;var r=i("fwPy5"),n=i("9BbKC");let o=(e,t,r)=>e&t^~e&r,s=(e,t,r)=>e&t^e&r^t&r,a=new Uint32Array([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),l=new Uint32Array([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),c=new Uint32Array(64);class u extends r.SHA2{constructor(){super(64,32,8,!1),this.A=0|l[0],this.B=0|l[1],this.C=0|l[2],this.D=0|l[3],this.E=0|l[4],this.F=0|l[5],this.G=0|l[6],this.H=0|l[7]}get(){let{A:e,B:t,C:r,D:n,E:i,F:o,G:s,H:a}=this;return[e,t,r,n,i,o,s,a]}set(e,t,r,n,i,o,s,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)c[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=c[e-15],r=c[e-2],i=(0,n.rotr)(t,7)^(0,n.rotr)(t,18)^t>>>3,o=(0,n.rotr)(r,17)^(0,n.rotr)(r,19)^r>>>10;c[e]=o+c[e-7]+i+c[e-16]|0}let{A:r,B:i,C:l,D:u,E:h,F:f,G:d,H:p}=this;for(let e=0;e<64;e++){let t=p+((0,n.rotr)(h,6)^(0,n.rotr)(h,11)^(0,n.rotr)(h,25))+o(h,f,d)+a[e]+c[e]|0,y=((0,n.rotr)(r,2)^(0,n.rotr)(r,13)^(0,n.rotr)(r,22))+s(r,i,l)|0;p=d,d=f,f=h,h=u+t|0,u=l,l=i,i=r,r=t+y|0}r=r+this.A|0,i=i+this.B|0,l=l+this.C|0,u=u+this.D|0,h=h+this.E|0,f=f+this.F|0,d=d+this.G|0,p=p+this.H|0,this.set(r,i,l,u,h,f,d,p)}roundClean(){c.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class h extends u{constructor(){super(),this.A=-0x3efa6128,this.B=0x367cd507,this.C=0x3070dd17,this.D=-0x8f1a6c7,this.E=-4191439,this.F=0x68581511,this.G=0x64f98fa7,this.H=-0x4105b05c,this.outputLen=28}}e.exports.sha256=(0,n.wrapConstructor)(()=>new u),e.exports.sha224=(0,n.wrapConstructor)(()=>new h)}),o("fwPy5",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SHA2=void 0;var r=i("dAIf1"),n=i("9BbKC");class o extends n.Hash{constructor(e,t,r,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=(0,n.createView)(this.buffer)}update(e){(0,r.exists)(this);let{view:t,buffer:i,blockLen:o}=this,s=(e=(0,n.toBytes)(e)).length;for(let r=0;r<s;){let a=Math.min(o-this.pos,s-r);if(a===o){let t=(0,n.createView)(e);for(;o<=s-r;r+=o)this.process(t,r);continue}i.set(e.subarray(r,r+a),this.pos),this.pos+=a,r+=a,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,r.exists)(this),(0,r.output)(e,this),this.finished=!0;let{buffer:t,view:i,blockLen:o,isLE:s}=this,{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(i,0),a=0);for(let e=a;e<o;e++)t[e]=0;!function(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);let i=BigInt(32),o=BigInt(0xffffffff),s=Number(r>>i&o),a=Number(r&o),l=4*!!n,c=4*!n;e.setUint32(t+l,s,n),e.setUint32(t+c,a,n)}(i,o-8,BigInt(8*this.length),s),this.process(i,0);let l=(0,n.createView)(e),c=this.outputLen;if(c%4)throw Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,h=this.get();if(u>h.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<u;e++)l.setUint32(4*e,h[e],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:n,finished:i,destroyed:o,pos:s}=this;return e.length=n,e.pos=s,e.finished=i,e.destroyed=o,n%t&&e.buffer.set(r),e}}e.exports.SHA2=o}),o("dAIf1",function(e,t){function r(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`Wrong positive integer: ${e}`)}function n(e){if("boolean"!=typeof e)throw Error(`Expected boolean, not ${e}`)}function i(e,...t){if(!(e instanceof Uint8Array))throw Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function o(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.wrapConstructor");r(e.outputLen),r(e.blockLen)}function s(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function a(e,t){i(e);let r=t.outputLen;if(e.length<r)throw Error(`digestInto() expects output buffer of length at least ${r}`)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.output=e.exports.exists=e.exports.hash=e.exports.bytes=e.exports.bool=e.exports.number=void 0,e.exports.number=r,e.exports.bool=n,e.exports.bytes=i,e.exports.hash=o,e.exports.exists=s,e.exports.output=a,e.exports.default={number:r,bool:n,bytes:i,hash:o,exists:s,output:a}}),o("9BbKC",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.randomBytes=e.exports.wrapXOFConstructorWithOpts=e.exports.wrapConstructorWithOpts=e.exports.wrapConstructor=e.exports.checkOpts=e.exports.Hash=e.exports.concatBytes=e.exports.toBytes=e.exports.utf8ToBytes=e.exports.asyncLoop=e.exports.nextTick=e.exports.hexToBytes=e.exports.bytesToHex=e.exports.isLE=e.exports.rotr=e.exports.createView=e.exports.u32=e.exports.u8=void 0;var r=i("gEhde");if(e.exports.u8=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength),e.exports.u32=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),e.exports.createView=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),e.exports.rotr=(e,t)=>e<<32-t|e>>>t,e.exports.isLE=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],!e.exports.isLE)throw Error("Non little-endian hardware is not supported");let n=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));e.exports.bytesToHex=function(e){if(!(e instanceof Uint8Array))throw Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=n[e[r]];return t},e.exports.hexToBytes=function(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);let t=e.length;if(t%2)throw Error("padded hex string expected, got unpadded hex of length "+t);let r=new Uint8Array(t/2);for(let t=0;t<r.length;t++){let n=2*t,i=Number.parseInt(e.slice(n,n+2),16);if(Number.isNaN(i)||i<0)throw Error("Invalid byte sequence");r[t]=i}return r};let o=async()=>{};async function s(t,r,n){let i=Date.now();for(let o=0;o<t;o++){n(o);let t=Date.now()-i;t>=0&&t<r||(await (0,e.exports.nextTick)(),i+=t)}}function a(e){if("string"!=typeof e)throw Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function l(e){if("string"==typeof e&&(e=a(e)),!(e instanceof Uint8Array))throw Error(`expected Uint8Array, got ${typeof e}`);return e}e.exports.nextTick=o,e.exports.asyncLoop=s,e.exports.utf8ToBytes=a,e.exports.toBytes=l,e.exports.concatBytes=function(...e){let t=new Uint8Array(e.reduce((e,t)=>e+t.length,0)),r=0;return e.forEach(e=>{if(!(e instanceof Uint8Array))throw Error("Uint8Array expected");t.set(e,r),r+=e.length}),t},e.exports.Hash=class{clone(){return this._cloneInto()}};let c={}.toString;e.exports.checkOpts=function(e,t){if(void 0!==t&&"[object Object]"!==c.call(t))throw Error("Options should be object or undefined");return Object.assign(e,t)},e.exports.wrapConstructor=function(e){let t=t=>e().update(l(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t},e.exports.wrapConstructorWithOpts=function(e){let t=(t,r)=>e(r).update(l(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t},e.exports.wrapXOFConstructorWithOpts=function(e){let t=(t,r)=>e(r).update(l(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t},e.exports.randomBytes=function(e=32){if(r.crypto&&"function"==typeof r.crypto.getRandomValues)return r.crypto.getRandomValues(new Uint8Array(e));throw Error("crypto.getRandomValues must be defined")}}),o("gEhde",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.crypto=void 0,e.exports.crypto="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0}),o("2D9sF",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.mapHashToField=e.exports.getMinHashLength=e.exports.getFieldBytesLength=e.exports.hashToPrivateScalar=e.exports.FpSqrtEven=e.exports.FpSqrtOdd=e.exports.Field=e.exports.nLength=e.exports.FpIsSquare=e.exports.FpDiv=e.exports.FpInvertBatch=e.exports.FpPow=e.exports.validateField=e.exports.isNegativeLE=e.exports.FpSqrt=e.exports.tonelliShanks=e.exports.invert=e.exports.pow2=e.exports.pow=e.exports.mod=void 0;var r=i("esaJO");let n=BigInt(0),o=BigInt(1),s=BigInt(2),a=BigInt(3),l=BigInt(4),c=BigInt(5),u=BigInt(8);function h(e,t){let r=e%t;return r>=n?r:t+r}function f(e,t,r){if(r<=n||t<n)throw Error("Expected power/modulo > 0");if(r===o)return n;let i=o;for(;t>n;)t&o&&(i=i*e%r),e=e*e%r,t>>=o;return i}function d(e,t){if(e===n||t<=n)throw Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=h(e,t),i=t,s=n,a=o,l=o,c=n;for(;r!==n;){let e=i/r,t=i%r,n=s-l*e,o=a-c*e;i=r,r=t,s=l,a=c,l=n,c=o}if(i!==o)throw Error("invert: does not exist");return h(s,t)}function p(e){let t,r,i,a=(e-o)/s;for(t=e-o,r=0;t%s===n;t/=s,r++);for(i=s;i<e&&f(i,a,e)!==e-o;i++);if(1===r){let t=(e+o)/l;return function(e,r){let n=e.pow(r,t);if(!e.eql(e.sqr(n),r))throw Error("Cannot find square root");return n}}let c=(t+o)/s;return function(e,n){if(e.pow(n,a)===e.neg(e.ONE))throw Error("Cannot find square root");let s=r,l=e.pow(e.mul(e.ONE,i),t),u=e.pow(n,c),h=e.pow(n,t);for(;!e.eql(h,e.ONE);){if(e.eql(h,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(h);t<s&&!e.eql(r,e.ONE);t++)r=e.sqr(r);let r=e.pow(l,o<<BigInt(s-t-1));l=e.sqr(r),u=e.mul(u,r),h=e.mul(h,l),s=t}return u}}function y(e){if(e%l===a){let t=(e+o)/l;return function(e,r){let n=e.pow(r,t);if(!e.eql(e.sqr(n),r))throw Error("Cannot find square root");return n}}if(e%u===c){let t=(e-c)/u;return function(e,r){let n=e.mul(r,s),i=e.pow(n,t),o=e.mul(r,i),a=e.mul(e.mul(o,s),i),l=e.mul(o,e.sub(a,e.ONE));if(!e.eql(e.sqr(l),r))throw Error("Cannot find square root");return l}}return p(e)}BigInt(9),BigInt(16),e.exports.mod=h,e.exports.pow=f,e.exports.pow2=function(e,t,r){let i=e;for(;t-- >n;)i*=i,i%=r;return i},e.exports.invert=d,e.exports.tonelliShanks=p,e.exports.FpSqrt=y,e.exports.isNegativeLE=(e,t)=>(h(e,t)&o)===o;let g=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function b(e,t,r){if(r<n)throw Error("Expected power > 0");if(r===n)return e.ONE;if(r===o)return t;let i=e.ONE,s=t;for(;r>n;)r&o&&(i=e.mul(i,s)),s=e.sqr(s),r>>=o;return i}function m(e,t){let r=Array(t.length),n=t.reduce((t,n,i)=>e.is0(n)?t:(r[i]=t,e.mul(t,n)),e.ONE),i=e.inv(n);return t.reduceRight((t,n,i)=>e.is0(n)?t:(r[i]=e.mul(t,r[i]),e.mul(t,n)),i),r}function v(e,t){let r=void 0!==t?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function w(e){if("bigint"!=typeof e)throw Error("field order must be bigint");return Math.ceil(e.toString(2).length/8)}function x(e){let t=w(e);return t+Math.ceil(t/2)}e.exports.validateField=function(e){let t=g.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"});return(0,r.validateObject)(e,t)},e.exports.FpPow=b,e.exports.FpInvertBatch=m,e.exports.FpDiv=function(e,t,r){return e.mul(t,"bigint"==typeof r?d(r,e.ORDER):e.inv(r))},e.exports.FpIsSquare=function(e){let t=(e.ORDER-o)/s;return r=>{let n=e.pow(r,t);return e.eql(n,e.ZERO)||e.eql(n,e.ONE)}},e.exports.nLength=v,e.exports.Field=function(e,t,i=!1,s={}){if(e<=n)throw Error(`Expected Field ORDER > 0, got ${e}`);let{nBitLength:a,nByteLength:l}=v(e,t);if(l>2048)throw Error("Field lengths over 2048 bytes are not supported");let c=y(e),u=Object.freeze({ORDER:e,BITS:a,BYTES:l,MASK:(0,r.bitMask)(a),ZERO:n,ONE:o,create:t=>h(t,e),isValid:t=>{if("bigint"!=typeof t)throw Error(`Invalid field element: expected bigint, got ${typeof t}`);return n<=t&&t<e},is0:e=>e===n,isOdd:e=>(e&o)===o,neg:t=>h(-t,e),eql:(e,t)=>e===t,sqr:t=>h(t*t,e),add:(t,r)=>h(t+r,e),sub:(t,r)=>h(t-r,e),mul:(t,r)=>h(t*r,e),pow:(e,t)=>b(u,e,t),div:(t,r)=>h(t*d(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>d(t,e),sqrt:s.sqrt||(e=>c(u,e)),invertBatch:e=>m(u,e),cmov:(e,t,r)=>r?t:e,toBytes:e=>i?(0,r.numberToBytesLE)(e,l):(0,r.numberToBytesBE)(e,l),fromBytes:e=>{if(e.length!==l)throw Error(`Fp.fromBytes: expected ${l}, got ${e.length}`);return i?(0,r.bytesToNumberLE)(e):(0,r.bytesToNumberBE)(e)}});return Object.freeze(u)},e.exports.FpSqrtOdd=function(e,t){if(!e.isOdd)throw Error("Field doesn't have isOdd");let r=e.sqrt(t);return e.isOdd(r)?r:e.neg(r)},e.exports.FpSqrtEven=function(e,t){if(!e.isOdd)throw Error("Field doesn't have isOdd");let r=e.sqrt(t);return e.isOdd(r)?e.neg(r):r},e.exports.hashToPrivateScalar=function(e,t,n=!1){let i=(e=(0,r.ensureBytes)("privateHash",e)).length,s=v(t).nByteLength+8;if(s<24||i<s||i>1024)throw Error(`hashToPrivateScalar: expected ${s}-1024 bytes of input, got ${i}`);return h(n?(0,r.bytesToNumberLE)(e):(0,r.bytesToNumberBE)(e),t-o)+o},e.exports.getFieldBytesLength=w,e.exports.getMinHashLength=x,e.exports.mapHashToField=function(e,t,n=!1){let i=e.length,s=w(t),a=x(t);if(i<16||i<a||i>1024)throw Error(`expected ${a}-1024 bytes of input, got ${i}`);let l=h(n?(0,r.bytesToNumberBE)(e):(0,r.bytesToNumberLE)(e),t-o)+o;return n?(0,r.numberToBytesLE)(l,s):(0,r.numberToBytesBE)(l,s)}}),o("esaJO",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.validateObject=e.exports.createHmacDrbg=e.exports.bitMask=e.exports.bitSet=e.exports.bitGet=e.exports.bitLen=e.exports.utf8ToBytes=e.exports.equalBytes=e.exports.concatBytes=e.exports.ensureBytes=e.exports.numberToVarBytesBE=e.exports.numberToBytesLE=e.exports.numberToBytesBE=e.exports.bytesToNumberLE=e.exports.bytesToNumberBE=e.exports.hexToBytes=e.exports.hexToNumber=e.exports.numberToHexUnpadded=e.exports.bytesToHex=void 0;let r=BigInt(0),n=BigInt(1),i=BigInt(2),o=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function s(e){if(!(e instanceof Uint8Array))throw Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=o[e[r]];return t}function a(e){let t=e.toString(16);return 1&t.length?`0${t}`:t}function l(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}function c(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);let t=e.length;if(t%2)throw Error("padded hex string expected, got unpadded hex of length "+t);let r=new Uint8Array(t/2);for(let t=0;t<r.length;t++){let n=2*t,i=Number.parseInt(e.slice(n,n+2),16);if(Number.isNaN(i)||i<0)throw Error("Invalid byte sequence");r[t]=i}return r}function u(e,t){return c(e.toString(16).padStart(2*t,"0"))}function h(...e){let t=new Uint8Array(e.reduce((e,t)=>e+t.length,0)),r=0;return e.forEach(e=>{if(!(e instanceof Uint8Array))throw Error("Uint8Array expected");t.set(e,r),r+=e.length}),t}e.exports.bytesToHex=s,e.exports.numberToHexUnpadded=a,e.exports.hexToNumber=l,e.exports.hexToBytes=c,e.exports.bytesToNumberBE=function(e){return l(s(e))},e.exports.bytesToNumberLE=function(e){if(!(e instanceof Uint8Array))throw Error("Uint8Array expected");return l(s(Uint8Array.from(e).reverse()))},e.exports.numberToBytesBE=u,e.exports.numberToBytesLE=function(e,t){return u(e,t).reverse()},e.exports.numberToVarBytesBE=function(e){return c(a(e))},e.exports.ensureBytes=function(e,t,r){let n;if("string"==typeof t)try{n=c(t)}catch(r){throw Error(`${e} must be valid hex string, got "${t}". Cause: ${r}`)}else if(t instanceof Uint8Array)n=Uint8Array.from(t);else throw Error(`${e} must be hex string or Uint8Array`);let i=n.length;if("number"==typeof r&&i!==r)throw Error(`${e} expected ${r} bytes, got ${i}`);return n},e.exports.concatBytes=h,e.exports.equalBytes=function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0},e.exports.utf8ToBytes=function(e){if("string"!=typeof e)throw Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))},e.exports.bitLen=function(e){let t;for(t=0;e>r;e>>=n,t+=1);return t},e.exports.bitGet=function(e,t){return e>>BigInt(t)&n},e.exports.bitSet=(e,t,i)=>e|(i?n:r)<<BigInt(t),e.exports.bitMask=e=>(i<<BigInt(e-1))-n;let f=e=>new Uint8Array(e),d=e=>Uint8Array.from(e);e.exports.createHmacDrbg=function(e,t,r){if("number"!=typeof e||e<2)throw Error("hashLen must be a number");if("number"!=typeof t||t<2)throw Error("qByteLen must be a number");if("function"!=typeof r)throw Error("hmacFn must be a function");let n=f(e),i=f(e),o=0,s=()=>{n.fill(1),i.fill(0),o=0},a=(...e)=>r(i,n,...e),l=(e=f())=>{i=a(d([0]),e),n=a(),0!==e.length&&(i=a(d([1]),e),n=a())},c=()=>{if(o++>=1e3)throw Error("drbg: tried 1000 values");let e=0,r=[];for(;e<t;){let t=(n=a()).slice();r.push(t),e+=n.length}return h(...r)};return(e,t)=>{let r;for(s(),l(e);!(r=t(c()));)l();return s(),r}};let p={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};e.exports.validateObject=function(e,t,r={}){let n=(t,r,n)=>{let i=p[r];if("function"!=typeof i)throw Error(`Invalid validator "${r}", expected function`);let o=e[t];if((!n||void 0!==o)&&!i(o,e))throw Error(`Invalid param ${String(t)}=${o} (${typeof o}), expected ${r}`)};for(let[e,r]of Object.entries(t))n(e,r,!1);for(let[e,t]of Object.entries(r))n(e,t,!0);return e}}),o("gNPqy",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.mapToCurveSimpleSWU=e.exports.SWUFpSqrtRatio=e.exports.weierstrass=e.exports.weierstrassPoints=e.exports.DER=void 0;var r=i("2D9sF"),n=(i("esaJO"),i("esaJO")),o=i("lkFCe");let{bytesToNumberBE:s,hexToBytes:a}=n;e.exports.DER={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){let{Err:r}=e.exports.DER;if(t.length<2||2!==t[0])throw new r("Invalid signature integer tag");let n=t[1],i=t.subarray(2,n+2);if(!n||i.length!==n)throw new r("Invalid signature integer: wrong length");if(128&i[0])throw new r("Invalid signature integer: negative");if(0===i[0]&&!(128&i[1]))throw new r("Invalid signature integer: unnecessary leading zero");return{d:s(i),l:t.subarray(n+2)}},toSig(t){let{Err:r}=e.exports.DER,n="string"==typeof t?a(t):t;if(!(n instanceof Uint8Array))throw Error("ui8a expected");let i=n.length;if(i<2||48!=n[0])throw new r("Invalid signature tag");if(n[1]!==i-2)throw new r("Invalid signature: incorrect length");let{d:o,l:s}=e.exports.DER._parseInt(n.subarray(2)),{d:l,l:c}=e.exports.DER._parseInt(s);if(c.length)throw new r("Invalid signature: left bytes after parsing");return{r:o,s:l}},hexFromSig(e){let t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,r=e=>{let t=e.toString(16);return 1&t.length?`0${t}`:t},n=t(r(e.s)),i=t(r(e.r)),o=n.length/2,s=i.length/2,a=r(o),l=r(s);return`30${r(s+o+4)}02${l}${i}02${a}${n}`}};let l=BigInt(0),c=BigInt(1),u=BigInt(2),h=BigInt(3),f=BigInt(4);function d(e){let t=function(e){let t=(0,o.validateBasic)(e);n.validateObject(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:r,Fp:i,a:s}=t;if(r){if(!i.eql(s,i.ZERO))throw Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:i}=t,s=t.toBytes||((e,t,r)=>{let o=t.toAffine();return n.concatBytes(Uint8Array.from([4]),i.toBytes(o.x),i.toBytes(o.y))}),a=t.fromBytes||(e=>{let t=e.subarray(1);return{x:i.fromBytes(t.subarray(0,i.BYTES)),y:i.fromBytes(t.subarray(i.BYTES,2*i.BYTES))}});function u(e){let{a:r,b:n}=t,o=i.sqr(e),s=i.mul(o,e);return i.add(i.add(s,i.mul(e,r)),n)}if(!i.eql(i.sqr(t.Gy),u(t.Gx)))throw Error("bad generator point: equation left != right");function f(e){return"bigint"==typeof e&&l<e&&e<t.n}function d(e){if(!f(e))throw Error("Expected valid bigint: 0 < bigint < curve.n")}function p(e){let i,{allowedPrivateKeyLengths:o,nByteLength:s,wrapPrivateKey:a,n:l}=t;if(o&&"bigint"!=typeof e){if(e instanceof Uint8Array&&(e=n.bytesToHex(e)),"string"!=typeof e||!o.includes(e.length))throw Error("Invalid key");e=e.padStart(2*s,"0")}try{i="bigint"==typeof e?e:n.bytesToNumberBE((0,n.ensureBytes)("private key",e,s))}catch(t){throw Error(`private key must be ${s} bytes, hex or bigint, not ${typeof e}`)}return a&&(i=r.mod(i,l)),d(i),i}let y=new Map;function g(e){if(!(e instanceof b))throw Error("ProjectivePoint expected")}class b{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!i.isValid(e))throw Error("x required");if(null==t||!i.isValid(t))throw Error("y required");if(null==r||!i.isValid(r))throw Error("z required")}static fromAffine(e){let{x:t,y:r}=e||{};if(!e||!i.isValid(t)||!i.isValid(r))throw Error("invalid affine point");if(e instanceof b)throw Error("projective point not allowed");let n=e=>i.eql(e,i.ZERO);return n(t)&&n(r)?b.ZERO:new b(t,r,i.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){let t=i.invertBatch(e.map(e=>e.pz));return e.map((e,r)=>e.toAffine(t[r])).map(b.fromAffine)}static fromHex(e){let t=b.fromAffine(a((0,n.ensureBytes)("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return b.BASE.multiply(p(e))}_setWindowSize(e){this._WINDOW_SIZE=e,y.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!i.is0(this.py))return;throw Error("bad point: ZERO")}let{x:e,y:r}=this.toAffine();if(!i.isValid(e)||!i.isValid(r))throw Error("bad point: x or y not FE");let n=i.sqr(r),o=u(e);if(!i.eql(n,o))throw Error("bad point: equation left != right");if(!this.isTorsionFree())throw Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:e}=this.toAffine();if(i.isOdd)return!i.isOdd(e);throw Error("Field doesn't support isOdd")}equals(e){g(e);let{px:t,py:r,pz:n}=this,{px:o,py:s,pz:a}=e,l=i.eql(i.mul(t,a),i.mul(o,n)),c=i.eql(i.mul(r,a),i.mul(s,n));return l&&c}negate(){return new b(this.px,i.neg(this.py),this.pz)}double(){let{a:e,b:r}=t,n=i.mul(r,h),{px:o,py:s,pz:a}=this,l=i.ZERO,c=i.ZERO,u=i.ZERO,f=i.mul(o,o),d=i.mul(s,s),p=i.mul(a,a),y=i.mul(o,s);return y=i.add(y,y),u=i.mul(o,a),u=i.add(u,u),l=i.mul(e,u),c=i.mul(n,p),c=i.add(l,c),l=i.sub(d,c),c=i.add(d,c),c=i.mul(l,c),l=i.mul(y,l),u=i.mul(n,u),p=i.mul(e,p),y=i.sub(f,p),y=i.mul(e,y),y=i.add(y,u),u=i.add(f,f),f=i.add(u,f),f=i.add(f,p),f=i.mul(f,y),c=i.add(c,f),p=i.mul(s,a),p=i.add(p,p),f=i.mul(p,y),l=i.sub(l,f),u=i.mul(p,d),u=i.add(u,u),new b(l,c,u=i.add(u,u))}add(e){g(e);let{px:r,py:n,pz:o}=this,{px:s,py:a,pz:l}=e,c=i.ZERO,u=i.ZERO,f=i.ZERO,d=t.a,p=i.mul(t.b,h),y=i.mul(r,s),m=i.mul(n,a),v=i.mul(o,l),w=i.add(r,n),x=i.add(s,a);w=i.mul(w,x),x=i.add(y,m),w=i.sub(w,x),x=i.add(r,o);let E=i.add(s,l);return x=i.mul(x,E),E=i.add(y,v),x=i.sub(x,E),E=i.add(n,o),c=i.add(a,l),E=i.mul(E,c),c=i.add(m,v),E=i.sub(E,c),f=i.mul(d,x),c=i.mul(p,v),f=i.add(c,f),c=i.sub(m,f),f=i.add(m,f),u=i.mul(c,f),m=i.add(y,y),m=i.add(m,y),v=i.mul(d,v),x=i.mul(p,x),m=i.add(m,v),v=i.sub(y,v),v=i.mul(d,v),x=i.add(x,v),y=i.mul(m,x),u=i.add(u,y),y=i.mul(E,x),c=i.mul(w,c),c=i.sub(c,y),y=i.mul(w,m),f=i.mul(E,f),new b(c,u,f=i.add(f,y))}subtract(e){return this.add(e.negate())}is0(){return this.equals(b.ZERO)}wNAF(e){return v.wNAFCached(this,y,e,e=>{let t=i.invertBatch(e.map(e=>e.pz));return e.map((e,r)=>e.toAffine(t[r])).map(b.fromAffine)})}multiplyUnsafe(e){let r=b.ZERO;if(e===l)return r;if(d(e),e===c)return this;let{endo:n}=t;if(!n)return v.unsafeLadder(this,e);let{k1neg:o,k1:s,k2neg:a,k2:u}=n.splitScalar(e),h=r,f=r,p=this;for(;s>l||u>l;)s&c&&(h=h.add(p)),u&c&&(f=f.add(p)),p=p.double(),s>>=c,u>>=c;return o&&(h=h.negate()),a&&(f=f.negate()),f=new b(i.mul(f.px,n.beta),f.py,f.pz),h.add(f)}multiply(e){let r,n;d(e);let{endo:o}=t;if(o){let{k1neg:t,k1:s,k2neg:a,k2:l}=o.splitScalar(e),{p:c,f:u}=this.wNAF(s),{p:h,f:f}=this.wNAF(l);c=v.constTimeNegate(t,c),h=v.constTimeNegate(a,h),h=new b(i.mul(h.px,o.beta),h.py,h.pz),r=c.add(h),n=u.add(f)}else{let{p:t,f:i}=this.wNAF(e);r=t,n=i}return b.normalizeZ([r,n])[0]}multiplyAndAddUnsafe(e,t,r){let n=b.BASE,i=(e,t)=>t!==l&&t!==c&&e.equals(n)?e.multiply(t):e.multiplyUnsafe(t),o=i(this,t).add(i(e,r));return o.is0()?void 0:o}toAffine(e){let{px:t,py:r,pz:n}=this,o=this.is0();null==e&&(e=o?i.ONE:i.inv(n));let s=i.mul(t,e),a=i.mul(r,e),l=i.mul(n,e);if(o)return{x:i.ZERO,y:i.ZERO};if(!i.eql(l,i.ONE))throw Error("invZ was invalid");return{x:s,y:a}}isTorsionFree(){let{h:e,isTorsionFree:r}=t;if(e===c)return!0;if(r)return r(b,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:e,clearCofactor:r}=t;return e===c?this:r?r(b,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return this.assertValidity(),s(b,this,e)}toHex(e=!0){return n.bytesToHex(this.toRawBytes(e))}}b.BASE=new b(t.Gx,t.Gy,i.ONE),b.ZERO=new b(i.ZERO,i.ONE,i.ZERO);let m=t.nBitLength,v=(0,o.wNAF)(b,t.endo?Math.ceil(m/2):m);return{CURVE:t,ProjectivePoint:b,normPrivateKeyToScalar:p,weierstrassEquation:u,isWithinCurveOrder:f}}function p(e,t){let r=e.ORDER,n=l;for(let e=r-c;e%u===l;e/=u)n+=c;let i=n,o=u<<i-c-c,s=o*u,a=(r-c)/s,d=(a-c)/u,p=s-c,y=e.pow(t,a),g=e.pow(t,(a+c)/u),b=(t,r)=>{let n=y,s=e.pow(r,p),a=e.sqr(s);a=e.mul(a,r);let l=e.mul(t,a);l=e.pow(l,d),l=e.mul(l,s),s=e.mul(l,r),a=e.mul(l,t);let h=e.mul(a,s);l=e.pow(h,o);let f=e.eql(l,e.ONE);s=e.mul(a,g),l=e.mul(h,n),a=e.cmov(s,a,f),h=e.cmov(l,h,f);for(let t=i;t>c;t--){let r=t-u;r=u<<r-c;let i=e.pow(h,r),o=e.eql(i,e.ONE);s=e.mul(a,n),n=e.mul(n,n),i=e.mul(h,n),a=e.cmov(s,a,o),h=e.cmov(i,h,o)}return{isValid:f,value:a}};if(e.ORDER%f===h){let r=(e.ORDER-h)/f,n=e.sqrt(e.neg(t));b=(t,i)=>{let o=e.sqr(i),s=e.mul(t,i);o=e.mul(o,s);let a=e.pow(o,r);a=e.mul(a,s);let l=e.mul(a,n),c=e.mul(e.sqr(a),i),u=e.eql(c,t),h=e.cmov(l,a,u);return{isValid:u,value:h}}}return b}e.exports.weierstrassPoints=d,e.exports.weierstrass=function(t){let i=function(e){let t=(0,o.validateBasic)(e);return n.validateObject(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(t),{Fp:s,n:a}=i,u=s.BYTES+1,h=2*s.BYTES+1;function f(e){return r.mod(e,a)}function p(e){return r.invert(e,a)}let{ProjectivePoint:y,normPrivateKeyToScalar:g,weierstrassEquation:b,isWithinCurveOrder:m}=d({...i,toBytes(e,t,r){let i=t.toAffine(),o=s.toBytes(i.x),a=n.concatBytes;return r?a(Uint8Array.from([t.hasEvenY()?2:3]),o):a(Uint8Array.from([4]),o,s.toBytes(i.y))},fromBytes(e){let t=e.length,r=e[0],i=e.subarray(1);if(t===u&&(2===r||3===r)){let e=n.bytesToNumberBE(i);if(!(l<e&&e<s.ORDER))throw Error("Point is not on curve");let t=b(e),o=s.sqrt(t);return(1&r)==1!=((o&c)===c)&&(o=s.neg(o)),{x:e,y:o}}if(t===h&&4===r)return{x:s.fromBytes(i.subarray(0,s.BYTES)),y:s.fromBytes(i.subarray(s.BYTES,2*s.BYTES))};throw Error(`Point of length ${t} was invalid. Expected ${u} compressed bytes or ${h} uncompressed bytes`)}}),v=e=>n.bytesToHex(n.numberToBytesBE(e,i.nByteLength)),w=(e,t,r)=>n.bytesToNumberBE(e.slice(t,r));class x{constructor(e,t,r){this.r=e,this.s=t,this.recovery=r,this.assertValidity()}static fromCompact(e){let t=i.nByteLength;return new x(w(e=(0,n.ensureBytes)("compactSignature",e,2*t),0,t),w(e,t,2*t))}static fromDER(t){let{r:r,s:i}=e.exports.DER.toSig((0,n.ensureBytes)("DER",t));return new x(r,i)}assertValidity(){if(!m(this.r))throw Error("r must be 0 < r < CURVE.n");if(!m(this.s))throw Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new x(this.r,this.s,e)}recoverPublicKey(e){let{r:t,s:r,recovery:o}=this,a=B((0,n.ensureBytes)("msgHash",e));if(null==o||![0,1,2,3].includes(o))throw Error("recovery id invalid");let l=2===o||3===o?t+i.n:t;if(l>=s.ORDER)throw Error("recovery id 2 or 3 invalid");let c=(1&o)==0?"02":"03",u=y.fromHex(c+v(l)),h=p(l),d=f(-a*h),g=f(r*h),b=y.BASE.multiplyAndAddUnsafe(u,d,g);if(!b)throw Error("point at infinify");return b.assertValidity(),b}hasHighS(){return this.s>a>>c}normalizeS(){return this.hasHighS()?new x(this.r,f(-this.s),this.recovery):this}toDERRawBytes(){return n.hexToBytes(this.toDERHex())}toDERHex(){return e.exports.DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return n.hexToBytes(this.toCompactHex())}toCompactHex(){return v(this.r)+v(this.s)}}function E(e){let t=e instanceof Uint8Array,r="string"==typeof e,n=(t||r)&&e.length;return t?n===u||n===h:r?n===2*u||n===2*h:e instanceof y}let P=i.bits2int||function(e){let t=n.bytesToNumberBE(e),r=8*e.length-i.nBitLength;return r>0?t>>BigInt(r):t},B=i.bits2int_modN||function(e){return f(P(e))},k=n.bitMask(i.nBitLength);function A(e){if("bigint"!=typeof e)throw Error("bigint expected");if(!(l<=e&&e<k))throw Error(`bigint expected < 2^${i.nBitLength}`);return n.numberToBytesBE(e,i.nByteLength)}let S={lowS:i.lowS,prehash:!1},T={lowS:i.lowS,prehash:!1};return y.BASE._setWindowSize(8),{CURVE:i,getPublicKey:function(e,t=!0){return y.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,r=!0){if(E(e))throw Error("first arg must be private key");if(!E(t))throw Error("second arg must be public key");return y.fromHex(t).multiply(g(e)).toRawBytes(r)},sign:function(e,t,r=S){let{seed:o,k2sig:u}=function(e,t,r=S){if(["recovered","canonical"].some(e=>e in r))throw Error("sign() legacy options not supported");let{hash:o,randomBytes:u}=i,{lowS:h,prehash:d,extraEntropy:b}=r;null==h&&(h=!0),e=(0,n.ensureBytes)("msgHash",e),d&&(e=(0,n.ensureBytes)("prehashed msgHash",o(e)));let v=B(e),w=g(t),E=[A(w),A(v)];if(null!=b){let e=!0===b?u(s.BYTES):b;E.push((0,n.ensureBytes)("extraEntropy",e))}return{seed:n.concatBytes(...E),k2sig:function(e){var t;let r=P(e);if(!m(r))return;let n=p(r),i=y.BASE.multiply(r).toAffine(),o=f(i.x);if(o===l)return;let s=f(n*f(v+o*w));if(s===l)return;let u=2*(i.x!==o)|Number(i.y&c),d=s;return h&&s>a>>c&&(d=(t=s)>a>>c?f(-t):t,u^=1),new x(o,d,u)}}}(e,t,r);return n.createHmacDrbg(i.hash.outputLen,i.nByteLength,i.hmac)(o,u)},verify:function(t,r,o,s=T){let a,l;if(r=(0,n.ensureBytes)("msgHash",r),o=(0,n.ensureBytes)("publicKey",o),"strict"in s)throw Error("options.strict was renamed to lowS");let{lowS:c,prehash:u}=s;try{if("string"==typeof t||t instanceof Uint8Array)try{l=x.fromDER(t)}catch(r){if(!(r instanceof e.exports.DER.Err))throw r;l=x.fromCompact(t)}else if("object"==typeof t&&"bigint"==typeof t.r&&"bigint"==typeof t.s){let{r:e,s:r}=t;l=new x(e,r)}else throw Error("PARSE");a=y.fromHex(o)}catch(e){if("PARSE"===e.message)throw Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(c&&l.hasHighS())return!1;u&&(r=i.hash(r));let{r:h,s:d}=l,g=B(r),b=p(d),m=f(g*b),v=f(h*b),w=y.BASE.multiplyAndAddUnsafe(a,m,v)?.toAffine();return!!w&&f(w.x)===h},ProjectivePoint:y,Signature:x,utils:{isValidPrivateKey(e){try{return g(e),!0}catch(e){return!1}},normPrivateKeyToScalar:g,randomPrivateKey:()=>{let e=r.getMinHashLength(i.n);return r.mapHashToField(i.randomBytes(e),i.n)},precompute:(e=8,t=y.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)}}},e.exports.SWUFpSqrtRatio=p,e.exports.mapToCurveSimpleSWU=function(e,t){if(r.validateField(e),!e.isValid(t.A)||!e.isValid(t.B)||!e.isValid(t.Z))throw Error("mapToCurveSimpleSWU: invalid opts");let n=p(e,t.Z);if(!e.isOdd)throw Error("Fp.isOdd is not implemented!");return r=>{let i,o,s,a,l,c,u,h;i=e.sqr(r),i=e.mul(i,t.Z),o=e.sqr(i),o=e.add(o,i),s=e.add(o,e.ONE),s=e.mul(s,t.B),a=e.cmov(t.Z,e.neg(o),!e.eql(o,e.ZERO)),a=e.mul(a,t.A),o=e.sqr(s),c=e.sqr(a),l=e.mul(c,t.A),o=e.add(o,l),o=e.mul(o,s),c=e.mul(c,a),l=e.mul(c,t.B),o=e.add(o,l),u=e.mul(i,s);let{isValid:f,value:d}=n(o,c);h=e.mul(i,r),h=e.mul(h,d),u=e.cmov(u,s,f),h=e.cmov(h,d,f);let p=e.isOdd(r)===e.isOdd(h);return h=e.cmov(e.neg(h),h,p),{x:u=e.div(u,a),y:h}}}}),o("lkFCe",function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validateBasic=t.wNAF=void 0;var r=i("2D9sF"),n=i("esaJO");let o=BigInt(0),s=BigInt(1);t.wNAF=function(e,t){let r=(e,t)=>{let r=t.negate();return e?r:t},n=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:r,unsafeLadder(t,r){let n=e.ZERO,i=t;for(;r>o;)r&s&&(n=n.add(i)),i=i.double(),r>>=s;return n},precomputeWindow(e,t){let{windows:r,windowSize:i}=n(t),o=[],s=e,a=s;for(let e=0;e<r;e++){a=s,o.push(a);for(let e=1;e<i;e++)a=a.add(s),o.push(a);s=a.double()}return o},wNAF(t,i,o){let{windows:a,windowSize:l}=n(t),c=e.ZERO,u=e.BASE,h=BigInt(2**t-1),f=2**t,d=BigInt(t);for(let e=0;e<a;e++){let t=e*l,n=Number(o&h);o>>=d,n>l&&(n-=f,o+=s);let a=t+Math.abs(n)-1,p=e%2!=0,y=n<0;0===n?u=u.add(r(p,i[t])):c=c.add(r(y,i[a]))}return{p:c,f:u}},wNAFCached(e,t,r,n){let i=e._WINDOW_SIZE||1,o=t.get(e);return o||(o=this.precomputeWindow(e,i),1!==i&&t.set(e,n(o))),this.wNAF(i,o,r)}}},t.validateBasic=function(e){return(0,r.validateField)(e.Fp),(0,n.validateObject)(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...(0,r.nLength)(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}}),o("rkPJ6",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.createHasher=e.exports.isogenyMap=e.exports.hash_to_field=e.exports.expand_message_xof=e.exports.expand_message_xmd=void 0;var r=i("2D9sF"),n=i("esaJO");let o=n.bytesToNumberBE;function s(e,t){if(e<0||e>=1<<8*t)throw Error(`bad I2OSP call: value=${e} length=${t}`);let r=Array.from({length:t}).fill(0);for(let n=t-1;n>=0;n--)r[n]=255&e,e>>>=8;return new Uint8Array(r)}function a(e){if(!(e instanceof Uint8Array))throw Error("Uint8Array expected")}function l(e){if(!Number.isSafeInteger(e))throw Error("number expected")}function c(e,t,r,i){a(e),a(t),l(r),t.length>255&&(t=i((0,n.concatBytes)((0,n.utf8ToBytes)("H2C-OVERSIZE-DST-"),t)));let{outputLen:o,blockLen:c}=i,u=Math.ceil(r/o);if(u>255)throw Error("Invalid xmd length");let h=(0,n.concatBytes)(t,s(t.length,1)),f=s(0,c),d=s(r,2),p=Array(u),y=i((0,n.concatBytes)(f,e,d,s(0,1),h));p[0]=i((0,n.concatBytes)(y,s(1,1),h));for(let e=1;e<=u;e++){let t=[function(e,t){let r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e[n]^t[n];return r}(y,p[e-1]),s(e+1,1),h];p[e]=i((0,n.concatBytes)(...t))}return(0,n.concatBytes)(...p).slice(0,r)}function u(e,t,r,i,o){if(a(e),a(t),l(r),t.length>255){let e=Math.ceil(2*i/8);t=o.create({dkLen:e}).update((0,n.utf8ToBytes)("H2C-OVERSIZE-DST-")).update(t).digest()}if(r>65535||t.length>255)throw Error("expand_message_xof: invalid lenInBytes");return o.create({dkLen:r}).update(e).update(s(r,2)).update(t).update(s(t.length,1)).digest()}function h(e,t,i){let s;(0,n.validateObject)(i,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});let{p:h,k:f,m:d,hash:p,expand:y,DST:g}=i;a(e),l(t);let b=function(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)return(0,n.utf8ToBytes)(e);throw Error("DST must be Uint8Array or string")}(g),m=Math.ceil((h.toString(2).length+f)/8),v=t*d*m;if("xmd"===y)s=c(e,b,v,p);else if("xof"===y)s=u(e,b,v,f,p);else if("_internal_pass"===y)s=e;else throw Error('expand must be "xmd" or "xof"');let w=Array(t);for(let e=0;e<t;e++){let t=Array(d);for(let n=0;n<d;n++){let i=m*(n+e*d),a=s.subarray(i,i+m);t[n]=(0,r.mod)(o(a),h)}w[e]=t}return w}e.exports.expand_message_xmd=c,e.exports.expand_message_xof=u,e.exports.hash_to_field=h,e.exports.isogenyMap=function(e,t){let r=t.map(e=>Array.from(e).reverse());return(t,n)=>{let[i,o,s,a]=r.map(r=>r.reduce((r,n)=>e.add(e.mul(r,t),n)));return t=e.div(i,o),n=e.mul(n,e.div(s,a)),{x:t,y:n}}},e.exports.createHasher=function(e,t,r){if("function"!=typeof t)throw Error("mapToCurve() must be defined");return{hashToCurve(n,i){let o=h(n,2,{...r,DST:r.DST,...i}),s=e.fromAffine(t(o[0])),a=e.fromAffine(t(o[1])),l=s.add(a).clearCofactor();return l.assertValidity(),l},encodeToCurve(n,i){let o=h(n,1,{...r,DST:r.encodeDST,...i}),s=e.fromAffine(t(o[0])).clearCofactor();return s.assertValidity(),s}}}}),o("7OcHe",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.createCurve=e.exports.getHash=void 0;var r=i("1EIgu"),n=i("9BbKC"),o=i("gNPqy");function s(e){return{hash:e,hmac:(t,...i)=>(0,r.hmac)(e,t,(0,n.concatBytes)(...i)),randomBytes:n.randomBytes}}e.exports.getHash=s,e.exports.createCurve=function(e,t){let r=t=>(0,o.weierstrass)({...e,...s(t)});return Object.freeze({...r(t),create:r})}}),o("1EIgu",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.hmac=e.exports.HMAC=void 0;var r=i("dAIf1"),n=i("9BbKC");class o extends n.Hash{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,(0,r.hash)(e);let i=(0,n.toBytes)(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(i.length>o?e.create().update(i).digest():i);for(let e=0;e<s.length;e++)s[e]^=54;this.iHash.update(s),this.oHash=e.create();for(let e=0;e<s.length;e++)s[e]^=106;this.oHash.update(s),s.fill(0)}update(e){return(0,r.exists)(this),this.iHash.update(e),this}digestInto(e){(0,r.exists)(this),(0,r.bytes)(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:r,finished:n,destroyed:i,blockLen:o,outputLen:s}=this;return e.finished=n,e.destroyed=i,e.blockLen=o,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}e.exports.HMAC=o,e.exports.hmac=(e,t,r)=>new o(e,t).update(r).digest(),e.exports.hmac.create=(e,t)=>new o(e,t)}),o("3Bcdj",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.randomBytes=e.exports.wrapXOFConstructorWithOpts=e.exports.wrapConstructorWithOpts=e.exports.wrapConstructor=e.exports.checkOpts=e.exports.Hash=e.exports.concatBytes=e.exports.toBytes=e.exports.utf8ToBytes=e.exports.asyncLoop=e.exports.nextTick=e.exports.hexToBytes=e.exports.bytesToHex=e.exports.isLE=e.exports.rotr=e.exports.createView=e.exports.u32=e.exports.u8=void 0;var r=i("dUxV2");if(e.exports.u8=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength),e.exports.u32=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),e.exports.createView=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),e.exports.rotr=(e,t)=>e<<32-t|e>>>t,e.exports.isLE=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],!e.exports.isLE)throw Error("Non little-endian hardware is not supported");let n=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));e.exports.bytesToHex=function(e){if(!(e instanceof Uint8Array))throw Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=n[e[r]];return t},e.exports.hexToBytes=function(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);let t=e.length;if(t%2)throw Error("padded hex string expected, got unpadded hex of length "+t);let r=new Uint8Array(t/2);for(let t=0;t<r.length;t++){let n=2*t,i=Number.parseInt(e.slice(n,n+2),16);if(Number.isNaN(i)||i<0)throw Error("Invalid byte sequence");r[t]=i}return r};let o=async()=>{};async function s(t,r,n){let i=Date.now();for(let o=0;o<t;o++){n(o);let t=Date.now()-i;t>=0&&t<r||(await (0,e.exports.nextTick)(),i+=t)}}function a(e){if("string"!=typeof e)throw Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function l(e){if("string"==typeof e&&(e=a(e)),!(e instanceof Uint8Array))throw Error(`expected Uint8Array, got ${typeof e}`);return e}e.exports.nextTick=o,e.exports.asyncLoop=s,e.exports.utf8ToBytes=a,e.exports.toBytes=l,e.exports.concatBytes=function(...e){let t=new Uint8Array(e.reduce((e,t)=>e+t.length,0)),r=0;return e.forEach(e=>{if(!(e instanceof Uint8Array))throw Error("Uint8Array expected");t.set(e,r),r+=e.length}),t},e.exports.Hash=class{clone(){return this._cloneInto()}},e.exports.checkOpts=function(e,t){if(void 0!==t&&("object"!=typeof t||"[object Object]"!==Object.prototype.toString.call(t)||t.constructor!==Object))throw Error("Options should be object or undefined");return Object.assign(e,t)},e.exports.wrapConstructor=function(e){let t=t=>e().update(l(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t},e.exports.wrapConstructorWithOpts=function(e){let t=(t,r)=>e(r).update(l(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t},e.exports.wrapXOFConstructorWithOpts=function(e){let t=(t,r)=>e(r).update(l(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t},e.exports.randomBytes=function(e=32){if(r.crypto&&"function"==typeof r.crypto.getRandomValues)return r.crypto.getRandomValues(new Uint8Array(e));throw Error("crypto.getRandomValues must be defined")}}),o("dUxV2",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.crypto=void 0,e.exports.crypto="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0}),o("6XnWx",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.sha224=e.exports.sha256=void 0;var r=i("g9W9K"),n=i("3Bcdj");let o=(e,t,r)=>e&t^~e&r,s=(e,t,r)=>e&t^e&r^t&r,a=new Uint32Array([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),l=new Uint32Array([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),c=new Uint32Array(64);class u extends r.SHA2{constructor(){super(64,32,8,!1),this.A=0|l[0],this.B=0|l[1],this.C=0|l[2],this.D=0|l[3],this.E=0|l[4],this.F=0|l[5],this.G=0|l[6],this.H=0|l[7]}get(){let{A:e,B:t,C:r,D:n,E:i,F:o,G:s,H:a}=this;return[e,t,r,n,i,o,s,a]}set(e,t,r,n,i,o,s,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)c[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=c[e-15],r=c[e-2],i=(0,n.rotr)(t,7)^(0,n.rotr)(t,18)^t>>>3,o=(0,n.rotr)(r,17)^(0,n.rotr)(r,19)^r>>>10;c[e]=o+c[e-7]+i+c[e-16]|0}let{A:r,B:i,C:l,D:u,E:h,F:f,G:d,H:p}=this;for(let e=0;e<64;e++){let t=p+((0,n.rotr)(h,6)^(0,n.rotr)(h,11)^(0,n.rotr)(h,25))+o(h,f,d)+a[e]+c[e]|0,y=((0,n.rotr)(r,2)^(0,n.rotr)(r,13)^(0,n.rotr)(r,22))+s(r,i,l)|0;p=d,d=f,f=h,h=u+t|0,u=l,l=i,i=r,r=t+y|0}r=r+this.A|0,i=i+this.B|0,l=l+this.C|0,u=u+this.D|0,h=h+this.E|0,f=f+this.F|0,d=d+this.G|0,p=p+this.H|0,this.set(r,i,l,u,h,f,d,p)}roundClean(){c.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class h extends u{constructor(){super(),this.A=-0x3efa6128,this.B=0x367cd507,this.C=0x3070dd17,this.D=-0x8f1a6c7,this.E=-4191439,this.F=0x68581511,this.G=0x64f98fa7,this.H=-0x4105b05c,this.outputLen=28}}e.exports.sha256=(0,n.wrapConstructor)(()=>new u),e.exports.sha224=(0,n.wrapConstructor)(()=>new h)}),o("g9W9K",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.SHA2=void 0;var r=i("dNiq9"),n=i("3Bcdj");class o extends n.Hash{constructor(e,t,r,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=(0,n.createView)(this.buffer)}update(e){r.default.exists(this);let{view:t,buffer:i,blockLen:o}=this,s=(e=(0,n.toBytes)(e)).length;for(let r=0;r<s;){let a=Math.min(o-this.pos,s-r);if(a===o){let t=(0,n.createView)(e);for(;o<=s-r;r+=o)this.process(t,r);continue}i.set(e.subarray(r,r+a),this.pos),this.pos+=a,r+=a,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){r.default.exists(this),r.default.output(e,this),this.finished=!0;let{buffer:t,view:i,blockLen:o,isLE:s}=this,{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(i,0),a=0);for(let e=a;e<o;e++)t[e]=0;!function(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);let i=BigInt(32),o=BigInt(0xffffffff),s=Number(r>>i&o),a=Number(r&o),l=4*!!n,c=4*!n;e.setUint32(t+l,s,n),e.setUint32(t+c,a,n)}(i,o-8,BigInt(8*this.length),s),this.process(i,0);let l=(0,n.createView)(e),c=this.outputLen;if(c%4)throw Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,h=this.get();if(u>h.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<u;e++)l.setUint32(4*e,h[e],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:n,finished:i,destroyed:o,pos:s}=this;return e.length=n,e.pos=s,e.finished=i,e.destroyed=o,n%t&&e.buffer.set(r),e}}e.exports.SHA2=o}),o("dNiq9",function(e,t){function r(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`Wrong positive integer: ${e}`)}function n(e){if("boolean"!=typeof e)throw Error(`Expected boolean, not ${e}`)}function i(e,...t){if(!(e instanceof Uint8Array))throw Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function o(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.wrapConstructor");r(e.outputLen),r(e.blockLen)}function s(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function a(e,t){i(e);let r=t.outputLen;if(e.length<r)throw Error(`digestInto() expects output buffer of length at least ${r}`)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.output=e.exports.exists=e.exports.hash=e.exports.bytes=e.exports.bool=e.exports.number=void 0,e.exports.number=r,e.exports.bool=n,e.exports.bytes=i,e.exports.hash=o,e.exports.exists=s,e.exports.output=a,e.exports.default={number:r,bool:n,bytes:i,hash:o,exists:s,output:a}}),o("4Dsex",function(t,r){function n(e){if(!Number.isSafeInteger(e))throw Error(`Wrong integer: ${e}`)}function i(...e){let t=(e,t)=>r=>e(t(r));return{encode:Array.from(e).reverse().reduce((e,r)=>e?t(e,r.encode):r.encode,void 0),decode:e.reduce((e,r)=>e?t(e,r.decode):r.decode,void 0)}}function o(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw Error("alphabet.encode input should be an array of numbers");return t.map(t=>{if(n(t),t<0||t>=e.length)throw Error(`Digit index outside alphabet: ${t} (alphabet: ${e.length})`);return e[t]})},decode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw Error("alphabet.decode input should be array of strings");return t.map(t=>{if("string"!=typeof t)throw Error(`alphabet.decode: not string element=${t}`);let r=e.indexOf(t);if(-1===r)throw Error(`Unknown letter: "${t}". Allowed: ${e}`);return r})}}}function s(e=""){if("string"!=typeof e)throw Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw Error("join.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw Error(`join.encode: non-string input=${e}`);return t.join(e)},decode:t=>{if("string"!=typeof t)throw Error("join.decode input should be string");return t.split(e)}}}function a(e,t="="){if(n(e),"string"!=typeof t)throw Error("padding chr should be string");return{encode(r){if(!Array.isArray(r)||r.length&&"string"!=typeof r[0])throw Error("padding.encode input should be array of strings");for(let e of r)if("string"!=typeof e)throw Error(`padding.encode: non-string input=${e}`);for(;r.length*e%8;)r.push(t);return r},decode(r){if(!Array.isArray(r)||r.length&&"string"!=typeof r[0])throw Error("padding.encode input should be array of strings");for(let e of r)if("string"!=typeof e)throw Error(`padding.decode: non-string input=${e}`);let n=r.length;if(n*e%8)throw Error("Invalid padding: string should have whole number of bytes");for(;n>0&&r[n-1]===t;n--)if(!((n-1)*e%8))throw Error("Invalid padding: string has too much padding");return r.slice(0,n)}}}function l(e){if("function"!=typeof e)throw Error("normalize fn should be function");return{encode:e=>e,decode:t=>e(t)}}function c(e,t,r){if(t<2)throw Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(r<2)throw Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(e))throw Error("convertRadix: data should be array");if(!e.length)return[];let i=0,o=[],s=Array.from(e);for(s.forEach(e=>{if(n(e),e<0||e>=t)throw Error(`Wrong integer: ${e}`)});;){let e=0,n=!0;for(let o=i;o<s.length;o++){let a=s[o],l=t*e+a;if(!Number.isSafeInteger(l)||t*e/t!==e||l-a!=t*e||(e=l%r,s[o]=Math.floor(l/r),!Number.isSafeInteger(s[o])||s[o]*r+e!==l))throw Error("convertRadix: carry overflow");n&&(s[o]?n=!1:i=o)}if(o.push(e),n)break}for(let t=0;t<e.length-1&&0===e[t];t++)o.push(0);return o.reverse()}e(t.exports,"base64",()=>y),e(t.exports,"bech32",()=>E);let u=(e,t)=>t?u(t,e%t):e,h=(e,t)=>e+(t-u(e,t));function f(e,t,r,i){if(!Array.isArray(e))throw Error("convertRadix2: data should be array");if(t<=0||t>32)throw Error(`convertRadix2: wrong from=${t}`);if(r<=0||r>32)throw Error(`convertRadix2: wrong to=${r}`);if(h(t,r)>32)throw Error(`convertRadix2: carry overflow from=${t} to=${r} carryBits=${h(t,r)}`);let o=0,s=0,a=2**r-1,l=[];for(let i of e){if(n(i),i>=2**t)throw Error(`convertRadix2: invalid data word=${i} from=${t}`);if(o=o<<t|i,s+t>32)throw Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=r;s-=r)l.push((o>>s-r&a)>>>0);o&=2**s-1}if(o=o<<r-s&a,!i&&s>=t)throw Error("Excess padding");if(!i&&o)throw Error(`Non-zero padding: ${o}`);return i&&s>0&&l.push(o>>>0),l}function d(e,t=!1){if(n(e),e<=0||e>32)throw Error("radix2: bits should be in (0..32]");if(h(8,e)>32||h(e,8)>32)throw Error("radix2: carry overflow");return{encode:r=>{if(!(r instanceof Uint8Array))throw Error("radix2.encode input should be Uint8Array");return f(Array.from(r),8,e,!t)},decode:r=>{if(!Array.isArray(r)||r.length&&"number"!=typeof r[0])throw Error("radix2.decode input should be array of strings");return Uint8Array.from(f(r,e,8,t))}}}function p(e){if("function"!=typeof e)throw Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch(e){}}}i(d(4),o("0123456789ABCDEF"),s("")),i(d(5),o("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),a(5),s("")),i(d(5),o("0123456789ABCDEFGHIJKLMNOPQRSTUV"),a(5),s("")),i(d(5),o("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),s(""),l(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));let y=i(d(6),o("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),a(6),s("")),g=(i(d(6),o("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),a(6),s("")),e=>i((n(58),{encode:e=>{if(!(e instanceof Uint8Array))throw Error("radix.encode input should be Uint8Array");return c(Array.from(e),256,58)},decode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw Error("radix.decode input should be array of strings");return Uint8Array.from(c(e,58,256))}}),o(e),s("")));g("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),g("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),g("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");let b=i(o("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),s("")),m=[0x3b6a57b2,0x26508e6d,0x1ea119fa,0x3d4233dd,0x2a1462b3];function v(e){let t=e>>25,r=(0x1ffffff&e)<<5;for(let e=0;e<m.length;e++)(t>>e&1)==1&&(r^=m[e]);return r}function w(e,t,r=1){let n=e.length,i=1;for(let t=0;t<n;t++){let r=e.charCodeAt(t);if(r<33||r>126)throw Error(`Invalid prefix (${e})`);i=v(i)^r>>5}i=v(i);for(let t=0;t<n;t++)i=v(i)^31&e.charCodeAt(t);for(let e of t)i=v(i)^e;for(let e=0;e<6;e++)i=v(i);return i^=r,b.encode(f([i%0x40000000],30,5,!1))}function x(e){let t="bech32"===e?1:0x2bc830a3,r=d(5),n=r.decode,i=r.encode,o=p(n);function s(e,r=90){if("string"!=typeof e)throw Error(`bech32.decode input should be string, not ${typeof e}`);if(e.length<8||!1!==r&&e.length>r)throw TypeError(`Wrong string length: ${e.length} (${e}). Expected (8..${r})`);let n=e.toLowerCase();if(e!==n&&e!==e.toUpperCase())throw Error("String must be lowercase or uppercase");let i=(e=n).lastIndexOf("1");if(0===i||-1===i)throw Error('Letter "1" must be present between prefix and data only');let o=e.slice(0,i),a=e.slice(i+1);if(a.length<6)throw Error("Data must be at least 6 characters long");let l=b.decode(a).slice(0,-6),c=w(o,l,t);if(!a.endsWith(c))throw Error(`Invalid checksum in ${e}: expected "${c}"`);return{prefix:o,words:l}}let a=p(s);return{encode:function(e,r,n=90){if("string"!=typeof e)throw Error(`bech32.encode prefix should be string, not ${typeof e}`);if(!Array.isArray(r)||r.length&&"number"!=typeof r[0])throw Error(`bech32.encode words should be array of numbers, not ${typeof r}`);let i=e.length+7+r.length;if(!1!==n&&i>n)throw TypeError(`Length ${i} exceeds limit ${n}`);return e=e.toLowerCase(),`${e}1${b.encode(r)}${w(e,r,t)}`},decode:s,decodeToBytes:function(e){let{prefix:t,words:r}=s(e,!1);return{prefix:t,words:r,bytes:n(r)}},decodeUnsafe:a,fromWords:n,fromWordsUnsafe:o,toWords:i}}let E=x("bech32");x("bech32m"),i(d(4),o("0123456789abcdef"),s(""),l(e=>{if("string"!=typeof e||e.length%2)throw TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()}))}),o("3RPiR",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.unsafe=e.exports.siv=e.exports.gcm=e.exports.cfb=e.exports.cbc=e.exports.ecb=e.exports.ctr=e.exports.expandKeyDecLE=e.exports.expandKeyLE=void 0;var r=i("38xio"),n=i("8wowT"),o=i("87adI");let s=new Uint8Array(16);function a(e){return e<<1^283&-(e>>7)}function l(e,t){let r=0;for(;t>0;t>>=1)r^=e&-(1&t),e=a(e);return r}let c=(()=>{let e=new Uint8Array(256);for(let t=0,r=1;t<256;t++,r^=a(r))e[t]=r;let t=new Uint8Array(256);t[0]=99;for(let r=0;r<255;r++){let n=e[255-r];n|=n<<8,t[e[r]]=(n^n>>4^n>>5^n>>6^n>>7^99)&255}return t})(),u=c.map((e,t)=>c.indexOf(t)),h=e=>e<<24|e>>>8,f=e=>e<<8|e>>>24;function d(e,t){if(256!==e.length)throw Error("Wrong sbox length");let r=new Uint32Array(256).map((r,n)=>t(e[n])),n=r.map(f),i=n.map(f),o=i.map(f),s=new Uint32Array(65536),a=new Uint32Array(65536),l=new Uint16Array(65536);for(let t=0;t<256;t++)for(let c=0;c<256;c++){let u=256*t+c;s[u]=r[t]^n[c],a[u]=i[t]^o[c],l[u]=e[t]<<8|e[c]}return{sbox:e,sbox2:l,T0:r,T1:n,T2:i,T3:o,T01:s,T23:a}}let p=d(c,e=>l(e,3)<<24|e<<16|e<<8|l(e,2)),y=d(u,e=>l(e,11)<<24|l(e,13)<<16|l(e,9)<<8|l(e,14)),g=(()=>{let e=new Uint8Array(16);for(let t=0,r=1;t<16;t++,r=a(r))e[t]=r;return e})();function b(e){(0,o.bytes)(e);let t=e.length;if(![16,24,32].includes(t))throw Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);let{sbox2:n}=p,i=(0,r.u32)(e),s=i.length,a=e=>w(n,e,e,e,e),l=new Uint32Array(t+28);l.set(i);for(let e=s;e<l.length;e++){let t=l[e-1];e%s==0?t=a(h(t))^g[e/s-1]:s>6&&e%s==4&&(t=a(t)),l[e]=l[e-s]^t}return l}function m(e){let t=b(e),r=t.slice(),n=t.length,{sbox2:i}=p,{T0:o,T1:s,T2:a,T3:l}=y;for(let e=0;e<n;e+=4)for(let i=0;i<4;i++)r[e+i]=t[n-e-4+i];t.fill(0);for(let e=4;e<n-4;e++){let t=r[e],n=w(i,t,t,t,t);r[e]=o[255&n]^s[n>>>8&255]^a[n>>>16&255]^l[n>>>24]}return r}function v(e,t,r,n,i,o){return e[r<<8&65280|n>>>8&255]^t[i>>>8&65280|o>>>24&255]}function w(e,t,r,n,i){return e[255&t|65280&r]|e[n>>>16&255|i>>>16&65280]<<16}function x(e,t,r,n,i){let{sbox2:o,T01:s,T23:a}=p,l=0;t^=e[l++],r^=e[l++],n^=e[l++],i^=e[l++];let c=e.length/4-2;for(let o=0;o<c;o++){let o=e[l++]^v(s,a,t,r,n,i),c=e[l++]^v(s,a,r,n,i,t),u=e[l++]^v(s,a,n,i,t,r),h=e[l++]^v(s,a,i,t,r,n);t=o,r=c,n=u,i=h}let u=e[l++]^w(o,t,r,n,i),h=e[l++]^w(o,r,n,i,t);return{s0:u,s1:h,s2:e[l++]^w(o,n,i,t,r),s3:e[l++]^w(o,i,t,r,n)}}function E(e,t,r,n,i){let{sbox2:o,T01:s,T23:a}=y,l=0;t^=e[l++],r^=e[l++],n^=e[l++],i^=e[l++];let c=e.length/4-2;for(let o=0;o<c;o++){let o=e[l++]^v(s,a,t,i,n,r),c=e[l++]^v(s,a,r,t,i,n),u=e[l++]^v(s,a,n,r,t,i),h=e[l++]^v(s,a,i,n,r,t);t=o,r=c,n=u,i=h}let u=e[l++]^w(o,t,i,n,r),h=e[l++]^w(o,r,t,i,n);return{s0:u,s1:h,s2:e[l++]^w(o,n,r,t,i),s3:e[l++]^w(o,i,n,r,t)}}function P(e,t){if(!t)return new Uint8Array(e);if((0,o.bytes)(t),t.length<e)throw Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}function B(e,t,n,i){(0,o.bytes)(t,16),(0,o.bytes)(n);let s=n.length;i=P(s,i);let a=(0,r.u32)(t),{s0:l,s1:c,s2:u,s3:h}=x(e,a[0],a[1],a[2],a[3]),f=(0,r.u32)(n),d=(0,r.u32)(i);for(let r=0;r+4<=f.length;r+=4){d[r+0]=f[r+0]^l,d[r+1]=f[r+1]^c,d[r+2]=f[r+2]^u,d[r+3]=f[r+3]^h;let n=1;for(let e=t.length-1;e>=0;e--)n=n+(255&t[e])|0,t[e]=255&n,n>>>=8;({s0:l,s1:c,s2:u,s3:h}=x(e,a[0],a[1],a[2],a[3]))}let p=16*Math.floor(f.length/4);if(p<s){let e=new Uint32Array([l,c,u,h]),t=(0,r.u8)(e);for(let e=p,r=0;e<s;e++,r++)i[e]=n[e]^t[r]}return i}function k(e,t,n,i,s){(0,o.bytes)(n,16),(0,o.bytes)(i),s=P(i.length,s);let a=(0,r.u32)(n),l=(0,r.createView)(n),c=(0,r.u32)(i),u=(0,r.u32)(s),h=12*!t,f=i.length,d=l.getUint32(h,t),{s0:p,s1:y,s2:g,s3:b}=x(e,a[0],a[1],a[2],a[3]);for(let r=0;r+4<=c.length;r+=4)u[r+0]=c[r+0]^p,u[r+1]=c[r+1]^y,u[r+2]=c[r+2]^g,u[r+3]=c[r+3]^b,d=d+1>>>0,l.setUint32(h,d,t),{s0:p,s1:y,s2:g,s3:b}=x(e,a[0],a[1],a[2],a[3]);let m=16*Math.floor(c.length/4);if(m<f){let e=new Uint32Array([p,y,g,b]),t=(0,r.u8)(e);for(let e=m,r=0;e<f;e++,r++)s[e]=i[e]^t[r]}return s}function A(e){if((0,o.bytes)(e),e.length%16!=0)throw Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}function S(e,t,n){let i=e.length,o=i%16;if(!t&&0!==o)throw Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");let s=(0,r.u32)(e);if(t){let e=16-o;e||(e=16),i+=e}let a=P(i,n);return{b:s,o:(0,r.u32)(a),out:a}}function T(e,t){if(!t)return e;let r=e.length;if(!r)throw Error("aes/pcks5: empty ciphertext not allowed");let n=e[r-1];if(n<=0||n>16)throw Error(`aes/pcks5: wrong padding byte: ${n}`);let i=e.subarray(0,-n);for(let t=0;t<n;t++)if(e[r-t-1]!==n)throw Error("aes/pcks5: wrong padding");return i}function C(e){let t=new Uint8Array(16),n=(0,r.u32)(t);t.set(e);let i=16-e.length;for(let e=16-i;e<16;e++)t[e]=i;return n}function I(e,t,n,i,o){let s=e.create(n,i.length+(o?.length||0));o&&s.update(o),s.update(i);let a=new Uint8Array(16),l=(0,r.createView)(a);return o&&(0,r.setBigUint64)(l,0,BigInt(8*o.length),t),(0,r.setBigUint64)(l,8,BigInt(8*i.length),t),s.update(a),s.digest()}e.exports.expandKeyLE=b,e.exports.expandKeyDecLE=m,e.exports.ctr=(0,r.wrapCipher)({blockSize:16,nonceLength:16},function(e,t){function r(r,n){let i=b(e),o=t.slice(),s=B(i,o,r,n);return i.fill(0),o.fill(0),s}return(0,o.bytes)(e),(0,o.bytes)(t,16),{encrypt:(e,t)=>r(e,t),decrypt:(e,t)=>r(e,t)}}),e.exports.ecb=(0,r.wrapCipher)({blockSize:16},function(e,t={}){(0,o.bytes)(e);let n=!t.disablePadding;return{encrypt:(t,r)=>{(0,o.bytes)(t);let{b:i,o:s,out:a}=S(t,n,r),l=b(e),c=0;for(;c+4<=i.length;){let{s0:e,s1:t,s2:r,s3:n}=x(l,i[c+0],i[c+1],i[c+2],i[c+3]);s[c++]=e,s[c++]=t,s[c++]=r,s[c++]=n}if(n){let e=C(t.subarray(4*c)),{s0:r,s1:n,s2:i,s3:o}=x(l,e[0],e[1],e[2],e[3]);s[c++]=r,s[c++]=n,s[c++]=i,s[c++]=o}return l.fill(0),a},decrypt:(t,i)=>{A(t);let o=m(e),s=P(t.length,i),a=(0,r.u32)(t),l=(0,r.u32)(s);for(let e=0;e+4<=a.length;){let{s0:t,s1:r,s2:n,s3:i}=E(o,a[e+0],a[e+1],a[e+2],a[e+3]);l[e++]=t,l[e++]=r,l[e++]=n,l[e++]=i}return o.fill(0),T(s,n)}}}),e.exports.cbc=(0,r.wrapCipher)({blockSize:16,nonceLength:16},function(e,t,n={}){(0,o.bytes)(e),(0,o.bytes)(t,16);let i=!n.disablePadding;return{encrypt:(n,o)=>{let s=b(e),{b:a,o:l,out:c}=S(n,i,o),u=(0,r.u32)(t),h=u[0],f=u[1],d=u[2],p=u[3],y=0;for(;y+4<=a.length;)h^=a[y+0],f^=a[y+1],d^=a[y+2],p^=a[y+3],({s0:h,s1:f,s2:d,s3:p}=x(s,h,f,d,p)),l[y++]=h,l[y++]=f,l[y++]=d,l[y++]=p;if(i){let e=C(n.subarray(4*y));h^=e[0],f^=e[1],d^=e[2],p^=e[3],({s0:h,s1:f,s2:d,s3:p}=x(s,h,f,d,p)),l[y++]=h,l[y++]=f,l[y++]=d,l[y++]=p}return s.fill(0),c},decrypt:(n,o)=>{A(n);let s=m(e),a=(0,r.u32)(t),l=P(n.length,o),c=(0,r.u32)(n),u=(0,r.u32)(l),h=a[0],f=a[1],d=a[2],p=a[3];for(let e=0;e+4<=c.length;){let t=h,r=f,n=d,i=p;h=c[e+0],f=c[e+1];let{s0:o,s1:a,s2:l,s3:y}=E(s,h,f,d=c[e+2],p=c[e+3]);u[e++]=o^t,u[e++]=a^r,u[e++]=l^n,u[e++]=y^i}return s.fill(0),T(l,i)}}}),e.exports.cfb=(0,r.wrapCipher)({blockSize:16,nonceLength:16},function(e,t){function n(n,i,o){let s=b(e),a=n.length;o=P(a,o);let l=(0,r.u32)(n),c=(0,r.u32)(o),u=i?c:l,h=(0,r.u32)(t),f=h[0],d=h[1],p=h[2],y=h[3];for(let e=0;e+4<=l.length;){let{s0:t,s1:r,s2:n,s3:i}=x(s,f,d,p,y);c[e+0]=l[e+0]^t,c[e+1]=l[e+1]^r,c[e+2]=l[e+2]^n,c[e+3]=l[e+3]^i,f=u[e++],d=u[e++],p=u[e++],y=u[e++]}let g=16*Math.floor(l.length/4);if(g<a){({s0:f,s1:d,s2:p,s3:y}=x(s,f,d,p,y));let e=(0,r.u8)(new Uint32Array([f,d,p,y]));for(let t=g,r=0;t<a;t++,r++)o[t]=n[t]^e[r];e.fill(0)}return s.fill(0),o}return(0,o.bytes)(e),(0,o.bytes)(t,16),{encrypt:(e,t)=>n(e,!0,t),decrypt:(e,t)=>n(e,!1,t)}}),e.exports.gcm=(0,r.wrapCipher)({blockSize:16,nonceLength:12,tagLength:16},function(e,t,i){if((0,o.bytes)(t),0===t.length)throw Error("aes/gcm: empty nonce");function a(e,t,r){let o=I(n.ghash,!1,e,r,i);for(let e=0;e<t.length;e++)o[e]^=t[e];return o}function l(){let i=b(e),o=s.slice(),a=s.slice();if(k(i,!1,a,a,o),12===t.length)a.set(t);else{let e=s.slice(),i=(0,r.createView)(e);(0,r.setBigUint64)(i,8,BigInt(8*t.length),!1),n.ghash.create(o).update(t).update(e).digestInto(a)}let l=k(i,!1,a,s);return{xk:i,authKey:o,counter:a,tagMask:l}}return{encrypt:e=>{(0,o.bytes)(e);let{xk:t,authKey:r,counter:n,tagMask:i}=l(),s=new Uint8Array(e.length+16);k(t,!1,n,e,s);let c=a(r,i,s.subarray(0,s.length-16));return s.set(c,e.length),t.fill(0),s},decrypt:e=>{if((0,o.bytes)(e),e.length<16)throw Error("aes/gcm: ciphertext less than tagLen (16)");let{xk:t,authKey:n,counter:i,tagMask:s}=l(),c=e.subarray(0,-16),u=e.subarray(-16),h=a(n,s,c);if(!(0,r.equalBytes)(h,u))throw Error("aes/gcm: invalid ghash tag");let f=k(t,!1,i,c);return n.fill(0),s.fill(0),t.fill(0),f}}});let _=(e,t,r)=>n=>{if(!Number.isSafeInteger(n)||t>n||n>r)throw Error(`${e}: invalid value=${n}, must be [${t}..${r}]`)};function U(e){return null!=e&&"object"==typeof e&&(e instanceof Uint32Array||"Uint32Array"===e.constructor.name)}e.exports.siv=(0,r.wrapCipher)({blockSize:16,nonceLength:12,tagLength:16},function(e,t,i){let s=_("AAD",0,0x1000000000),a=_("plaintext",0,0x1000000000),l=_("nonce",12,12),c=_("ciphertext",16,0x1000000000+16);function u(){let n=e.length;if(16!==n&&24!==n&&32!==n)throw Error(`key length must be 16, 24 or 32 bytes, got: ${n} bytes`);let i=b(e),o=new Uint8Array(n),s=new Uint8Array(16),a=(0,r.u32)(t),l=0,c=a[0],u=a[1],h=a[2],f=0;for(let e of[s,o].map(r.u32)){let t=(0,r.u32)(e);for(let e=0;e<t.length;e+=2){let{s0:r,s1:n}=x(i,l,c,u,h);t[e+0]=r,t[e+1]=n,l=++f}}return i.fill(0),{authKey:s,encKey:b(o)}}function h(e,o,s){let a=I(n.polyval,!0,o,s,i);for(let e=0;e<12;e++)a[e]^=t[e];a[15]&=127;let l=(0,r.u32)(a),c=l[0],u=l[1],h=l[2],f=l[3];return{s0:c,s1:u,s2:h,s3:f}=x(e,c,u,h,f),l[0]=c,l[1]=u,l[2]=h,l[3]=f,a}function f(e,t,r){let n=t.slice();return n[15]|=128,k(e,!0,n,r)}return(0,o.bytes)(t),l(t.length),i&&((0,o.bytes)(i),s(i.length)),{encrypt:e=>{(0,o.bytes)(e),a(e.length);let{encKey:t,authKey:r}=u(),n=h(t,r,e),i=new Uint8Array(e.length+16);return i.set(n,e.length),i.set(f(t,n,e)),t.fill(0),r.fill(0),i},decrypt:e=>{(0,o.bytes)(e),c(e.length);let t=e.subarray(-16),{encKey:n,authKey:i}=u(),s=f(n,t,e.subarray(0,-16)),a=h(n,i,s);if(n.fill(0),i.fill(0),!(0,r.equalBytes)(t,a))throw Error("invalid polyval tag");return s}}}),e.exports.unsafe={expandKeyLE:b,expandKeyDecLE:m,encrypt:x,decrypt:E,encryptBlock:function(e,t){if((0,o.bytes)(t,16),!U(e))throw Error("_encryptBlock accepts result of expandKeyLE");let n=(0,r.u32)(t),{s0:i,s1:s,s2:a,s3:l}=x(e,n[0],n[1],n[2],n[3]);return n[0]=i,n[1]=s,n[2]=a,n[3]=l,t},decryptBlock:function(e,t){if((0,o.bytes)(t,16),!U(e))throw Error("_decryptBlock accepts result of expandKeyLE");let n=(0,r.u32)(t),{s0:i,s1:s,s2:a,s3:l}=E(e,n[0],n[1],n[2],n[3]);return n[0]=i,n[1]=s,n[2]=a,n[3]=l,t},ctrCounter:B,ctr32:k}}),o("38xio",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.u64Lengths=e.exports.setBigUint64=e.exports.wrapCipher=e.exports.Hash=e.exports.equalBytes=e.exports.checkOpts=e.exports.concatBytes=e.exports.toBytes=e.exports.bytesToUtf8=e.exports.utf8ToBytes=e.exports.asyncLoop=e.exports.nextTick=e.exports.numberToBytesBE=e.exports.bytesToNumberBE=e.exports.hexToNumber=e.exports.hexToBytes=e.exports.bytesToHex=e.exports.isLE=e.exports.createView=e.exports.u32=e.exports.u16=e.exports.u8=void 0;var r=i("87adI");if(e.exports.u8=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength),e.exports.u16=e=>new Uint16Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/2)),e.exports.u32=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),e.exports.createView=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),e.exports.isLE=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],!e.exports.isLE)throw Error("Non little-endian hardware is not supported");let n=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function o(e){(0,r.bytes)(e);let t="";for(let r=0;r<e.length;r++)t+=n[e[r]];return t}e.exports.bytesToHex=o;function s(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}function a(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);let t=e.length,r=t/2;if(t%2)throw Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let t=0,i=0;t<r;t++,i+=2){let r=s(e.charCodeAt(i)),o=s(e.charCodeAt(i+1));if(void 0===r||void 0===o)throw Error('hex string expected, got non-hex character "'+(e[i]+e[i+1])+'" at index '+i);n[t]=16*r+o}return n}function l(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}e.exports.hexToBytes=a,e.exports.hexToNumber=l,e.exports.bytesToNumberBE=function(e){return l(o(e))},e.exports.numberToBytesBE=function(e,t){return a(e.toString(16).padStart(2*t,"0"))};let c=async()=>{};async function u(t,r,n){let i=Date.now();for(let o=0;o<t;o++){n(o);let t=Date.now()-i;t>=0&&t<r||(await (0,e.exports.nextTick)(),i+=t)}}function h(e){if("string"!=typeof e)throw Error(`string expected, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function f(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);let i=BigInt(32),o=BigInt(0xffffffff),s=Number(r>>i&o),a=Number(r&o),l=4*!!n,c=4*!n;e.setUint32(t+l,s,n),e.setUint32(t+c,a,n)}e.exports.nextTick=c,e.exports.asyncLoop=u,e.exports.utf8ToBytes=h,e.exports.bytesToUtf8=function(e){return new TextDecoder().decode(e)},e.exports.toBytes=function(e){if("string"==typeof e)e=h(e);else if((0,r.isBytes)(e))e=e.slice();else throw Error(`Uint8Array expected, got ${typeof e}`);return e},e.exports.concatBytes=function(...e){let t=0;for(let n=0;n<e.length;n++){let i=e[n];(0,r.bytes)(i),t+=i.length}let n=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){let i=e[t];n.set(i,r),r+=i.length}return n},e.exports.checkOpts=function(e,t){if(null==t||"object"!=typeof t)throw Error("options must be defined");return Object.assign(e,t)},e.exports.equalBytes=function(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r},e.exports.Hash=class{},e.exports.wrapCipher=(e,t)=>(Object.assign(t,e),t),e.exports.setBigUint64=f,e.exports.u64Lengths=function(t,r){let n=new Uint8Array(16),i=(0,e.exports.createView)(n);return f(i,0,BigInt(r?r.length:0),!0),f(i,8,BigInt(t.length),!0),n}}),o("87adI",function(e,t){function r(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`positive integer expected, not ${e}`)}function n(e){if("boolean"!=typeof e)throw Error(`boolean expected, not ${e}`)}function i(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function o(e,...t){if(!i(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function s(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("hash must be wrapped by utils.wrapConstructor");r(e.outputLen),r(e.blockLen)}function a(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function l(e,t){o(e);let r=t.outputLen;if(e.length<r)throw Error(`digestInto() expects output buffer of length at least ${r}`)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.output=e.exports.exists=e.exports.hash=e.exports.bytes=e.exports.bool=e.exports.number=e.exports.isBytes=void 0,e.exports.number=r,e.exports.bool=n,e.exports.isBytes=i,e.exports.bytes=o,e.exports.hash=s,e.exports.exists=a,e.exports.output=l,e.exports.default={number:r,bool:n,bytes:o,hash:s,exists:a,output:l}}),o("8wowT",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.polyval=e.exports.ghash=e.exports._toGHASHKey=void 0;var r=i("38xio"),n=i("87adI");let o=new Uint8Array(16),s=(0,r.u32)(o),a=(e,t,r,n)=>({s3:r<<31|n>>>1,s2:t<<31|r>>>1,s1:e<<31|t>>>1,s0:e>>>1^-0x1f000000&-(1&n&1)}),l=e=>(e>>>0&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255;function c(e){e.reverse();let t=1&e[15],r=0;for(let t=0;t<e.length;t++){let n=e[t];e[t]=n>>>1|r,r=(1&n)<<7}return e[0]^=225&-t,e}e.exports._toGHASHKey=c;class u{constructor(e,t){var i;this.blockLen=16,this.outputLen=16,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,e=(0,r.toBytes)(e),(0,n.bytes)(e,16);let o=(0,r.createView)(e),s=o.getUint32(0,!1),c=o.getUint32(4,!1),u=o.getUint32(8,!1),h=o.getUint32(12,!1),f=[];for(let e=0;e<128;e++)f.push({s0:l(s),s1:l(c),s2:l(u),s3:l(h)}),{s0:s,s1:c,s2:u,s3:h}=a(s,c,u,h);let d=(i=t||1024)>65536?8:i>1024?4:2;if(![1,2,4,8].includes(d))throw Error(`ghash: wrong window size=${d}, should be 2, 4 or 8`);this.W=d;let p=128/d,y=this.windowSize=2**d,g=[];for(let e=0;e<p;e++)for(let t=0;t<y;t++){let r=0,n=0,i=0,o=0;for(let s=0;s<d;s++){if(!(t>>>d-s-1&1))continue;let{s0:a,s1:l,s2:c,s3:u}=f[d*e+s];r^=a,n^=l,i^=c,o^=u}g.push({s0:r,s1:n,s2:i,s3:o})}this.t=g}_updateBlock(e,t,r,n){e^=this.s0,t^=this.s1,r^=this.s2,n^=this.s3;let{W:i,t:o,windowSize:s}=this,a=0,l=0,c=0,u=0,h=(1<<i)-1,f=0;for(let d of[e,t,r,n])for(let e=0;e<4;e++){let t=d>>>8*e&255;for(let e=8/i-1;e>=0;e--){let{s0:r,s1:n,s2:d,s3:p}=o[f*s+(t>>>i*e&h)];a^=r,l^=n,c^=d,u^=p,f+=1}}this.s0=a,this.s1=l,this.s2=c,this.s3=u}update(e){e=(0,r.toBytes)(e),(0,n.exists)(this);let t=(0,r.u32)(e),i=Math.floor(e.length/16),a=e.length%16;for(let e=0;e<i;e++)this._updateBlock(t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]);return a&&(o.set(e.subarray(16*i)),this._updateBlock(s[0],s[1],s[2],s[3]),s.fill(0)),this}destroy(){let{t:e}=this;for(let t of e)t.s0=0,t.s1=0,t.s2=0,t.s3=0}digestInto(e){(0,n.exists)(this),(0,n.output)(e,this),this.finished=!0;let{s0:t,s1:i,s2:o,s3:s}=this,a=(0,r.u32)(e);return a[0]=t,a[1]=i,a[2]=o,a[3]=s,e}digest(){let e=new Uint8Array(16);return this.digestInto(e),this.destroy(),e}}class h extends u{constructor(e,t){let n=c((e=(0,r.toBytes)(e)).slice());super(n,t),n.fill(0)}update(e){e=(0,r.toBytes)(e),(0,n.exists)(this);let t=(0,r.u32)(e),i=e.length%16,a=Math.floor(e.length/16);for(let e=0;e<a;e++)this._updateBlock(l(t[4*e+3]),l(t[4*e+2]),l(t[4*e+1]),l(t[4*e+0]));return i&&(o.set(e.subarray(16*a)),this._updateBlock(l(s[3]),l(s[2]),l(s[1]),l(s[0])),s.fill(0)),this}digestInto(e){(0,n.exists)(this),(0,n.output)(e,this),this.finished=!0;let{s0:t,s1:i,s2:o,s3:s}=this,a=(0,r.u32)(e);return a[0]=t,a[1]=i,a[2]=o,a[3]=s,e.reverse()}}function f(e){let t=(t,n)=>e(n,t.length).update((0,r.toBytes)(t)).digest(),n=e(new Uint8Array(16),0);return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=(t,r)=>e(t,r),t}e.exports.ghash=f((e,t)=>new u(e,t)),e.exports.polyval=f((e,t)=>new h(e,t))}),o("lAjhr",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.xchacha20poly1305=e.exports.chacha20poly1305=e.exports._poly1305_aead=e.exports.chacha12=e.exports.chacha8=e.exports.xchacha20=e.exports.chacha20=e.exports.chacha20orig=e.exports.hchacha=void 0;var r=i("38xio"),n=i("byidz"),o=i("8niJx"),s=i("87adI");function a(e,t,r,n,i,s=20){let l=e[0],c=e[1],u=e[2],h=e[3],f=t[0],d=t[1],p=t[2],y=t[3],g=t[4],b=t[5],m=t[6],v=t[7],w=r[0],x=r[1],E=r[2],P=l,B=c,k=u,A=h,S=f,T=d,C=p,I=y,_=g,U=b,$=m,L=v,N=i,R=w,O=x,D=E;for(let e=0;e<s;e+=2)P=P+S|0,_=_+(N=(0,o.rotl)(N^P,16))|0,P=P+(S=(0,o.rotl)(S^_,12))|0,_=_+(N=(0,o.rotl)(N^P,8))|0,S=(0,o.rotl)(S^_,7),B=B+T|0,U=U+(R=(0,o.rotl)(R^B,16))|0,B=B+(T=(0,o.rotl)(T^U,12))|0,U=U+(R=(0,o.rotl)(R^B,8))|0,T=(0,o.rotl)(T^U,7),k=k+C|0,$=$+(O=(0,o.rotl)(O^k,16))|0,k=k+(C=(0,o.rotl)(C^$,12))|0,$=$+(O=(0,o.rotl)(O^k,8))|0,C=(0,o.rotl)(C^$,7),A=A+I|0,L=L+(D=(0,o.rotl)(D^A,16))|0,A=A+(I=(0,o.rotl)(I^L,12))|0,L=L+(D=(0,o.rotl)(D^A,8))|0,I=(0,o.rotl)(I^L,7),P=P+T|0,$=$+(D=(0,o.rotl)(D^P,16))|0,P=P+(T=(0,o.rotl)(T^$,12))|0,$=$+(D=(0,o.rotl)(D^P,8))|0,T=(0,o.rotl)(T^$,7),B=B+C|0,L=L+(N=(0,o.rotl)(N^B,16))|0,B=B+(C=(0,o.rotl)(C^L,12))|0,L=L+(N=(0,o.rotl)(N^B,8))|0,C=(0,o.rotl)(C^L,7),k=k+I|0,_=_+(R=(0,o.rotl)(R^k,16))|0,k=k+(I=(0,o.rotl)(I^_,12))|0,_=_+(R=(0,o.rotl)(R^k,8))|0,I=(0,o.rotl)(I^_,7),A=A+S|0,U=U+(O=(0,o.rotl)(O^A,16))|0,A=A+(S=(0,o.rotl)(S^U,12))|0,U=U+(O=(0,o.rotl)(O^A,8))|0,S=(0,o.rotl)(S^U,7);let M=0;n[M++]=l+P|0,n[M++]=c+B|0,n[M++]=u+k|0,n[M++]=h+A|0,n[M++]=f+S|0,n[M++]=d+T|0,n[M++]=p+C|0,n[M++]=y+I|0,n[M++]=g+_|0,n[M++]=b+U|0,n[M++]=m+$|0,n[M++]=v+L|0,n[M++]=i+N|0,n[M++]=w+R|0,n[M++]=x+O|0,n[M++]=E+D|0}function l(e,t,r,n){let i=e[0],s=e[1],a=e[2],l=e[3],c=t[0],u=t[1],h=t[2],f=t[3],d=t[4],p=t[5],y=t[6],g=t[7],b=r[0],m=r[1],v=r[2],w=r[3];for(let e=0;e<20;e+=2)i=i+c|0,d=d+(b=(0,o.rotl)(b^i,16))|0,i=i+(c=(0,o.rotl)(c^d,12))|0,d=d+(b=(0,o.rotl)(b^i,8))|0,c=(0,o.rotl)(c^d,7),s=s+u|0,p=p+(m=(0,o.rotl)(m^s,16))|0,s=s+(u=(0,o.rotl)(u^p,12))|0,p=p+(m=(0,o.rotl)(m^s,8))|0,u=(0,o.rotl)(u^p,7),a=a+h|0,y=y+(v=(0,o.rotl)(v^a,16))|0,a=a+(h=(0,o.rotl)(h^y,12))|0,y=y+(v=(0,o.rotl)(v^a,8))|0,h=(0,o.rotl)(h^y,7),l=l+f|0,g=g+(w=(0,o.rotl)(w^l,16))|0,l=l+(f=(0,o.rotl)(f^g,12))|0,g=g+(w=(0,o.rotl)(w^l,8))|0,f=(0,o.rotl)(f^g,7),i=i+u|0,y=y+(w=(0,o.rotl)(w^i,16))|0,i=i+(u=(0,o.rotl)(u^y,12))|0,y=y+(w=(0,o.rotl)(w^i,8))|0,u=(0,o.rotl)(u^y,7),s=s+h|0,g=g+(b=(0,o.rotl)(b^s,16))|0,s=s+(h=(0,o.rotl)(h^g,12))|0,g=g+(b=(0,o.rotl)(b^s,8))|0,h=(0,o.rotl)(h^g,7),a=a+f|0,d=d+(m=(0,o.rotl)(m^a,16))|0,a=a+(f=(0,o.rotl)(f^d,12))|0,d=d+(m=(0,o.rotl)(m^a,8))|0,f=(0,o.rotl)(f^d,7),l=l+c|0,p=p+(v=(0,o.rotl)(v^l,16))|0,l=l+(c=(0,o.rotl)(c^p,12))|0,p=p+(v=(0,o.rotl)(v^l,8))|0,c=(0,o.rotl)(c^p,7);let x=0;n[x++]=i,n[x++]=s,n[x++]=a,n[x++]=l,n[x++]=b,n[x++]=m,n[x++]=v,n[x++]=w}e.exports.hchacha=l,e.exports.chacha20orig=(0,o.createCipher)(a,{counterRight:!1,counterLength:8,allowShortKeys:!0}),e.exports.chacha20=(0,o.createCipher)(a,{counterRight:!1,counterLength:4,allowShortKeys:!1}),e.exports.xchacha20=(0,o.createCipher)(a,{counterRight:!1,counterLength:8,extendNonceFn:l,allowShortKeys:!1}),e.exports.chacha8=(0,o.createCipher)(a,{counterRight:!1,counterLength:4,rounds:8}),e.exports.chacha12=(0,o.createCipher)(a,{counterRight:!1,counterLength:4,rounds:12});let c=new Uint8Array(16),u=(e,t)=>{e.update(t);let r=t.length%16;r&&e.update(c.subarray(r))},h=new Uint8Array(32);function f(e,t,i,o,s){let a=e(t,i,h),l=n.poly1305.create(a);s&&u(l,s),u(l,o);let c=new Uint8Array(16),f=(0,r.createView)(c);(0,r.setBigUint64)(f,0,BigInt(s?s.length:0),!0),(0,r.setBigUint64)(f,8,BigInt(o.length),!0),l.update(c);let d=l.digest();return a.fill(0),d}e.exports._poly1305_aead=e=>(t,n,i)=>((0,s.bytes)(t,32),(0,s.bytes)(n),{encrypt:(r,o)=>{let a=r.length,l=a+16;o?(0,s.bytes)(o,l):o=new Uint8Array(l),e(t,n,r,o,1);let c=f(e,t,n,o.subarray(0,-16),i);return o.set(c,a),o},decrypt:(o,a)=>{let l=o.length,c=l-16;if(l<16)throw Error("encrypted data must be at least 16 bytes");a?(0,s.bytes)(a,c):a=new Uint8Array(c);let u=o.subarray(0,-16),h=o.subarray(-16),d=f(e,t,n,u,i);if(!(0,r.equalBytes)(h,d))throw Error("invalid tag");return e(t,n,u,a,1),a}}),e.exports.chacha20poly1305=(0,r.wrapCipher)({blockSize:64,nonceLength:12,tagLength:16},(0,e.exports._poly1305_aead)(e.exports.chacha20)),e.exports.xchacha20poly1305=(0,r.wrapCipher)({blockSize:64,nonceLength:24,tagLength:16},(0,e.exports._poly1305_aead)(e.exports.xchacha20))}),o("byidz",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.poly1305=e.exports.wrapConstructorWithKey=void 0;var r=i("87adI"),n=i("38xio");let o=(e,t)=>255&e[t++]|(255&e[t++])<<8;class s{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=(0,n.toBytes)(e),(0,r.bytes)(e,32);let t=o(e,0),i=o(e,2),s=o(e,4),a=o(e,6),l=o(e,8),c=o(e,10),u=o(e,12),h=o(e,14);this.r[0]=8191&t,this.r[1]=(t>>>13|i<<3)&8191,this.r[2]=(i>>>10|s<<6)&7939,this.r[3]=(s>>>7|a<<9)&8191,this.r[4]=(a>>>4|l<<12)&255,this.r[5]=l>>>1&8190,this.r[6]=(l>>>14|c<<2)&8191,this.r[7]=(c>>>11|u<<5)&8065,this.r[8]=(u>>>8|h<<8)&8191,this.r[9]=h>>>5&127;for(let t=0;t<8;t++)this.pad[t]=o(e,16+2*t)}process(e,t,r=!1){let{h:n,r:i}=this,s=i[0],a=i[1],l=i[2],c=i[3],u=i[4],h=i[5],f=i[6],d=i[7],p=i[8],y=i[9],g=o(e,t+0),b=o(e,t+2),m=o(e,t+4),v=o(e,t+6),w=o(e,t+8),x=o(e,t+10),E=o(e,t+12),P=o(e,t+14),B=n[0]+(8191&g),k=n[1]+((g>>>13|b<<3)&8191),A=n[2]+((b>>>10|m<<6)&8191),S=n[3]+((m>>>7|v<<9)&8191),T=n[4]+((v>>>4|w<<12)&8191),C=n[5]+(w>>>1&8191),I=n[6]+((w>>>14|x<<2)&8191),_=n[7]+((x>>>11|E<<5)&8191),U=n[8]+((E>>>8|P<<8)&8191),$=n[9]+(P>>>5|2048*!r),L=0,N=0+B*s+5*y*k+5*p*A+5*d*S+5*f*T;L=N>>>13,N&=8191,N+=5*h*C+5*u*I+5*c*_+5*l*U+5*a*$,L+=N>>>13,N&=8191;let R=L+B*a+k*s+5*y*A+5*p*S+5*d*T;L=R>>>13,R&=8191,R+=5*f*C+5*h*I+5*u*_+5*c*U+5*l*$,L+=R>>>13,R&=8191;let O=L+B*l+k*a+A*s+5*y*S+5*p*T;L=O>>>13,O&=8191,O+=5*d*C+5*f*I+5*h*_+5*u*U+5*c*$,L+=O>>>13,O&=8191;let D=L+B*c+k*l+A*a+S*s+5*y*T;L=D>>>13,D&=8191,D+=5*p*C+5*d*I+5*f*_+5*h*U+5*u*$,L+=D>>>13,D&=8191;let M=L+B*u+k*c+A*l+S*a+T*s;L=M>>>13,M&=8191,M+=5*y*C+5*p*I+5*d*_+5*f*U+5*h*$,L+=M>>>13,M&=8191;let H=L+B*h+k*u+A*c+S*l+T*a;L=H>>>13,H&=8191,H+=C*s+5*y*I+5*p*_+5*d*U+5*f*$,L+=H>>>13,H&=8191;let j=L+B*f+k*h+A*u+S*c+T*l;L=j>>>13,j&=8191,j+=C*a+I*s+5*y*_+5*p*U+5*d*$,L+=j>>>13,j&=8191;let W=L+B*d+k*f+A*h+S*u+T*c;L=W>>>13,W&=8191,W+=C*l+I*a+_*s+5*y*U+5*p*$,L+=W>>>13,W&=8191;let F=L+B*p+k*d+A*f+S*h+T*u;L=F>>>13,F&=8191,F+=C*c+I*l+_*a+U*s+5*y*$,L+=F>>>13,F&=8191;let q=L+B*y+k*p+A*d+S*f+T*h;L=q>>>13,q&=8191,q+=C*u+I*c+_*l+U*a+$*s,L+=q>>>13,q&=8191,N=8191&(L=(L=(L<<2)+L|0)+N|0),L>>>=13,R+=L,n[0]=N,n[1]=R,n[2]=O,n[3]=D,n[4]=M,n[5]=H,n[6]=j,n[7]=W,n[8]=F,n[9]=q}finalize(){let{h:e,pad:t}=this,r=new Uint16Array(10),n=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=n,n=e[t]>>>13,e[t]&=8191;e[0]+=5*n,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,r[0]=e[0]+5,n=r[0]>>>13,r[0]&=8191;for(let t=1;t<10;t++)r[t]=e[t]+n,n=r[t]>>>13,r[t]&=8191;r[9]-=8192;let i=(1^n)-1;for(let e=0;e<10;e++)r[e]&=i;i=~i;for(let t=0;t<10;t++)e[t]=e[t]&i|r[t];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=65535&o;for(let r=1;r<8;r++)o=(e[r]+t[r]|0)+(o>>>16)|0,e[r]=65535&o}update(e){(0,r.exists)(this);let{buffer:t,blockLen:i}=this,o=(e=(0,n.toBytes)(e)).length;for(let r=0;r<o;){let n=Math.min(i-this.pos,o-r);if(n===i){for(;i<=o-r;r+=i)this.process(e,r);continue}t.set(e.subarray(r,r+n),this.pos),this.pos+=n,r+=n,this.pos===i&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){(0,r.exists)(this),(0,r.output)(e,this),this.finished=!0;let{buffer:t,h:n}=this,{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let o=0;for(let t=0;t<8;t++)e[o++]=n[t]>>>0,e[o++]=n[t]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}}function a(e){let t=(t,r)=>e(r).update((0,n.toBytes)(t)).digest(),r=e(new Uint8Array(32));return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}e.exports.wrapConstructorWithKey=a,e.exports.poly1305=a(e=>new s(e))}),o("8niJx",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.createCipher=e.exports.rotl=e.exports.sigma=void 0;var r=i("87adI"),n=i("38xio");let o=e=>Uint8Array.from(e.split("").map(e=>e.charCodeAt(0))),s=o("expand 16-byte k"),a=o("expand 32-byte k"),l=(0,n.u32)(s),c=(0,n.u32)(a);function u(e){return e.byteOffset%4==0}e.exports.sigma=c.slice(),e.exports.rotl=function(e,t){return e<<t|e>>>32-t};let h=0x100000000-1,f=new Uint32Array;e.exports.createCipher=function(e,t){let{allowShortKeys:i,extendNonceFn:o,counterLength:s,counterRight:a,rounds:d}=(0,n.checkOpts)({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw Error("core must be a function");return(0,r.number)(s),(0,r.number)(d),(0,r.bool)(a),(0,r.bool)(i),(t,p,y,g,b=0)=>{(0,r.bytes)(t),(0,r.bytes)(p),(0,r.bytes)(y);let m=y.length;if(g||(g=new Uint8Array(m)),(0,r.bytes)(g),(0,r.number)(b),b<0||b>=h)throw Error("arx: counter overflow");if(g.length<m)throw Error(`arx: output (${g.length}) is shorter than data (${m})`);let v=[],w=t.length,x,E;if(32===w)x=t.slice(),v.push(x),E=c;else if(16===w&&i)(x=new Uint8Array(32)).set(t),x.set(t,16),E=l,v.push(x);else throw Error(`arx: invalid 32-byte key, got length=${w}`);u(p)||(p=p.slice(),v.push(p));let P=(0,n.u32)(x);if(o){if(24!==p.length)throw Error("arx: extended nonce must be 24 bytes");o(E,P,(0,n.u32)(p.subarray(0,16)),P),p=p.subarray(16)}let B=16-s;if(B!==p.length)throw Error(`arx: nonce must be ${B} or 16 bytes`);if(12!==B){let e=new Uint8Array(12);e.set(p,a?0:12-p.length),p=e,v.push(p)}for(!function(e,t,r,i,o,s,a,l){let c=o.length,d=new Uint8Array(64),p=(0,n.u32)(d),y=u(o)&&u(s),g=y?(0,n.u32)(o):f,b=y?(0,n.u32)(s):f;for(let n=0;n<c;a++){if(e(t,r,i,p,a,l),a>=h)throw Error("arx: counter overflow");let u=Math.min(64,c-n);if(y&&64===u){let e=n/4;if(n%4!=0)throw Error("arx: invalid block position");for(let t=0,r;t<16;t++)b[r=e+t]=g[r]^p[t];n+=64;continue}for(let e=0,t;e<u;e++)s[t=n+e]=o[t]^d[e];n+=u}}(e,E,P,(0,n.u32)(p),y,g,b,d);v.length>0;)v.pop().fill(0);return g}}}),o("aN9nT",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.hkdf=e.exports.expand=e.exports.extract=void 0;var r=i("dNiq9"),n=i("3Bcdj"),o=i("70Xw9");function s(e,t,i){return r.default.hash(e),void 0===i&&(i=new Uint8Array(e.outputLen)),(0,o.hmac)(e,(0,n.toBytes)(i),(0,n.toBytes)(t))}e.exports.extract=s;let a=new Uint8Array([0]),l=new Uint8Array;function c(e,t,n,i=32){if(r.default.hash(e),r.default.number(i),i>255*e.outputLen)throw Error("Length should be <= 255*HashLen");let s=Math.ceil(i/e.outputLen);void 0===n&&(n=l);let u=new Uint8Array(s*e.outputLen),h=o.hmac.create(e,t),f=h._cloneInto(),d=new Uint8Array(h.outputLen);for(let t=0;t<s;t++)a[0]=t+1,f.update(0===t?l:d).update(n).update(a).digestInto(d),u.set(d,e.outputLen*t),h._cloneInto(f);return h.destroy(),f.destroy(),d.fill(0),a.fill(0),u.slice(0,i)}e.exports.expand=c,e.exports.hkdf=(e,t,r,n,i)=>c(e,s(e,t,r),n,i)}),o("70Xw9",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.hmac=e.exports.HMAC=void 0;var r=i("dNiq9"),n=i("3Bcdj");class o extends n.Hash{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,r.default.hash(e);let i=(0,n.toBytes)(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(i.length>o?e.create().update(i).digest():i);for(let e=0;e<s.length;e++)s[e]^=54;this.iHash.update(s),this.oHash=e.create();for(let e=0;e<s.length;e++)s[e]^=106;this.oHash.update(s),s.fill(0)}update(e){return r.default.exists(this),this.iHash.update(e),this}digestInto(e){r.default.exists(this),r.default.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:r,finished:n,destroyed:i,blockLen:o,outputLen:s}=this;return e.finished=n,e.destroyed=i,e.blockLen=o,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}e.exports.HMAC=o,e.exports.hmac=(e,t,r)=>new o(e,t).update(r).digest(),e.exports.hmac.create=(e,t)=>new o(e,t)}),o("imRk1",function(t,r){e(t.exports,"Invoice",()=>N),e(t.exports,"LightningAddress",()=>z),e(t.exports,"fiat",()=>J);let{bech32:n,hex:i,utf8:o}=(function(e,t){function r(e){if(!Number.isSafeInteger(e))throw Error(`Wrong integer: ${e}`)}function n(...e){let t=(e,t)=>r=>e(t(r));return{encode:Array.from(e).reverse().reduce((e,r)=>e?t(e,r.encode):r.encode,void 0),decode:e.reduce((e,r)=>e?t(e,r.decode):r.decode,void 0)}}function i(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw Error("alphabet.encode input should be an array of numbers");return t.map(t=>{if(r(t),t<0||t>=e.length)throw Error(`Digit index outside alphabet: ${t} (alphabet: ${e.length})`);return e[t]})},decode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw Error("alphabet.decode input should be array of strings");return t.map(t=>{if("string"!=typeof t)throw Error(`alphabet.decode: not string element=${t}`);let r=e.indexOf(t);if(-1===r)throw Error(`Unknown letter: "${t}". Allowed: ${e}`);return r})}}}function o(e=""){if("string"!=typeof e)throw Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw Error("join.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw Error(`join.encode: non-string input=${e}`);return t.join(e)},decode:t=>{if("string"!=typeof t)throw Error("join.decode input should be string");return t.split(e)}}}function s(e,t="="){if(r(e),"string"!=typeof t)throw Error("padding chr should be string");return{encode(r){if(!Array.isArray(r)||r.length&&"string"!=typeof r[0])throw Error("padding.encode input should be array of strings");for(let e of r)if("string"!=typeof e)throw Error(`padding.encode: non-string input=${e}`);for(;r.length*e%8;)r.push(t);return r},decode(r){if(!Array.isArray(r)||r.length&&"string"!=typeof r[0])throw Error("padding.encode input should be array of strings");for(let e of r)if("string"!=typeof e)throw Error(`padding.decode: non-string input=${e}`);let n=r.length;if(n*e%8)throw Error("Invalid padding: string should have whole number of bytes");for(;n>0&&r[n-1]===t;n--)if(!((n-1)*e%8))throw Error("Invalid padding: string has too much padding");return r.slice(0,n)}}}function a(e){if("function"!=typeof e)throw Error("normalize fn should be function");return{encode:e=>e,decode:t=>e(t)}}function l(e,t,n){if(t<2)throw Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw Error("convertRadix: data should be array");if(!e.length)return[];let i=0,o=[],s=Array.from(e);for(s.forEach(e=>{if(r(e),e<0||e>=t)throw Error(`Wrong integer: ${e}`)});;){let e=0,r=!0;for(let o=i;o<s.length;o++){let a=s[o],l=t*e+a;if(!Number.isSafeInteger(l)||t*e/t!==e||l-a!=t*e||(e=l%n,s[o]=Math.floor(l/n),!Number.isSafeInteger(s[o])||s[o]*n+e!==l))throw Error("convertRadix: carry overflow");r&&(s[o]?r=!1:i=o)}if(o.push(e),r)break}for(let t=0;t<e.length-1&&0===e[t];t++)o.push(0);return o.reverse()}Object.defineProperty(t,"__esModule",{value:!0}),t.bytes=t.stringToBytes=t.str=t.bytesToString=t.hex=t.utf8=t.bech32m=t.bech32=t.base58check=t.base58xmr=t.base58xrp=t.base58flickr=t.base58=t.base64url=t.base64=t.base32crockford=t.base32hex=t.base32=t.base16=t.utils=t.assertNumber=void 0,t.assertNumber=r;let c=(e,t)=>t?c(t,e%t):e,u=(e,t)=>e+(t-c(e,t));function h(e,t,n,i){if(!Array.isArray(e))throw Error("convertRadix2: data should be array");if(t<=0||t>32)throw Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw Error(`convertRadix2: wrong to=${n}`);if(u(t,n)>32)throw Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${u(t,n)}`);let o=0,s=0,a=2**n-1,l=[];for(let i of e){if(r(i),i>=2**t)throw Error(`convertRadix2: invalid data word=${i} from=${t}`);if(o=o<<t|i,s+t>32)throw Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)l.push((o>>s-n&a)>>>0);o&=2**s-1}if(o=o<<n-s&a,!i&&s>=t)throw Error("Excess padding");if(!i&&o)throw Error(`Non-zero padding: ${o}`);return i&&s>0&&l.push(o>>>0),l}function f(e){return r(e),{encode:t=>{if(!(t instanceof Uint8Array))throw Error("radix.encode input should be Uint8Array");return l(Array.from(t),256,e)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw Error("radix.decode input should be array of strings");return Uint8Array.from(l(t,e,256))}}}function d(e,t=!1){if(r(e),e<=0||e>32)throw Error("radix2: bits should be in (0..32]");if(u(8,e)>32||u(e,8)>32)throw Error("radix2: carry overflow");return{encode:r=>{if(!(r instanceof Uint8Array))throw Error("radix2.encode input should be Uint8Array");return h(Array.from(r),8,e,!t)},decode:r=>{if(!Array.isArray(r)||r.length&&"number"!=typeof r[0])throw Error("radix2.decode input should be array of strings");return Uint8Array.from(h(r,e,8,t))}}}function p(e){if("function"!=typeof e)throw Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch(e){}}}function y(e,t){if(r(e),"function"!=typeof t)throw Error("checksum fn should be function");return{encode(r){if(!(r instanceof Uint8Array))throw Error("checksum.encode: input should be Uint8Array");let n=t(r).slice(0,e),i=new Uint8Array(r.length+e);return i.set(r),i.set(n,r.length),i},decode(r){if(!(r instanceof Uint8Array))throw Error("checksum.decode: input should be Uint8Array");let n=r.slice(0,-e),i=t(n).slice(0,e),o=r.slice(-e);for(let t=0;t<e;t++)if(i[t]!==o[t])throw Error("Invalid checksum");return n}}}t.utils={alphabet:i,chain:n,checksum:y,radix:f,radix2:d,join:o,padding:s},t.base16=n(d(4),i("0123456789ABCDEF"),o("")),t.base32=n(d(5),i("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),s(5),o("")),t.base32hex=n(d(5),i("0123456789ABCDEFGHIJKLMNOPQRSTUV"),s(5),o("")),t.base32crockford=n(d(5),i("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),o(""),a(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),t.base64=n(d(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),s(6),o("")),t.base64url=n(d(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),s(6),o(""));let g=e=>n(f(58),i(e),o(""));t.base58=g("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),t.base58flickr=g("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),t.base58xrp=g("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");let b=[0,2,3,5,6,7,9,10,11];t.base58xmr={encode(e){let r="";for(let n=0;n<e.length;n+=8){let i=e.subarray(n,n+8);r+=t.base58.encode(i).padStart(b[i.length],"1")}return r},decode(e){let r=[];for(let n=0;n<e.length;n+=11){let i=e.slice(n,n+11),o=b.indexOf(i.length),s=t.base58.decode(i);for(let e=0;e<s.length-o;e++)if(0!==s[e])throw Error("base58xmr: wrong padding");r=r.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(r)}},t.base58check=e=>n(y(4,t=>e(e(t))),t.base58);let m=n(i("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),o("")),v=[0x3b6a57b2,0x26508e6d,0x1ea119fa,0x3d4233dd,0x2a1462b3];function w(e){let t=e>>25,r=(0x1ffffff&e)<<5;for(let e=0;e<v.length;e++)1==(t>>e&1)&&(r^=v[e]);return r}function x(e,t,r=1){let n=e.length,i=1;for(let t=0;t<n;t++){let r=e.charCodeAt(t);if(r<33||r>126)throw Error(`Invalid prefix (${e})`);i=w(i)^r>>5}i=w(i);for(let t=0;t<n;t++)i=w(i)^31&e.charCodeAt(t);for(let e of t)i=w(i)^e;for(let e=0;e<6;e++)i=w(i);return i^=r,m.encode(h([i%0x40000000],30,5,!1))}function E(e){let t="bech32"===e?1:0x2bc830a3,r=d(5),n=r.decode,i=r.encode,o=p(n);function s(e,r=90){if("string"!=typeof e)throw Error("bech32.decode input should be string, not "+typeof e);if(e.length<8||!1!==r&&e.length>r)throw TypeError(`Wrong string length: ${e.length} (${e}). Expected (8..${r})`);let n=e.toLowerCase();if(e!==n&&e!==e.toUpperCase())throw Error("String must be lowercase or uppercase");let i=(e=n).lastIndexOf("1");if(0===i||-1===i)throw Error('Letter "1" must be present between prefix and data only');let o=e.slice(0,i),a=e.slice(i+1);if(a.length<6)throw Error("Data must be at least 6 characters long");let l=m.decode(a).slice(0,-6),c=x(o,l,t);if(!a.endsWith(c))throw Error(`Invalid checksum in ${e}: expected "${c}"`);return{prefix:o,words:l}}return{encode:function(e,r,n=90){if("string"!=typeof e)throw Error("bech32.encode prefix should be string, not "+typeof e);if(!Array.isArray(r)||r.length&&"number"!=typeof r[0])throw Error("bech32.encode words should be array of numbers, not "+typeof r);let i=e.length+7+r.length;if(!1!==n&&i>n)throw TypeError(`Length ${i} exceeds limit ${n}`);return`${e=e.toLowerCase()}1${m.encode(r)}${x(e,r,t)}`},decode:s,decodeToBytes:function(e){let{prefix:t,words:r}=s(e,!1);return{prefix:t,words:r,bytes:n(r)}},decodeUnsafe:p(s),fromWords:n,fromWordsUnsafe:o,toWords:i}}t.bech32=E("bech32"),t.bech32m=E("bech32m"),t.utf8={encode:e=>(new TextDecoder).decode(e),decode:e=>(new TextEncoder).encode(e)},t.hex=n(d(4),i("0123456789abcdef"),o(""),a(e=>{if("string"!=typeof e||e.length%2)throw TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()}));let P={utf8:t.utf8,hex:t.hex,base16:t.base16,base32:t.base32,base64:t.base64,base64url:t.base64url,base58:t.base58,base58xmr:t.base58xmr},B=`Invalid encoding type. Available types: ${Object.keys(P).join(", ")}`;t.bytesToString=(e,t)=>{if("string"!=typeof e||!P.hasOwnProperty(e))throw TypeError(B);if(!(t instanceof Uint8Array))throw TypeError("bytesToString() expects Uint8Array");return P[e].encode(t)},t.str=t.bytesToString,t.stringToBytes=(e,t)=>{if(!P.hasOwnProperty(e))throw TypeError(B);if("string"!=typeof t)throw TypeError("stringToBytes() expects string");return P[e].decode(t)},t.bytes=t.stringToBytes}(v={exports:{}},v.exports),v.exports),s={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},a={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},l={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},c={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},u={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},h=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],f={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},d=BigInt("2100000000000000000"),p=BigInt(1e11),y={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},g={};for(let e=0,t=Object.keys(y);e<t.length;e++){let r=t[e];g[y[t[e]].toString()]=r}let b={1:e=>i.encode(n.fromWordsUnsafe(e)),16:e=>i.encode(n.fromWordsUnsafe(e)),13:e=>o.encode(n.fromWordsUnsafe(e)),19:e=>i.encode(n.fromWordsUnsafe(e)),23:e=>i.encode(n.fromWordsUnsafe(e)),27:e=>i.encode(n.fromWordsUnsafe(e)),6:m,24:m,3:function(e){let t=[],r,o,s,a,l,c=n.fromWordsUnsafe(e);for(;c.length>0;)r=i.encode(c.slice(0,33)),o=i.encode(c.slice(33,41)),s=parseInt(i.encode(c.slice(41,45)),16),a=parseInt(i.encode(c.slice(45,49)),16),l=parseInt(i.encode(c.slice(49,51)),16),c=c.slice(51),t.push({pubkey:r,short_channel_id:o,fee_base_msat:s,fee_proportional_millionths:a,cltv_expiry_delta:l});return t},5:function(e){let t=e.slice().reverse().map(e=>[!!(1&e),!!(2&e),!!(4&e),!!(8&e),!!(16&e)]).reduce((e,t)=>e.concat(t),[]);for(;t.length<2*h.length;)t.push(!1);let r={};h.forEach((e,n)=>{let i;i=t[2*n]?"required":t[2*n+1]?"supported":"unsupported",r[e]=i});let n=t.slice(2*h.length);return r.extra_bits={start_bit:2*h.length,bits:n,has_required:n.reduce((e,t,r)=>r%2!=0?e||!1:e||t,!1)},r}};function m(e){return e.reverse().reduce((e,t,r)=>e+t*Math.pow(32,r),0)}var v,w=function(e){if(!e)return null;try{var t=function(e,t){let r,o,h,v,w,x;if("string"!=typeof e)throw Error("Lightning Payment Request must be string");if("ln"!==e.slice(0,2).toLowerCase())throw Error("Not a proper lightning payment request");let E=[],P=n.decode(e,Number.MAX_SAFE_INTEGER);e=e.toLowerCase();let B=P.prefix,k=P.words,A=e.slice(B.length+1),S=k.slice(-104);k=k.slice(0,-104);let T=B.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(T&&!T[2]&&(T=B.match(/^ln(\S+)$/)),!T)throw Error("Not a proper lightning payment request");E.push({name:"lightning_network",letters:"ln"});let C=T[1];switch(C){case s.bech32:r=s;break;case a.bech32:r=a;break;case l.bech32:r=l;break;case c.bech32:r=c;break;case u.bech32:r=u}if(!r||r.bech32!==C)throw Error("Unknown coin bech32 prefix");E.push({name:"coin_network",letters:C,value:r});let I=T[2];I?(o=function(e,t){let r,n;if(e.slice(-1).match(/^[munp]$/))r=e.slice(-1),n=e.slice(0,-1);else{if(e.slice(-1).match(/^[^munp0-9]$/))throw Error("Not a valid multiplier for the amount");n=e}if(!n.match(/^\d+$/))throw Error("Not a valid human readable amount");let i=BigInt(n),o=r?i*p/f[r]:i*p;if("p"===r&&i%BigInt(10)!==BigInt(0)||o>d)throw Error("Amount is outside of valid range");return o.toString()}(I+T[3]),E.push({name:"amount",letters:T[2]+T[3],value:o})):o=null,E.push({name:"separator",letters:"1"});let _=m(k.slice(0,7));for(k=k.slice(7),E.push({name:"timestamp",letters:A.slice(0,7),value:_}),A=A.slice(7);k.length>0;){let e=k[0].toString();h=g[e]||"unknown_tag",v=b[e]||function(e){return t=>({tagCode:parseInt(e),words:n.encode("unknown",t,Number.MAX_SAFE_INTEGER)})}(e),k=k.slice(1),w=m(k.slice(0,2)),x=(k=k.slice(2)).slice(0,w),k=k.slice(w),E.push({name:h,tag:A[0],letters:A.slice(0,3+w),value:v(x)}),A=A.slice(3+w)}E.push({name:"signature",letters:A.slice(0,104),value:i.encode(n.fromWordsUnsafe(S))}),A=A.slice(104),E.push({name:"checksum",letters:A});let U={paymentRequest:e,sections:E,get expiry(){let e=E.find(e=>"expiry"===e.name);if(e)return $("timestamp")+e.value},get route_hints(){return E.filter(e=>"route_hint"===e.name).map(e=>e.value)}};for(let e in y)"route_hint"!==e&&Object.defineProperty(U,e,{get:()=>$(e)});return U;function $(e){let t=E.find(t=>t.name===e);return t?t.value:void 0}}(e);if(!t||!t.sections)return null;var r=t.sections.find(function(e){return"payment_hash"===e.name});if("payment_hash"!==(null==r?void 0:r.name)||!r.value)return null;var o=r.value,h=0,v=t.sections.find(function(e){return"amount"===e.name});"amount"===(null==v?void 0:v.name)&&v.value&&(h=parseInt(v.value)/1e3);var w=t.sections.find(function(e){return"timestamp"===e.name});if("timestamp"!==(null==w?void 0:w.name)||!w.value)return null;var x,E=w.value,P=t.sections.find(function(e){return"expiry"===e.name});"expiry"===(null==P?void 0:P.name)&&(x=P.value);var B=t.sections.find(function(e){return"description"===e.name});return{paymentHash:o,satoshi:h,timestamp:E,expiry:x,description:"description"===(null==B?void 0:B.name)?null==B?void 0:B.value:void 0}}catch(e){return null}};function x(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}let E=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),P=(e,t)=>e<<32-t|e>>>t;if(68!==new Uint8Array(new Uint32Array([0x11223344]).buffer)[0])throw Error("Non little-endian hardware is not supported");let B=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function k(e){if(!(e instanceof Uint8Array))throw Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=B[e[r]];return t}function A(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!(e instanceof Uint8Array))throw Error("expected Uint8Array, got "+typeof e);return e}class S{clone(){return this._cloneInto()}}class T extends S{constructor(e,t,r,n){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=E(this.buffer)}update(e){x(this);let{view:t,buffer:r,blockLen:n}=this,i=(e=A(e)).length;for(let o=0;o<i;){let s=Math.min(n-this.pos,i-o);if(s!==n)r.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===n&&(this.process(t,0),this.pos=0);else{let t=E(e);for(;n<=i-o;o+=n)this.process(t,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){x(this),function(e,t){!function(e,...t){if(!(e instanceof Uint8Array))throw Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}(e);let r=t.outputLen;if(e.length<r)throw Error(`digestInto() expects output buffer of length at least ${r}`)}(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:n,isLE:i}=this,{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>n-o&&(this.process(r,0),o=0);for(let e=o;e<n;e++)t[e]=0;!function(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);let i=BigInt(32),o=BigInt(0xffffffff),s=Number(r>>i&o),a=Number(r&o),l=4*!n;e.setUint32(t+4*!!n,s,n),e.setUint32(t+l,a,n)}(r,n-8,BigInt(8*this.length),i),this.process(r,0);let s=E(e),a=this.outputLen;if(a%4)throw Error("_sha2: outputLen should be aligned to 32bit");let l=a/4,c=this.get();if(l>c.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<l;e++)s.setUint32(4*e,c[e],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:n,finished:i,destroyed:o,pos:s}=this;return e.length=n,e.pos=s,e.finished=i,e.destroyed=o,n%t&&e.buffer.set(r),e}}let C=(e,t,r)=>e&t^e&r^t&r,I=new Uint32Array([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),_=new Uint32Array([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),U=new Uint32Array(64);class $ extends T{constructor(){super(64,32,8,!1),this.A=0|_[0],this.B=0|_[1],this.C=0|_[2],this.D=0|_[3],this.E=0|_[4],this.F=0|_[5],this.G=0|_[6],this.H=0|_[7]}get(){let{A:e,B:t,C:r,D:n,E:i,F:o,G:s,H:a}=this;return[e,t,r,n,i,o,s,a]}set(e,t,r,n,i,o,s,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(e,t){var r;for(let r=0;r<16;r++,t+=4)U[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=U[e-15],r=U[e-2],n=P(t,7)^P(t,18)^t>>>3,i=P(r,17)^P(r,19)^r>>>10;U[e]=i+U[e-7]+n+U[e-16]|0}let{A:n,B:i,C:o,D:s,E:a,F:l,G:c,H:u}=this;for(let e=0;e<64;e++){let t=u+(P(a,6)^P(a,11)^P(a,25))+((r=a)&l^~r&c)+I[e]+U[e]|0,h=(P(n,2)^P(n,13)^P(n,22))+C(n,i,o)|0;u=c,c=l,l=a,a=s+t|0,s=o,o=i,i=n,n=t+h|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(n,i,o,s,a,l,c,u)}roundClean(){U.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}let L=function(e){let t=t=>e().update(A(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}(()=>new $);var N=function(){function e(e){if(this.paymentRequest=void 0,this.paymentHash=void 0,this.preimage=void 0,this.verify=void 0,this.satoshi=void 0,this.expiry=void 0,this.timestamp=void 0,this.createdDate=void 0,this.expiryDate=void 0,this.description=void 0,this.successAction=void 0,this.paymentRequest=e.pr,!this.paymentRequest)throw Error("Invalid payment request");var t,r,n,i,o=w(this.paymentRequest);if(!o)throw Error("Failed to decode payment request");this.paymentHash=o.paymentHash,this.satoshi=o.satoshi,this.timestamp=o.timestamp,this.expiry=o.expiry,this.createdDate=new Date(1e3*this.timestamp),this.expiryDate=this.expiry?new Date(1e3*(this.timestamp+this.expiry)):void 0,this.description=null!=(t=o.description)?t:null,this.verify=null!=(r=e.verify)?r:null,this.preimage=null!=(n=e.preimage)?n:null,this.successAction=null!=(i=e.successAction)?i:null}var t=e.prototype;return t.isPaid=function(){try{if(this.preimage)return Promise.resolve(this.validatePreimage(this.preimage));if(this.verify)return Promise.resolve(this.verifyPayment());throw Error("Could not verify payment")}catch(e){return Promise.reject(e)}},t.validatePreimage=function(e){if(!e||!this.paymentHash)return!1;try{var t=k(L(Uint8Array.from(e.match(/.{1,2}/g).map(function(e){return parseInt(e,16)}))));return this.paymentHash===t}catch(e){return!1}},t.verifyPayment=function(){try{var e=this;return Promise.resolve(function(t,r){try{var n=function(){if(!e.verify)throw Error("LNURL verify not available");return Promise.resolve(fetch(e.verify)).then(function(t){if(!t.ok)throw Error("Verification request failed: "+t.status+" "+t.statusText);return Promise.resolve(t.json()).then(function(t){return t.preimage&&(e.preimage=t.preimage),t.settled})})}()}catch(e){return r(e)}return n&&n.then?n.then(void 0,r):n}(0,function(e){return console.error("Failed to check LNURL-verify",e),!1}))}catch(e){return Promise.reject(e)}},t.hasExpired=function(){var e=this.expiryDate;return!!e&&e.getTime()<Date.now()},e}(),R=function(e,t){var r=e.satoshi,n=e.comment,i=e.p,o=e.e,s=e.relays;void 0===t&&(t={});try{var a=t.nostr||globalThis.nostr;if(!a)throw Error("nostr option or window.nostr is not available");var l=[["relays"].concat(s),["amount",r.toString()]];return i&&l.push(["p",i]),o&&l.push(["e",o]),Promise.resolve(a.getPublicKey()).then(function(e){var t,r={pubkey:e,created_at:Math.floor(Date.now()/1e3),kind:9734,tags:l,content:null!=n?n:""};return t=r,r.id=k(L(function(e){if(!function(e){if("string"!=typeof e.content||"number"!=typeof e.created_at||!Array.isArray(e.tags))return!1;for(var t=0;t<e.tags.length;t++){var r=e.tags[t];if(!Array.isArray(r))return!1;for(var n=0;n<r.length;n++)if("object"==typeof r[n])return!1}return!0}(e))throw Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}(t))),Promise.resolve(a.signEvent(r))})}catch(e){return Promise.reject(e)}},O=function(e){var t,r;if("keysend"!==e.tag)throw Error("Invalid keysend params");if("OK"!==e.status)throw Error("Keysend status not OK");if(!e.pubkey)throw Error("Pubkey does not exist");return e.customData&&e.customData[0]&&(t=e.customData[0].customKey,r=e.customData[0].customValue),{destination:e.pubkey,customKey:t,customValue:r}},D=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=+$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=+$,\w]+@)[A-Za-z0-9.-]+)((?:\/[+~%/.\w-_]*)?\??(?:[-+=&;%@.\w_]*)#?(?:[\w]*))?)/,M=function(e){return!!e&&D.test(e)},H=function(e){var t=e.amount;return t>0&&t>=e.min&&t<=e.max},j=function(e){try{if("payRequest"!==e.tag)throw Error("Invalid pay service params");var t=(e.callback+"").trim();if(!M(t))throw Error("Callback must be a valid url");var r,n,i=Math.ceil(Number(e.minSendable||0)),o=Math.floor(Number(e.maxSendable));if(!i||!o||i>o)throw Error("Invalid pay service params");try{r=JSON.parse(e.metadata+""),n=k(L(e.metadata+""))}catch(e){r=[],n=k(L("[]"))}for(var s="",a="",l="",c="",u=0;u<r.length;u++){var h=r[u],f=h[0],d=h[1];switch(f){case"text/plain":l=d;break;case"text/identifier":c=d;break;case"text/email":s=d;break;case"image/png;base64":case"image/jpeg;base64":a="data:"+f+","+d}}var p,y=e.payerData;try{p=new URL(t).hostname}catch(e){}return Promise.resolve({callback:t,fixed:i===o,min:i,max:o,domain:p,metadata:r,metadataHash:n,identifier:c,email:s,description:l,image:a,payerData:y,commentAllowed:Number(e.commentAllowed)||0,rawData:e,allowsNostr:e.allowsNostr||!1})}catch(e){return Promise.reject(e)}};function W(){return(W=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var F=function(e,t){try{var r=e.boost;t||(t={});var n=t.webln||globalThis.webln;if(!n)throw Error("WebLN not available");if(!n.keysend)throw Error("Keysend not available in current WebLN provider");var i=e.amount||Math.floor(r.value_msat/1e3),o={destination:e.destination,amount:i,customRecords:{7629169:JSON.stringify(r)}};return e.customKey&&e.customValue&&(o.customRecords[e.customKey]=e.customValue),Promise.resolve(n.enable()).then(function(){return Promise.resolve(n.keysend(o))})}catch(e){return Promise.reject(e)}},q=/^((?:[^<>()[\]\\.,;:\s@"]+(?:\.[^<>()[\]\\.,;:\s@"]+)*)|(?:".+"))@((?:\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(?:(?:[a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,z=function(){function e(e,t){this.address=void 0,this.options=void 0,this.username=void 0,this.domain=void 0,this.pubkey=void 0,this.lnurlpData=void 0,this.keysendData=void 0,this.nostrData=void 0,this.nostrPubkey=void 0,this.nostrRelays=void 0,this.webln=void 0,this.address=e,this.options={proxy:"https://api.getalby.com/lnurl"},this.options=Object.assign(this.options,t),this.parse(),this.webln=this.options.webln}var t=e.prototype;return t.parse=function(){var e=q.exec(this.address.toLowerCase());e&&(this.username=e[1],this.domain=e[2])},t.getWebLN=function(){return this.webln||globalThis.webln},t.fetch=function(){try{return Promise.resolve(this.options.proxy?this.fetchWithProxy():this.fetchWithoutProxy())}catch(e){return Promise.reject(e)}},t.fetchWithProxy=function(){try{var e=this;return Promise.resolve(fetch(e.options.proxy+"/lightning-address-details?"+new URLSearchParams({ln:e.address}).toString())).then(function(t){if(!t.ok)throw Error("Failed to fetch lnurl info: "+t.status+" "+t.statusText);return Promise.resolve(t.json()).then(function(t){return Promise.resolve(e.parseLnUrlPayResponse(t.lnurlp)).then(function(){e.parseKeysendResponse(t.keysend),e.parseNostrResponse(t.nostr)})})})}catch(e){return Promise.reject(e)}},t.fetchWithoutProxy=function(){try{return this.domain&&this.username?Promise.resolve(Promise.all([this.fetchLnurlData(),this.fetchKeysendData(),this.fetchNostrData()])).then(function(){}):Promise.resolve()}catch(e){return Promise.reject(e)}},t.fetchLnurlData=function(){try{var e=this;return Promise.resolve(fetch(e.lnurlpUrl())).then(function(t){var r=function(){if(t.ok)return Promise.resolve(t.json()).then(function(t){return Promise.resolve(e.parseLnUrlPayResponse(t)).then(function(){})})}();if(r&&r.then)return r.then(function(){})})}catch(e){return Promise.reject(e)}},t.fetchKeysendData=function(){try{var e=this;return Promise.resolve(fetch(e.keysendUrl())).then(function(t){var r=function(){if(t.ok)return Promise.resolve(t.json()).then(function(t){e.parseKeysendResponse(t)})}();if(r&&r.then)return r.then(function(){})})}catch(e){return Promise.reject(e)}},t.fetchNostrData=function(){try{var e=this;return Promise.resolve(fetch(e.nostrUrl())).then(function(t){var r=function(){if(t.ok)return Promise.resolve(t.json()).then(function(t){e.parseNostrResponse(t)})}();if(r&&r.then)return r.then(function(){})})}catch(e){return Promise.reject(e)}},t.lnurlpUrl=function(){return"https://"+this.domain+"/.well-known/lnurlp/"+this.username},t.keysendUrl=function(){return"https://"+this.domain+"/.well-known/keysend/"+this.username},t.nostrUrl=function(){return"https://"+this.domain+"/.well-known/nostr.json?name="+this.username},t.generateInvoice=function(e){try{var t,r=function(e){var r=t&&t.pr&&t.pr.toString();if(!r)throw Error("Invalid pay service invoice");var n={pr:r};if(t&&t.verify&&(n.verify=t.verify.toString()),t&&t.successAction&&"object"==typeof t.successAction){var i=t.successAction,o=i.tag,s=i.description,a=i.url;"message"===o?n.successAction={tag:o,message:i.message}:"url"===o&&(n.successAction={tag:o,description:s,url:a})}return new N(n)},n=this,i=function(){if(n.options.proxy)return Promise.resolve(fetch(n.options.proxy+"/generate-invoice?"+new URLSearchParams(W({ln:n.address},e)).toString())).then(function(e){if(!e.ok)throw Error("Failed to generate invoice: "+e.status+" "+e.statusText);return Promise.resolve(e.json()).then(function(e){t=e.invoice})});if(!n.lnurlpData)throw Error("No lnurlpData available. Please call fetch() first.");if(!n.lnurlpData.callback||!M(n.lnurlpData.callback))throw Error("Valid callback does not exist in lnurlpData");var r=new URL(n.lnurlpData.callback);return r.search=new URLSearchParams(e).toString(),Promise.resolve(fetch(r.toString())).then(function(e){if(!e.ok)throw Error("Failed to generate invoice: "+e.status+" "+e.statusText);return Promise.resolve(e.json()).then(function(e){t=e})})}();return Promise.resolve(i&&i.then?i.then(r):r())}catch(e){return Promise.reject(e)}},t.requestInvoice=function(e){try{if(!this.lnurlpData)throw Error("No lnurlpData available. Please call fetch() first.");var t=1e3*e.satoshi,r=this.lnurlpData,n=r.commentAllowed;if(!H({amount:t,min:r.min,max:r.max}))throw Error("Invalid amount");if(e.comment&&n&&n>0&&e.comment.length>n)throw Error("The comment length must be "+n+" characters or fewer");var i={amount:t.toString()};return e.comment&&(i.comment=e.comment),e.payerdata&&(i.payerdata=JSON.stringify(e.payerdata)),Promise.resolve(this.generateInvoice(i))}catch(e){return Promise.reject(e)}},t.boost=function(e,t){void 0===t&&(t=0);try{if(!this.keysendData)throw Error("No keysendData available. Please call fetch() first.");var r=this.keysendData,n=r.destination,i=r.customKey,o=r.customValue,s=this.getWebLN();if(!s)throw Error("WebLN not available");return Promise.resolve(F({destination:n,customKey:i,customValue:o,amount:t,boost:e},{webln:s}))}catch(e){return Promise.reject(e)}},t.zapInvoice=function(e,t){var r=e.satoshi,n=e.comment,i=e.relays,o=e.e;void 0===t&&(t={});try{var s=this;if(!s.lnurlpData)throw Error("No lnurlpData available. Please call fetch() first.");if(!s.nostrPubkey)throw Error("Nostr Pubkey is missing");var a=s.nostrPubkey,l=1e3*r,c=s.lnurlpData,u=c.allowsNostr;if(!H({amount:l,min:c.min,max:c.max}))throw Error("Invalid amount");if(!u)throw Error("Your provider does not support zaps");return Promise.resolve(R({satoshi:l,comment:n,p:a,e:o,relays:i},t)).then(function(e){var t={amount:l.toString(),nostr:JSON.stringify(e)};return Promise.resolve(s.generateInvoice(t))})}catch(e){return Promise.reject(e)}},t.zap=function(e,t){void 0===t&&(t={});try{var r=this.zapInvoice(e,t),n=this.getWebLN();if(!n)throw Error("WebLN not available");return Promise.resolve(n.enable()).then(function(){var e=n.sendPayment;return Promise.resolve(r).then(function(t){return e.call(n,t.paymentRequest)})})}catch(e){return Promise.reject(e)}},t.parseLnUrlPayResponse=function(e){try{var t=this,r=function(){if(e)return Promise.resolve(j(e)).then(function(e){t.lnurlpData=e})}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},t.parseKeysendResponse=function(e){e&&(this.keysendData=O(e))},t.parseNostrResponse=function(e){if(e){var t,r,n,i,o,s=((t=this.username)&&e&&(n=(r=null==(i=e.names)?void 0:i[t])?null==(o=e.relays)?void 0:o[r]:void 0),[e,r,n]);this.nostrData=s[0],this.nostrPubkey=s[1],this.nostrRelays=s[2]}},e}(),K=(new(function(){function e(e){this.storage=void 0,this.storage=e||{}}var t=e.prototype;return t.getItem=function(e){return this.storage[e]},t.setItem=function(e,t){this.storage[e]=t},e}()),function(e){try{var t="https://getalby.com/api/rates/"+e.toLowerCase()+".json";return Promise.resolve(fetch(t)).then(function(e){if(!e.ok)throw Error("Failed to fetch rate: "+e.status+" "+e.statusText);return Promise.resolve(e.json()).then(function(e){return e.rate_float/1e8})})}catch(e){return Promise.reject(e)}}),V=function(e){var t=e.satoshi;return Promise.resolve(K(e.currency)).then(function(e){return Number(t)*e})},J={__proto__:null,getFiatBtcRate:K,getFiatValue:V,getSatoshiValue:function(e){var t=e.amount;return Promise.resolve(K(e.currency)).then(function(e){return Math.floor(Number(t)/e)})},getFormattedFiatValue:function(e){var t=e.currency,r=e.locale;return r||(r="en"),Promise.resolve(V({satoshi:e.satoshi,currency:t})).then(function(e){return e.toLocaleString(r,{style:"currency",currency:t})})}}}),i("9BsJg");var s=i("9BsJg");class a{constructor(){this.wallets={1:{isConnected:!1,nwcClient:null,connectionData:null,transactionsSupported:null},2:{isConnected:!1,nwcClient:null,connectionData:null,transactionsSupported:null}}}saveNWCString(e,t){localStorage.setItem(`nwc-wallet-${e}`,t),this.log(`Wallet ${e}: NWC string saved`)}loadNWCString(e){return localStorage.getItem(`nwc-wallet-${e}`)||""}clearNWCString(e){localStorage.removeItem(`nwc-wallet-${e}`),this.log(`Wallet ${e}: Saved NWC string deleted`)}log(e){let t=document.getElementById("debug-log"),r=new Date().toLocaleTimeString();t.textContent+=`[${r}] ${e}
`,t.scrollTop=t.scrollHeight}updateConnectionStatus(e,t,r){let n=document.getElementById(`connection-status-${e}`);n.className=`badge ${"connected"===t?"bg-success":"connecting"===t?"bg-warning":"bg-secondary"} status-badge`,n.textContent=r}toggleConnectionVisibility(e){let t=document.getElementById(`nwc-url-${e}`),r=document.getElementById(`toggle-visibility-${e}`);"disc"===t.style.webkitTextSecurity?(t.style.webkitTextSecurity="none",r.textContent="\uD83D\uDE48",r.title="Connection String verstecken"):(t.style.webkitTextSecurity="disc",r.textContent="\uD83D\uDC41️",r.title="Connection String anzeigen")}async connectWallet(e){let t=document.getElementById(`nwc-url-${e}`).value;if(!t)return void alert("Please enter a valid NWC connection string");if(!t.startsWith("nostr+walletconnect://"))return void alert('Invalid NWC connection string. Must start with "nostr+walletconnect://"');this.log(`Wallet ${e}: Attempting to connect real wallet...`),this.updateConnectionStatus(e,"connecting","Connecting...");try{this.wallets[e].nwcClient=new s.nwc.NWCClient({nostrWalletConnectUrl:t});let r=await this.wallets[e].nwcClient.getInfo();this.wallets[e].isConnected=!0,this.wallets[e].connectionData={url:t},this.updateConnectionStatus(e,"connected","Connected"),document.getElementById(`nwc-url-${e}`).disabled=!0,document.getElementById(`toggle-visibility-${e}`).disabled=!0,document.getElementById(`connect-btn-${e}`).disabled=!0,document.getElementById(`disconnect-btn-${e}`).disabled=!1,this.saveNWCString(e,t),this.log(`Wallet ${e}: Successfully connected!`),this.log(`Wallet ${e}: Alias: ${r.alias||"N/A"}`),this.log(`Wallet ${e}: Pubkey: ${r.pubkey?r.pubkey.substring(0,20)+"...":"N/A"}`),this.log(`Wallet ${e}: Methods: ${r.methods?r.methods.join(", "):"N/A"}`),document.getElementById(`wallet-info-${e}`).textContent=JSON.stringify(r,null,2),window.dispatchEvent(new CustomEvent("walletConnectionChanged"))}catch(t){this.updateConnectionStatus(e,"disconnected","Connection failed"),this.log(`Wallet ${e}: Error connecting: ${t.message}`),console.error(`Wallet ${e} NWC Connection Error:`,t)}}disconnectWallet(e){this.log(`Wallet ${e}: Disconnecting...`),this.wallets[e].isConnected=!1,this.wallets[e].nwcClient=null,this.wallets[e].connectionData=null,this.wallets[e].transactionsSupported=null,this.updateConnectionStatus(e,"disconnected","Not connected"),document.getElementById(`nwc-url-${e}`).disabled=!1,document.getElementById(`toggle-visibility-${e}`).disabled=!1,document.getElementById(`connect-btn-${e}`).disabled=!1,document.getElementById(`disconnect-btn-${e}`).disabled=!0,document.getElementById(`wallet-info-${e}`).textContent="",document.getElementById(`payment-result-${e}`).textContent="",this.log(`Wallet ${e}: Successfully disconnected`),window.dispatchEvent(new CustomEvent("walletConnectionChanged"))}async getWalletInfo(e){if(!this.wallets[e].isConnected||!this.wallets[e].nwcClient)return void alert(`Please connect Wallet ${e} first`);try{this.log(`Wallet ${e}: get_info request sent...`);let t=await this.wallets[e].nwcClient.getInfo();document.getElementById(`wallet-info-${e}`).textContent=JSON.stringify(t,null,2),this.log(`Wallet ${e}: get_info response received`)}catch(t){this.log(`Wallet ${e}: Error in get_info: ${t.message}`),document.getElementById(`wallet-info-${e}`).textContent=`Error: ${t.message}`}}async getBalance(e){if(!this.wallets[e].isConnected||!this.wallets[e].nwcClient)return void alert(`Please connect Wallet ${e} first`);try{this.log(`Wallet ${e}: get_balance request sent...`);let t=await this.wallets[e].nwcClient.getBalance(),r={...t,balance_sats:Math.round(t.balance/1e3),balance_millisats:t.balance};document.getElementById(`wallet-info-${e}`).textContent=JSON.stringify(r,null,2),this.log(`Wallet ${e}: Balance: ${Math.round(t.balance/1e3)} sats (${t.balance} millisats)`)}catch(t){this.log(`Wallet ${e}: Error in get_balance: ${t.message}`),document.getElementById(`wallet-info-${e}`).textContent=`Error: ${t.message}`}}async createInvoice(e){if(!this.wallets[e].isConnected||!this.wallets[e].nwcClient)return void alert(`Please connect Wallet ${e} first`);let t=prompt("Enter amount in Satoshis:","1000");if(!t)return;let r=prompt("Description (optional):",`NWC Demo Invoice - Wallet ${e}`);try{this.log(`Wallet ${e}: make_invoice request for ${t} sats...`);let n=await this.wallets[e].nwcClient.makeInvoice({amount:1e3*parseInt(t),description:r||`NWC Demo Invoice - Wallet ${e}`});document.getElementById(`payment-result-${e}`).textContent=JSON.stringify(n,null,2),this.log(`Wallet ${e}: Invoice created successfully`)}catch(t){this.log(`Wallet ${e}: Error creating invoice: ${t.message}`),document.getElementById(`payment-result-${e}`).textContent=`Error: ${t.message}`}}async payInvoice(e){if(!this.wallets[e].isConnected||!this.wallets[e].nwcClient)return void alert(`Please connect Wallet ${e} first`);let t=prompt("Enter Lightning Invoice:","lnbc...");if(t)try{this.log(`Wallet ${e}: pay_invoice request sent...`);let r=await this.wallets[e].nwcClient.payInvoice({invoice:t});document.getElementById(`payment-result-${e}`).textContent=JSON.stringify(r,null,2),this.log(`Wallet ${e}: Payment sent successfully`)}catch(t){this.log(`Wallet ${e}: Error paying invoice: ${t.message}`),document.getElementById(`payment-result-${e}`).textContent=`Error: ${t.message}`}}async listTransactions(e){if(!this.wallets[e].isConnected||!this.wallets[e].nwcClient)return void alert(`Please connect Wallet ${e} first`);try{this.log(`Wallet ${e}: list_transactions request sent...`);let t=await this.wallets[e].nwcClient.listTransactions({from:0,until:Math.floor(Date.now()/1e3),limit:50,offset:0,unpaid:!1,type:void 0});document.getElementById(`payment-result-${e}`).textContent=JSON.stringify(t,null,2),this.log(`Wallet ${e}: ${t.transactions?t.transactions.length:0} transactions retrieved`)}catch(t){this.log(`Wallet ${e}: Error retrieving transactions: ${t.message}`),console.error(`Wallet ${e} listTransactions error:`,t);try{this.log(`Wallet ${e}: Trying listTransactions without parameters...`);let t=await this.wallets[e].nwcClient.listTransactions({});document.getElementById(`payment-result-${e}`).textContent=JSON.stringify(t,null,2),this.log(`Wallet ${e}: Transactions retrieved with fallback method`)}catch(r){this.log(`Wallet ${e}: Fallback also failed: ${r.message}`),document.getElementById(`payment-result-${e}`).textContent=`Error: ${t.message}
Fallback Error: ${r.message}`}}}async payKeysend(e){if(!this.wallets[e].isConnected||!this.wallets[e].nwcClient)return void alert(`Please connect Wallet ${e} first`);let t=prompt("Recipient Pubkey:","02..."),r=prompt("Amount in Satoshis:","1000");if(t&&r)try{this.log(`Wallet ${e}: pay_keysend request for ${r} sats to ${t.substring(0,10)}...`);let n=await this.wallets[e].nwcClient.payKeysend({pubkey:t,amount:1e3*parseInt(r)});document.getElementById(`payment-result-${e}`).textContent=JSON.stringify(n,null,2),this.log(`Wallet ${e}: Keysend payment sent successfully`)}catch(t){this.log(`Wallet ${e}: Error sending keysend: ${t.message}`),document.getElementById(`payment-result-${e}`).textContent=`Error: ${t.message}`}}saveConnectionString(e){let t=document.getElementById(`nwc-url-${e}`).value;if(!t)return void alert("No connection string to save");this.saveNWCString(e,t)}clearConnectionString(e){this.clearNWCString(e),document.getElementById(`nwc-url-${e}`).value=""}loadSavedConnectionStrings(){for(let e=1;e<=2;e++){let t=this.loadNWCString(e);if(t){let r=document.getElementById(`nwc-url-${e}`);r.value=t,r.style.webkitTextSecurity="disc",this.log(`Wallet ${e}: Saved NWC string loaded`)}}}clearLog(){document.getElementById("debug-log").textContent="Debug messages will be displayed here...\n"}}class l{constructor(){this.priceUpdateInterval=null,this.priceChart=null,this.PRICE_STORAGE_KEY="nwc-price-history",this.MAX_PRICE_HISTORY=1e4,this.PRICE_CHANGE_THRESHOLD=.5}savePriceHistory(e){try{let t=this.getPriceHistory(),r=Date.now();if(t.length>0){let n=t[t.length-1],i=r-n.timestamp,o=Object.keys(e).some(t=>{let r=n.prices[t],i=e[t];return Math.abs((i-r)/r*100)>=this.PRICE_CHANGE_THRESHOLD}),s=i/36e5;if(s<1||s<2&&!o){n.timestamp=r,localStorage.setItem(this.PRICE_STORAGE_KEY,JSON.stringify(t));return}}t.push({timestamp:r,prices:{...e}}),t.length>this.MAX_PRICE_HISTORY&&t.splice(0,t.length-this.MAX_PRICE_HISTORY),localStorage.setItem(this.PRICE_STORAGE_KEY,JSON.stringify(t)),console.log(`\u{1F4BE} Neuer Preispunkt gespeichert (${t.length} total)`)}catch(e){console.error("Error saving price history:",e)}}getPriceHistory(){try{let e=localStorage.getItem(this.PRICE_STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Error loading price history:",e),[]}}getFilteredPriceHistory(e){let t,r=this.getPriceHistory();if(0===r.length)return[];let n=Date.now();switch(e){case"12h":default:t=432e5;break;case"24h":t=864e5;break;case"2d":t=1728e5;break;case"4d":t=3456e5;break;case"7d":t=6048e5}let i=n-t;return r.filter(e=>e.timestamp>=i)}clearPriceHistory(){localStorage.removeItem(this.PRICE_STORAGE_KEY),this.log("Price history cleared")}async clearAndReloadPriceData(){try{this.log("\uD83D\uDDD1️ Clearing all price data..."),localStorage.removeItem(this.PRICE_STORAGE_KEY),this.priceChart&&(this.priceChart.data.labels=[],this.priceChart.data.datasets.forEach(e=>{e.data=[]}),this.priceChart.update()),this.log("✅ Price data cleared"),await this.fetchHistoricalPrices(),this.log("✅ Fresh price data loaded")}catch(e){this.log(`\u{274C} Error reloading price data: ${e.message}`),console.error("Error clearing and reloading price data:",e)}}log(e){let t=document.getElementById("debug-log");if(t){let r=new Date().toLocaleTimeString();t.textContent+=`[${r}] ${e}
`,t.scrollTop=t.scrollHeight}}async fetchHistoricalPrices(){try{this.log("\uD83D\uDCC8 Loading real historical prices from mempool.space...");let e=await fetch("https://mempool.space/api/v1/historical-price");if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);let t=await e.json();this.log(`\u{1F4C8} ${t.prices.length} historical data points received from API`);let r=t.prices.map(e=>({timestamp:1e3*e.time,prices:{USD:e.USD,EUR:e.EUR,GBP:e.GBP,CHF:e.CHF,CAD:e.CAD,JPY:e.JPY,AUD:e.AUD}})).sort((e,t)=>e.timestamp-t.timestamp).slice(-this.MAX_PRICE_HISTORY);localStorage.setItem(this.PRICE_STORAGE_KEY,JSON.stringify(r)),this.log(`\u{1F4C8} ${r.length} real historical price points saved`),this.priceChart&&this.updatePriceChart()}catch(t){this.log(`\u{1F4C8} Error loading historical prices: ${t.message}`),console.error("Historical price fetch error:",t);let e=this.getPriceHistory();e.length>0?this.log(`\u{1F4C8} Using ${e.length} existing price points`):this.log("\uD83D\uDCC8 No historical data available")}}async fetchBitcoinPrice(){try{this.log("Fetching Bitcoin price...");let e=await fetch("https://mempool.space/api/v1/prices");if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);let t=await e.json();this.updatePriceDisplay(t),this.updateLivePriceInChart(t),this.log("Bitcoin price updated successfully")}catch(t){this.log(`Error fetching Bitcoin price: ${t.message}`),console.error("Bitcoin price fetch error:",t),["usd","eur","gbp","chf","cad","jpy"].forEach(e=>{let t=document.getElementById(`price-${e}`),r=document.getElementById(`sats-${e}`);t&&(t.textContent="Error"),r&&(r.textContent="Error")});let e=document.getElementById("price-updated");e&&(e.textContent="Last Update: Error")}}updateLivePriceInChart(e){if(!this.priceChart)return;let t=Date.now(),r=document.querySelector('input[name="timeRange"]:checked')?.value||"12h",n=[...this.getPriceHistory(),{timestamp:t,prices:{USD:e.USD,EUR:e.EUR,GBP:e.GBP,CHF:e.CHF,CAD:e.CAD,JPY:e.JPY}}],i=this.filterHistoryByRange(n,r);if(0===i.length)return;let o=i.map(e=>e.timestamp);this.priceChart.data.labels=o,["USD","EUR","GBP","CHF","CAD","JPY"].forEach((e,t)=>{let r=i.map(t=>({x:t.timestamp,y:t.prices[e]}));this.priceChart.data.datasets[t].data=r}),this.priceChart.update("none"),this.savePriceHistory(e)}filterHistoryByRange(e,t){let r;if(0===e.length)return[];let n=Date.now();switch(t){case"12h":default:r=432e5;break;case"24h":r=864e5;break;case"2d":r=1728e5;break;case"4d":r=3456e5;break;case"7d":r=6048e5}let i=n-r;return e.filter(e=>e.timestamp>=i)}updatePriceDisplay(e){Object.entries({usd:{symbol:"$",value:e.USD,unit:"$1"},eur:{symbol:"€",value:e.EUR,unit:"€1"},gbp:{symbol:"£",value:e.GBP,unit:"£1"},chf:{symbol:"₣",value:e.CHF,unit:"₣1"},cad:{symbol:"C$",value:e.CAD,unit:"C$1"},jpy:{symbol:"¥",value:e.JPY,unit:"¥1"}}).forEach(([e,t])=>{let r=document.getElementById(`price-${e}`),n=document.getElementById(`sats-${e}`);if(r&&n&&t.value){let i="jpy"===e?Math.round(t.value).toLocaleString():t.value.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0});r.textContent=`${t.symbol} ${i}`;let o=Math.round(1e8/t.value).toLocaleString("de-DE");n.textContent=`${o} sats = ${t.unit}`}});let t=new Date().toLocaleTimeString("en-US"),r=document.getElementById("price-updated");r&&(r.textContent=`Last Update: ${t}`)}startPriceUpdates(){this.priceUpdateInterval&&clearInterval(this.priceUpdateInterval),this.fetchBitcoinPrice(),this.priceUpdateInterval=setInterval(()=>this.fetchBitcoinPrice(),3e4),this.log("Bitcoin price auto-update started (every 30 seconds)")}stopPriceUpdates(){this.priceUpdateInterval&&(clearInterval(this.priceUpdateInterval),this.priceUpdateInterval=null,this.log("Bitcoin price auto-update stopped"))}initializePriceChart(){let e=document.getElementById("priceChart")?.getContext("2d");e&&(this.priceChart=new Chart(e,{type:"line",data:{labels:[],datasets:[{label:"USD ($)",data:[],borderColor:"#0066cc",backgroundColor:"rgba(0, 102, 204, 0.1)",borderWidth:2,fill:!1,tension:.4,pointRadius:1,yAxisID:"y"},{label:"EUR (€)",data:[],borderColor:"#dc3545",backgroundColor:"rgba(220, 53, 69, 0.1)",borderWidth:2,fill:!1,tension:.4,pointRadius:1,yAxisID:"y"},{label:"GBP (£)",data:[],borderColor:"#28a745",backgroundColor:"rgba(40, 167, 69, 0.1)",borderWidth:2,fill:!1,tension:.4,pointRadius:1,yAxisID:"y"},{label:"CHF",data:[],borderColor:"#ffc107",backgroundColor:"rgba(255, 193, 7, 0.1)",borderWidth:2,fill:!1,tension:.4,pointRadius:1,yAxisID:"y"},{label:"CAD",data:[],borderColor:"#6f42c1",backgroundColor:"rgba(111, 66, 193, 0.1)",borderWidth:2,fill:!1,tension:.4,pointRadius:1,yAxisID:"y"},{label:"JPY (¥)",data:[],borderColor:"#fd7e14",backgroundColor:"rgba(253, 126, 20, 0.1)",borderWidth:2,fill:!1,tension:.4,pointRadius:1,yAxisID:"y1"}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top",onClick:function(e,t,r){let n=t.datasetIndex,i=r.chart,o=i.isDatasetVisible(n);i.setDatasetVisibility(n,!o),i.update("none")}},tooltip:{mode:"index",intersect:!1,callbacks:{title:function(e){return"Bitcoin Preis"},label:function(e){let t=e.dataset.label,r=e.parsed.y;return`${t}: ${r.toLocaleString("de-DE")}`}}}},scales:{x:{type:"linear",position:"bottom",min:function(e){let t=e.chart.data.labels;return t.length>0?Math.min(...t):0},max:function(e){let t=e.chart.data.labels;return t.length>0?Math.max(...t):0},grid:{color:"rgba(0, 0, 0, 0.1)"},ticks:{callback:function(e){return new Date(e).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})},maxTicksLimit:8}},y:{type:"linear",display:!0,position:"left",beginAtZero:!1,title:{display:!0,text:"USD/EUR/GBP/CHF/CAD"},grid:{color:"rgba(0, 0, 0, 0.1)"}},y1:{type:"linear",display:!0,position:"right",beginAtZero:!1,title:{display:!0,text:"JPY (¥)"},grid:{drawOnChartArea:!1}}}}}),this.updatePriceChart())}updatePriceChart(){if(!this.priceChart)return;let e=document.querySelector('input[name="timeRange"]:checked')?.value||"12h",t=this.getFilteredPriceHistory(e);if(0===t.length){this.priceChart.data.labels=[],this.priceChart.data.datasets.forEach(e=>{e.data=[]}),this.priceChart.update();return}let r=t.map(e=>e.timestamp);this.priceChart.data.labels=r,["USD","EUR","GBP","CHF","CAD","JPY"].forEach((e,r)=>{let n=t.map(t=>({x:t.timestamp,y:t.prices[e]}));this.priceChart.data.datasets[r].data=n}),this.priceChart.update("none")}}class c{constructor(e){this.walletManager=e,this.stabilizationData={active:!1,currency:null,initialBalance:0,targetValue:0,initialPrice:0,checkInterval:null,threshold:1,lastRebalanceTime:0,rebalanceMinInterval:5e3,errorCount:0,maxErrors:5}}log(e){this.walletManager.log(e)}async startStabilization(){let e=document.getElementById("stabilization-currency").value;if(!e)return void alert("Please select a currency");if(!this.walletManager.wallets[2].isConnected||!this.walletManager.wallets[2].nwcClient)return void alert("Stability Receiver must be connected for stabilization");if(!this.walletManager.wallets[1].isConnected||!this.walletManager.wallets[1].nwcClient)return void alert("Stability Provider must be connected for rebalancing");try{this.log(`\u{1F4B1} Starting stabilization for ${e.toUpperCase()}...`);let t=await this.walletManager.wallets[2].nwcClient.getBalance(),r=Math.round(t.balance/1e3),n=await fetch("https://mempool.space/api/v1/prices"),i=(await n.json())[e.toUpperCase()];if(!i)throw Error(`Price for ${e.toUpperCase()} not available`);let o=r/1e8*i;this.stabilizationData={active:!0,currency:e,initialBalance:r,targetValue:o,initialPrice:i,checkInterval:null,threshold:1,lastRebalanceTime:0,rebalanceMinInterval:5e3,errorCount:0,maxErrors:5},this.updateStabilizationUI(),this.stabilizationData.checkInterval=setInterval(()=>this.checkRebalancing(),15e3),this.log(`\u{1F4B1} Stabilization active: ${r} sats = ${o.toFixed(2)} ${e.toUpperCase()}`),this.log(`\u{1F4B1} Monitoring started (every 15 seconds with timeout protection)`)}catch(e){this.log(`\u{1F4B1} Error starting stabilization: ${e.message}`),console.error("Stabilization start error:",e)}}async stopStabilization(){this.stabilizationData.active&&(this.log("\uD83D\uDCB1 Stopping stabilization..."),this.stabilizationData.checkInterval&&clearInterval(this.stabilizationData.checkInterval),this.stabilizationData={active:!1,currency:null,initialBalance:0,targetValue:0,initialPrice:0,checkInterval:null,threshold:1,lastRebalanceTime:0,rebalanceMinInterval:5e3,errorCount:0,maxErrors:5},this.updateStabilizationUI(),this.log("\uD83D\uDCB1 Stabilization stopped"))}async checkRebalancing(){if(this.stabilizationData.active)try{let e=await fetch("https://mempool.space/api/v1/prices"),t=(await e.json())[this.stabilizationData.currency.toUpperCase()],r=await this.walletManager.wallets[2].nwcClient.getBalance(),n=Math.round(r.balance/1e3),i=Math.round(this.stabilizationData.targetValue/t*1e8),o=n-i;this.updateStabilizationStatus(n,n/1e8*t,i,o),this.updateWalletStabilizationDisplay();let s=Date.now()-this.stabilizationData.lastRebalanceTime;this.log(`\u{1F4B1} Debug: difference=${o}, abs=${Math.abs(o)}, lastRebalance=${this.stabilizationData.lastRebalanceTime}, timeSince=${s}`);let a=parseInt(document.getElementById("rebalance-threshold").value)||1;if(this.stabilizationData.threshold=a,Math.abs(o)>=this.stabilizationData.threshold)if(s>=this.stabilizationData.rebalanceMinInterval)this.log(`\u{1F4B1} Rebalancing needed: ${o>0?"+":""}${o} sats difference`),await this.performRebalancing(o);else{let e=Math.round((this.stabilizationData.rebalanceMinInterval-s)/1e3);!isNaN(e)&&e>0?this.log(`\u{1F4B1} Rebalancing required (${o>0?"+":""}${o} sats), but waiting ${e}s (cooldown)`):(this.log(`\u{1F4B1} Rebalancing required (${o>0?"+":""}${o} sats), starting immediately`),await this.performRebalancing(o))}else Math.abs(o)>0&&this.log(`\u{1F4B1} Small difference: ${o>0?"+":""}${o} sats (below ${this.stabilizationData.threshold} sats threshold)`);this.stabilizationData.errorCount=0}catch(e){this.stabilizationData.errorCount++,this.log(`\u{1F4B1} Error in rebalancing check (${this.stabilizationData.errorCount}/${this.stabilizationData.maxErrors}): ${e.message}`),console.error("Rebalancing check error:",e),this.stabilizationData.errorCount>=this.stabilizationData.maxErrors&&(this.log(`\u{1F4B1} Too many errors (${this.stabilizationData.maxErrors}), stopping stabilization`),this.stopStabilization())}}async performRebalancing(e){let t=Math.abs(e);try{this.log(`\u{1F4B1} Starte Rebalancing: ${t} sats (${e>0?"Receiver → Provider":"Provider → Receiver"})`);let r=new Promise((e,t)=>setTimeout(()=>t(Error("Operation timed out after 30 seconds")),3e4));if(e>0){let e=this.walletManager.wallets[1].nwcClient.makeInvoice({amount:1e3*t,description:`Stabilization: excess ${t} sats (${this.stabilizationData.currency.toUpperCase()})`}),n=await Promise.race([e,r]);this.log(`\u{1F4B1} Invoice erstellt: ${t} sats`);let i=this.walletManager.wallets[2].nwcClient.payInvoice({invoice:n.invoice});await Promise.race([i,r]),this.log(`\u{1F4B1} Rebalancing erfolgreich: ${t} sats \xfcbertragen (Receiver \u{2192} Provider)`)}else{let e=this.walletManager.wallets[2].nwcClient.makeInvoice({amount:1e3*t,description:`Stabilization: deficit ${t} sats (${this.stabilizationData.currency.toUpperCase()})`}),n=await Promise.race([e,r]);this.log(`\u{1F4B1} Invoice erstellt: ${t} sats`);let i=this.walletManager.wallets[1].nwcClient.payInvoice({invoice:n.invoice});await Promise.race([i,r]),this.log(`\u{1F4B1} Rebalancing erfolgreich: ${t} sats \xfcbertragen (Provider \u{2192} Receiver)`)}this.stabilizationData.lastRebalanceTime=Date.now(),this.stabilizationData.errorCount=0}catch(e){this.stabilizationData.errorCount++,e.message.includes("timed out")?(this.log(`\u{1F4B1} Rebalancing Timeout: ${e.message}`),this.log(`\u{1F4B1} M\xf6glicherweise Relay-Verbindungsprobleme. Versuche beim n\xe4chsten Zyklus erneut.`)):e.message.includes("insufficient")?this.log(`\u{1F4B1} Rebalancing fehlgeschlagen: Unzureichende Balance`):this.log(`\u{1F4B1} Rebalancing fehlgeschlagen: ${e.message}`),console.error("Rebalancing error:",e),this.stabilizationData.errorCount>=3&&(this.stabilizationData.lastRebalanceTime=Date.now(),this.log(`\u{1F4B1} Pausiere Rebalancing f\xfcr 2 Minuten nach ${this.stabilizationData.errorCount} Fehlern`),setTimeout(()=>{this.stabilizationData.lastRebalanceTime=0,this.log(`\u{1F4B1} Rebalancing wieder bereit`)},12e4))}}updateStabilizationUI(){let e=document.getElementById("stabilization-currency"),t=document.getElementById("start-stabilization"),r=document.getElementById("stop-stabilization"),n=document.getElementById("rebalance-threshold");this.stabilizationData.active?(e.disabled=!0,n.disabled=!0,t.disabled=!0,r.disabled=!1):(e.disabled=!1,n.disabled=!1,t.disabled=!e.value||!this.walletManager.wallets[1].isConnected||!this.walletManager.wallets[2].isConnected,r.disabled=!0)}updateStabilizationStatus(e,t,r,n){let i=document.getElementById("stabilization-status"),o=document.getElementById("stabilization-info");if(this.stabilizationData.active){let s=this.stabilizationData.currency.toUpperCase(),a=this.stabilizationData.targetValue;i.className="alert alert-success py-2 px-3 mb-2",i.innerHTML=`Status: Aktiv (${s})`,o.innerHTML=`
                <div><strong>Zielwert:</strong> ${a.toFixed(2)} ${s}</div>
                <div><strong>Aktueller Wert:</strong> ${t.toFixed(2)} ${s}</div>
                <div><strong>Balance:</strong> ${e.toLocaleString()} sats</div>
                <div><strong>Soll-Balance:</strong> ${r.toLocaleString()} sats</div>
                <div><strong>Differenz:</strong> ${n>0?"+":""}${n.toLocaleString()} sats</div>
            `}else i.className="alert alert-secondary py-2 px-3 mb-2",i.innerHTML="Status: Nicht aktiv",o.innerHTML=""}async updateWalletStabilizationDisplay(){await this.updateSingleWalletDisplay(1),await this.updateSingleWalletDisplay(2),await this.updateWalletTransactions(1),await this.updateWalletTransactions(2)}async updateSingleWalletDisplay(e){let t=document.getElementById(`wallet${e}-stabilization-info`);if(!this.walletManager.wallets[e].isConnected){t.innerHTML=`
                <div class="text-center text-muted py-3">
                    <i class="fas fa-info-circle"></i>
                    <div>Wallet ${e} verbinden um Daten anzuzeigen</div>
                </div>
            `;return}try{let r=await this.walletManager.wallets[e].nwcClient.getBalance(),n=Math.round(r.balance/1e3),i=await fetch("https://mempool.space/api/v1/prices"),o=await i.json(),s={USD:{symbol:"$",value:o.USD},EUR:{symbol:"€",value:o.EUR},GBP:{symbol:"£",value:o.GBP},CHF:{symbol:"₣",value:o.CHF},CAD:{symbol:"C$",value:o.CAD},JPY:{symbol:"¥",value:o.JPY}},a="";Object.entries(s).forEach(([e,t])=>{let r=n/1e8*t.value;a+=`
                    <div class="d-flex justify-content-between mb-1">
                        <span class="small">${e}:</span>
                        <span class="small fw-bold">${t.symbol}${r.toFixed(2)}</span>
                    </div>
                `});let l="";if(2===e&&this.stabilizationData.active){let e=this.stabilizationData.currency.toUpperCase(),t=n/1e8*s[e].value,r=this.stabilizationData.targetValue,i=t-r;l=`
                    <div class="border-top pt-2 mt-2">
                        <div class="small text-success">
                            <strong>\u{1F3AF} Stabilisierung aktiv (${e})</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="small">Zielwert:</span>
                            <span class="small">${s[e].symbol}${r.toFixed(2)}</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="small">Differenz:</span>
                            <span class="small ${i>=0?"text-success":"text-danger"}">
                                ${i>=0?"+":""}${s[e].symbol}${i.toFixed(2)}
                            </span>
                        </div>
                    </div>
                `}t.innerHTML=`
                <div class="mb-2">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="fw-bold">Balance:</span>
                        <span class="fw-bold text-primary">${n.toLocaleString()} sats</span>
                    </div>
                    <div class="border-top pt-2">
                        <div class="small text-muted mb-1">W\xe4hrungswerte:</div>
                        ${a}
                    </div>
                    ${l}
                </div>
            `}catch(e){t.innerHTML=`
                <div class="text-center text-danger py-3">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>Fehler beim Laden der Wallet-Daten</div>
                    <small>${e.message}</small>
                </div>
            `}}async updateWalletTransactions(e){let t=document.getElementById(`wallet${e}-transactions`);if(!this.walletManager.wallets[e].isConnected){t.innerHTML=`
                <div class="text-center text-muted py-3">
                    <i class="fas fa-info-circle"></i>
                    <div>Wallet ${e} verbinden um Transaktionen anzuzeigen</div>
                </div>
            `;return}if(!1===this.walletManager.wallets[e].transactionsSupported){t.innerHTML=`
                <div class="text-center text-warning py-3">
                    <i class="fas fa-clock"></i>
                    <div>Transaktionen nicht verf\xfcgbar</div>
                    <small class="text-muted">NWC Provider unterst\xfctzt diese Funktion nicht</small>
                </div>
            `;return}null===this.walletManager.wallets[e].transactionsSupported&&(t.innerHTML=`
                <div class="text-center text-muted py-3">
                    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                    <div>Transaktionen werden geladen...</div>
                </div>
            `);try{let r=await this.walletManager.wallets[e].nwcClient.listTransactions({from:0,until:Math.floor(Date.now()/1e3),limit:10,offset:0,unpaid:!1,type:void 0}),n=r.transactions||r;if(!n||0===n.length){let t=await this.walletManager.wallets[e].nwcClient.listTransactions({});n=t.transactions||t}if(this.walletManager.wallets[e].transactionsSupported=!0,!n||0===n.length){t.innerHTML=`
                    <div class="text-center text-muted py-3">
                        <i class="fas fa-inbox"></i>
                        <div>Keine Transaktionen gefunden</div>
                    </div>
                `;return}let i=n.sort((e,t)=>t.created_at-e.created_at).slice(0,10),o="";i.forEach(e=>{let t=new Date(1e3*e.created_at),r=Math.round(e.amount/1e3),n=e.type||"payment",i=!1,s="\uD83D\uDCB8",a="text-danger",l="Ausgehend";"incoming"===n?(i=!0,s="\uD83D\uDCE5",a="text-success",l="Empfangen"):"outgoing"===n?(i=!1,s="\uD83D\uDCE4",a="text-danger",l="Gesendet"):(i=r>0)&&(s="\uD83D\uDCB0",a="text-success",l="Eingehend");let c=e.description||e.memo||"Keine Beschreibung";c.length>40&&(c=c.substring(0,40)+"..."),o+=`
                    <div class="border-bottom px-3 py-2">
                        <div class="d-flex justify-content-between align-items-start mb-1">
                            <div class="d-flex align-items-center">
                                <span class="me-2">${s}</span>
                                <div>
                                    <div class="small fw-bold ${a}">
                                        ${i?"+":"-"}${Math.abs(r).toLocaleString()} sats
                                    </div>
                                    <div class="text-muted" style="font-size: 0.75rem;">
                                        ${l}
                                    </div>
                                </div>
                            </div>
                            <div class="text-end">
                                <div class="text-muted small">
                                    ${t.toLocaleString("de-DE",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}
                                </div>
                            </div>
                        </div>
                        <div class="small text-muted" style="font-size: 0.75rem;">
                            ${c}
                        </div>
                    </div>
                `}),t.innerHTML=o}catch(r){console.warn(`Wallet ${e} transactions error:`,r.message),r.message.includes("Timeout")||r.message.includes("reply timeout")?(this.walletManager.wallets[e].transactionsSupported=!1,t.innerHTML=`
                    <div class="text-center text-warning py-3">
                        <i class="fas fa-clock"></i>
                        <div>Transaktionen nicht verf\xfcgbar</div>
                        <small class="text-muted">NWC Provider unterst\xfctzt diese Funktion nicht</small>
                    </div>
                `):(this.walletManager.wallets[e].transactionsSupported=!1,t.innerHTML=`
                    <div class="text-center text-danger py-3">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>Fehler beim Laden der Transaktionen</div>
                        <small class="text-muted">${r.message}</small>
                    </div>
                `)}}}new class{constructor(){this.walletManager=new a,this.priceManager=new l,this.stabilizationManager=new c(this.walletManager),this.setupEventListeners(),this.makeGlobalFunctions()}setupEventListeners(){window.addEventListener("walletConnectionChanged",()=>{this.stabilizationManager.updateStabilizationUI(),this.stabilizationManager.updateWalletStabilizationDisplay()});let e=document.getElementById("stabilization-currency");e&&e.addEventListener("change",()=>{this.stabilizationManager.updateStabilizationUI()}),window.addEventListener("load",()=>{this.initialize()})}initialize(){this.walletManager.log("NWC Demo page loaded"),this.walletManager.log("REAL NWC INTEGRATION with local dependencies - Use real wallet connection strings!"),this.walletManager.log("Supported wallets: Alby Hub, Coinos, Primal, lnwallet.app, Yakihonne..."),this.priceManager.startPriceUpdates(),this.stabilizationManager.updateStabilizationUI(),this.walletManager.loadSavedConnectionStrings(),this.priceManager.initializePriceChart(),0===this.priceManager.getPriceHistory().length&&this.priceManager.fetchHistoricalPrices()}makeGlobalFunctions(){window.connectWallet=e=>this.walletManager.connectWallet(e),window.disconnectWallet=e=>this.walletManager.disconnectWallet(e),window.getWalletInfo=e=>this.walletManager.getWalletInfo(e),window.getBalance=e=>this.walletManager.getBalance(e),window.createInvoice=e=>this.walletManager.createInvoice(e),window.payInvoice=e=>this.walletManager.payInvoice(e),window.listTransactions=e=>this.walletManager.listTransactions(e),window.payKeysend=e=>this.walletManager.payKeysend(e),window.saveConnectionString=e=>this.walletManager.saveConnectionString(e),window.clearConnectionString=e=>this.walletManager.clearConnectionString(e),window.toggleConnectionVisibility=e=>this.walletManager.toggleConnectionVisibility(e),window.clearLog=()=>this.walletManager.clearLog(),window.fetchBitcoinPrice=()=>this.priceManager.fetchBitcoinPrice(),window.startPriceUpdates=()=>this.priceManager.startPriceUpdates(),window.stopPriceUpdates=()=>this.priceManager.stopPriceUpdates(),window.fetchHistoricalPrices=()=>this.priceManager.fetchHistoricalPrices(),window.updatePriceChart=()=>this.priceManager.updatePriceChart(),window.clearAndReloadPriceData=()=>this.priceManager.clearAndReloadPriceData(),window.startStabilization=()=>this.stabilizationManager.startStabilization(),window.stopStabilization=()=>this.stabilizationManager.stopStabilization()}};
//# sourceMappingURL=nwc.36942d46.js.map
